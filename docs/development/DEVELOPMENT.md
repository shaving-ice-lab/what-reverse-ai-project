# ReverseAI å¼€å‘æ–‡æ¡£

> **æ–‡æ¡£ç‰ˆæœ¬**: v3.26  
> **åˆ›å»ºæ—¥æœŸ**: 2026-01-26  
> **æ›´æ–°æ—¥æœŸ**: 2026-01-27  
> **åŸºäºPRDç‰ˆæœ¬**: v1.0  
> **æŠ€æœ¯æ ˆ**: Next.js 16 + shadcn/ui + Golang Echo + Tauri
>
> **Phase 1.2 è¿›åº¦**: å¯è§†åŒ–ç¼–è¾‘å™¨ - 36/36 å®Œæˆ (100%) âœ…
> **Phase 1.3 è¿›åº¦**: åŸºç¡€èŠ‚ç‚¹é›† - 21/21 å®Œæˆ (100%) âœ…
> **Phase 1.4 è¿›åº¦**: æ‰§è¡Œå¼•æ“ - 14/14 å®Œæˆ (100%) âœ…
> **Phase 1.5 è¿›åº¦**: ç”¨æˆ·ç³»ç»Ÿ (å‰ç«¯) - 5/5 å®Œæˆ (100%) âœ…
> **Phase 1.6 è¿›åº¦**: å·¥ä½œæµç®¡ç† (å‰ç«¯) - 6/6 å®Œæˆ (100%) âœ…
> **Phase 1.7 è¿›åº¦**: è®¾ç½®ä¸­å¿ƒ (å‰ç«¯) - 6/6 å®Œæˆ (100%) âœ…
> **Phase 1.8 è¿›åº¦**: åç«¯æ ¸å¿ƒæœåŠ¡ - 4/4 å®Œæˆ (100%) âœ…
> **Phase 1.9 è¿›åº¦**: å‰ç«¯æ‰§è¡Œå±•ç¤º - 4/4 å®Œæˆ (100%) âœ…
> **Phase 1.10 è¿›åº¦**: UX/æ€§èƒ½ä¼˜åŒ– - 10/10 å®Œæˆ (100%) âœ…
> **Phase 1.11 è¿›åº¦**: Bugä¿®å¤/ç¨³å®šæ€§ - 3/3 å®Œæˆ (100%) âœ…
> **Phase 1.12 è¿›åº¦**: æµ‹è¯• - 4/4 å®Œæˆ (100%) âœ…
> **Phase 2.1 è¿›åº¦**: èŠ‚ç‚¹ SDK - 9/9 å®Œæˆ (100%) âœ…
> **Phase 2.2 è¿›åº¦**: æ’ä»¶ç³»ç»Ÿ - 10/10 å®Œæˆ (100%) âœ…
> **Phase 3.1 è¿›åº¦**: æœ¬åœ°éƒ¨ç½² - 7/7 å®Œæˆ (100%) âœ…
>
> **æœ€æ–°æ›´æ–° (v3.26)**:
>
> - âœ… LM Studio é›†æˆ (lm-studio-provider.ts - OpenAI å…¼å®¹ API)
> - âœ… å¤š Provider æ”¯æŒ (useLocalLLM.ts - åˆ‡æ¢/çŠ¶æ€æ£€æµ‹)
> - âœ… UI Provider é€‰æ‹© (LocalLLMSettings.tsx - å¡ç‰‡å¼é€‰æ‹©)
>
> **æ›´æ–° (v3.25)**:
>
> - âœ… æ€§èƒ½æµ‹è¯•æ¡†æ¶ (utils.ts - åŸºå‡†æµ‹è¯•/å†…å­˜æµ‹é‡/æŠ¥å‘Šç”Ÿæˆ)
> - âœ… å‰ç«¯ç»„ä»¶æ€§èƒ½æµ‹è¯• (component.perf.test.ts - æ¸²æŸ“/åºåˆ—åŒ–/å†…å­˜)
> - âœ… æ‰§è¡Œå¼•æ“æ€§èƒ½æµ‹è¯• (engine.perf.test.ts - DAG/æ‹“æ‰‘æ’åº/å¹¶å‘)
> - âœ… æ€§èƒ½æµ‹è¯•é…ç½® (vitest.perf.config.ts - ç‹¬ç«‹é…ç½®)
>
> **æ›´æ–° (v3.24)**:
>
> - âœ… E2E æµ‹è¯•ç”¨ä¾‹ (Playwright - è®¤è¯/å·¥ä½œæµ/æ‰§è¡Œæµç¨‹æµ‹è¯•)
> - âœ… æµ‹è¯•å·¥å…·å‡½æ•° (test-helpers.ts - è®¤è¯/å·¥ä½œæµ/ç­‰å¾…/æ–­è¨€è¾…åŠ©)
> - âœ… æµ‹è¯•è„šæœ¬é…ç½® (e2e/e2e:ui/e2e:headed/e2e:debug)
>
> **æ›´æ–° (v3.23)**:
>
> - âœ… æœ¬åœ°/äº‘ç«¯æ•°æ®åŒæ­¥ (types.ts/sync-engine.ts - å†²çªæ£€æµ‹/å¢é‡åŒæ­¥)
> - âœ… ç«¯åˆ°ç«¯åŠ å¯† (encryption.ts - AES-GCM/PBKDF2 å¯†é’¥æ´¾ç”Ÿ)
> - âœ… åŒæ­¥çŠ¶æ€ Hook (useSyncStatus.ts - è‡ªåŠ¨åŒæ­¥/æ‰‹åŠ¨åŒæ­¥)
> - âœ… åŒæ­¥çŠ¶æ€ UI (SyncIndicator/SyncBadge - çŠ¶æ€æ˜¾ç¤º/æ“ä½œ)
>
> **æ›´æ–° (v3.22)**:
>
> - âœ… ç¦»çº¿æ¨¡å¼æ”¯æŒ (types.ts/offline-queue.ts - ç¦»çº¿é˜Ÿåˆ—ç®¡ç†)
> - âœ… ç¦»çº¿çŠ¶æ€ Hook (useOfflineStatus.ts - ç½‘ç»œæ£€æµ‹/è‡ªåŠ¨åŒæ­¥)
> - âœ… ç¦»çº¿æç¤º UI (OfflineIndicator/OfflineBanner/OnlineStatusBadge)
>
> **æ›´æ–° (v3.21)**:
>
> - âœ… Ollama æœ¬åœ°æ¨¡å‹é›†æˆ (types.ts/ollama-provider.ts/useLocalLLM.ts)
> - âœ… æ¨¡å‹ç®¡ç† UI (LocalLLMSettings.tsx - çŠ¶æ€æ£€æµ‹/æ¨¡å‹åˆ—è¡¨/ä¸‹è½½/åˆ é™¤/æµ‹è¯•)
> - âœ… è®¾ç½®é¡µé¢é›†æˆæœ¬åœ° LLM è®¾ç½®
>
> **æ›´æ–° (v3.20)**:
>
> - âœ… Tauri æ¡Œé¢åº”ç”¨æ¡†æ¶ (Rust + Tauri 2.0 å®Œæ•´æ¶æ„)
> - âœ… SQLite æœ¬åœ°æ•°æ®åº“ (è¿ç§»ç³»ç»Ÿ/å·¥ä½œæµCRUD/æ‰§è¡Œè®°å½•)
>
> **æ›´æ–° (v3.19)**:
>
> - âœ… å®ç°æ’ä»¶ç­¾åéªŒè¯ (signature.ts - ç­¾åç”Ÿæˆ/éªŒè¯/è¯ä¹¦é“¾/æ ¡éªŒå’Œ)
>
> **æ›´æ–° (v3.18)**:
>
> - âœ… å®ç°æ’ä»¶å¸‚åœºåŸºç¡€ (marketplace.ts - æœç´¢/ä¸‹è½½/å‘å¸ƒ/ç¼“å­˜)
> - âœ… å®ç°æ’ä»¶ç‰ˆæœ¬ç®¡ç† (version.ts - è¯­ä¹‰åŒ–ç‰ˆæœ¬/å…¼å®¹æ€§æ£€æŸ¥)
> - âœ… ç¼–å†™å¼€å‘è€…æ–‡æ¡£ (PLUGIN_DEV_GUIDE.md - å®Œæ•´å¼€å‘æŒ‡å—)
>
> **æ›´æ–° (v3.17)**:
>
> - âœ… å®ç°æ’ä»¶æƒé™æ§åˆ¶ (permissions.ts - æƒé™ç®¡ç†/ç­–ç•¥/å®¡è®¡)
> - âœ… å®ç°æ’ä»¶å®‰è£…/å¸è½½ (installer.ts - å®‰è£…å™¨/æ›´æ–°æ£€æŸ¥)
> - âœ… ç¼–å†™ç¤ºä¾‹æ’ä»¶ (examples/ - Hello World/HTTP Tools)
>
> **æ›´æ–° (v3.16)**:
>
> - âœ… è®¾è®¡æ’ä»¶ Manifest è§„èŒƒ (types.ts - å®Œæ•´ç±»å‹å®šä¹‰)
> - âœ… å®ç°æ’ä»¶åŠ è½½æœºåˆ¶ (loader.ts - åŠ è½½å™¨/æ³¨å†Œè¡¨)
> - âœ… å®ç°æ’ä»¶æ²™ç®±ç¯å¢ƒ (sandbox.ts - æƒé™/èµ„æºé™åˆ¶)
>
> **æ›´æ–° (v3.15)**:
>
> - âœ… å®ç° CLI å·¥å…· (init/build/test/validate å‘½ä»¤)
> - âœ… å‘å¸ƒ npm åŒ…é…ç½® (package.json/CHANGELOG/.npmignore)
>
> **æ›´æ–° (v3.14)**:
>
> - âœ… å®ç°èŠ‚ç‚¹éªŒè¯æœºåˆ¶ (validation.ts - å®Œæ•´éªŒè¯ç³»ç»Ÿ)
> - âœ… å®ç°èŠ‚ç‚¹æµ‹è¯•æ¡†æ¶ (testing.ts - Mock/æ–­è¨€/å¥—ä»¶)
> - âœ… ç¼–å†™ SDK ä½¿ç”¨æ–‡æ¡£ (README.md - å®Œæ•´ API æ–‡æ¡£)
> - âœ… æä¾›ç¤ºä¾‹èŠ‚ç‚¹ (examples/ - 3ä¸ªå®Œæ•´ç¤ºä¾‹)
>
> **æ›´æ–° (v3.13)**:
>
> - âœ… è®¾è®¡ SDK API æ¥å£ (types.ts - å®Œæ•´ç±»å‹ç³»ç»Ÿ)
> - âœ… å®ç°èŠ‚ç‚¹å®šä¹‰è§„èŒƒ (defineNode.ts - æ ¸å¿ƒ API)
> - âœ… å®ç°è¾“å…¥/è¾“å‡ºç±»å‹ç³»ç»Ÿ (builders.ts - é“¾å¼æ„å»ºå™¨)
>
> **æ›´æ–° (v3.12)**:
>
> - âœ… è®¾ç½®å‰ç«¯æµ‹è¯•æ¡†æ¶ (Vitest + React Testing Library)
> - âœ… ç¼–å†™æ ¸å¿ƒç»„ä»¶å•å…ƒæµ‹è¯• (Button/Loading/EmptyState)
> - âœ… ç¼–å†™ Lib æ¨¡å—æµ‹è¯• (cache/concurrency)
> - âœ… ç¼–å†™åç«¯æ‰§è¡Œå¼•æ“æµ‹è¯• (DAG/Executor/Context)
>
> **æ›´æ–° (v3.11)**:
>
> - âœ… å®ç°ç”»å¸ƒçŠ¶æ€æŒä¹…åŒ– (useCanvasPersistence/è‡ªåŠ¨ä¿å­˜/å†å²è®°å½•)
> - âœ… å®ç°æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ– (QueryCache/BatchQuery/QueryBuilder)
> - âœ… å®ç°æ•°æ®åº“ç´¢å¼•ç®¡ç† (IndexDefinition/CreateAllIndexes/TableStats)
>
> **æ›´æ–° (v3.10)**:
>
> - âœ… å®ç°ç¼–è¾‘å™¨é”™è¯¯è¾¹ç•Œ (EditorErrorBoundary/è‡ªåŠ¨ä¿å­˜/æ•°æ®æ¢å¤)
> - âœ… å®ç°æ‰§è¡Œå¼•æ“å¼‚å¸¸å¤„ç† (ExecutionError/RetryConfig/SafeExecute/Checkpoint)
> - âœ… å®ç°å¹¶å‘å®‰å…¨å·¥å…· (Mutex/RWMutex/Semaphore/CancellationToken)
>
> **æ›´æ–° (v3.9)**:
>
> - âœ… å®ç°å¿«æ·é”®å¸®åŠ©å¯¹è¯æ¡† (KeyboardShortcutsDialog)
> - âœ… å®ç°æ–°ç”¨æˆ·å¼•å¯¼æ•™ç¨‹ç»„ä»¶ (OnboardingProvider/OnboardingOverlay)
> - âœ… å®ç°å‰ç«¯ç¼“å­˜ç­–ç•¥ (queryKeys/localCache/dedupeRequest)
>
> **æ›´æ–° (v3.8)**:
>
> - âœ… å®ç°åŠ è½½çŠ¶æ€ç»„ä»¶ (Spinner/PageLoader/Skeleton/FullscreenLoader)
> - âœ… å®ç° Toast é€šçŸ¥ç³»ç»Ÿ (success/error/warning/info)
> - âœ… å®ç°é”™è¯¯è¾¹ç•Œç»„ä»¶ (ErrorBoundary/ErrorFallback/ApiError)
> - âœ… å®ç°ç©ºçŠ¶æ€ç»„ä»¶ (EmptyState/SearchEmpty/CanvasEmpty)
> - âœ… å®ç°å‰ç«¯ä»£ç åˆ†å‰² (LazyWorkflowEditor)
>
> **æ›´æ–° (v3.7)**:
>
> - âœ… å®ç°å»¶è¿ŸèŠ‚ç‚¹ (DelayNode + DelayExecutor)
> - âœ… å®ç° Webhook è§¦å‘èŠ‚ç‚¹ (WebhookNode + WebhookExecutor)
> - âœ… æ³¨å†Œæ‰€æœ‰æ–°æ‰§è¡Œå™¨åˆ°å¼•æ“
> - âœ… Phase 1.3 åŸºç¡€èŠ‚ç‚¹é›†å®Œæˆ!
>
> **æ›´æ–° (v3.6)**:
>
> - âœ… å®ç°æ–‡æœ¬åˆ†å‰²/åˆå¹¶èŠ‚ç‚¹ (TextSplitNode + TextSplitExecutor)
> - âœ… å®ç°æ•°æ®åˆå¹¶èŠ‚ç‚¹ (MergeNode + MergeExecutor)
> - âœ… å®ç°æ•°æ®ç­›é€‰èŠ‚ç‚¹ (FilterNode + FilterExecutor)
> - âœ… å®ç°å¹¶è¡Œæ‰§è¡ŒèŠ‚ç‚¹ (ParallelNode + ParallelExecutor)
> - âœ… æ³¨å†Œæ‰€æœ‰æ–°æ‰§è¡Œå™¨åˆ°å¼•æ“
>
> **æ›´æ–° (v3.5)**:
>
> - âœ… å®ç°è¡¨è¾¾å¼è®¡ç®—èŠ‚ç‚¹ (ExpressionNode + ExpressionExecutor)
> - âœ… å®ç°é”™è¯¯å¤„ç†èŠ‚ç‚¹ Try/Catch (TryCatchNode + TryCatchExecutor)
> - âœ… å®ç°æ•°æ®è½¬æ¢èŠ‚ç‚¹ (TransformNode + TransformExecutor)
> - âœ… å®ç°æ­£åˆ™æå–èŠ‚ç‚¹ (RegexNode + RegexExecutor + ReplaceExecutor)
> - âœ… æ³¨å†Œæ‰€æœ‰æ–°æ‰§è¡Œå™¨åˆ°å¼•æ“
>
> **æ›´æ–° (v3.4)**:
>
> - âœ… å®ç°æ‰§è¡Œå–æ¶ˆåŠŸèƒ½ (åç«¯ Handler + å‰ç«¯ API)
> - âœ… å®ç° JavaScript ä»£ç èŠ‚ç‚¹ (å‰ç«¯ç»„ä»¶ + åç«¯æ‰§è¡Œå™¨)
> - âœ… å®ç°ç”¨æˆ·è¾“å…¥èŠ‚ç‚¹ (InputNode ç»„ä»¶ + InputExecutor)
> - âœ… å®ç°è¾“å‡ºå±•ç¤ºèŠ‚ç‚¹ (OutputNode ç»„ä»¶ + OutputExecutor)
> - âœ… æ›´æ–°èŠ‚ç‚¹ç±»å‹æ³¨å†Œæ˜ å°„
>
> **æ›´æ–° (v3.3)**:
>
> - âœ… å®ç°å‰ç«¯ WebSocket Hook (è¿æ¥ç®¡ç†/è‡ªåŠ¨é‡è¿/æ¶ˆæ¯å¤„ç†)
> - âœ… å®ç°æ‰§è¡ŒçŠ¶æ€ Store (useExecutionStore)
> - âœ… å®ç°æ‰§è¡Œæ§åˆ¶å°é¢æ¿ (ExecutionPanel)
> - âœ… å®ç°èŠ‚ç‚¹æ‰§è¡Œé«˜äº®æ•ˆæœ (useNodeExecutionStatus)
> - âœ… æ›´æ–°ç»„ä»¶å’Œ Hook å¯¼å‡º
>
> **æ›´æ–° (v3.2)**:
>
> - âœ… å®ç° WebSocket æœåŠ¡ (Hub/Client/Handler) - æ”¯æŒå®æ—¶æ¨é€æ‰§è¡ŒçŠ¶æ€
> - âœ… å®ç°åç«¯å·¥ä½œæµæ‰§è¡Œå¼•æ“ (DAG/Scheduler/Executors)
> - âœ… é›†æˆ Asynq ä»»åŠ¡é˜Ÿåˆ— (å¼‚æ­¥æ‰§è¡Œ/å®šæ—¶ä»»åŠ¡/Webhookè§¦å‘)
> - âœ… å®ç° API å¯†é’¥åŠ å¯†å­˜å‚¨ (AES-256-GCM/è„±æ•å±•ç¤º)
> - âœ… åˆ›å»ºèŠ‚ç‚¹æ‰§è¡Œå™¨ (Start/End/LLM/HTTP/Condition/Loop/Template/Variable)
>
> **æ›´æ–° (v3.1)**:
>
> - âœ… åˆ›å»º API å¯†é’¥ç±»å‹å®šä¹‰ (Provider/Status/Config)
> - âœ… åˆ›å»º API å¯†é’¥æœåŠ¡å±‚ (apiKeysApi)
> - âœ… åˆ›å»ºæ·»åŠ å¯†é’¥å¯¹è¯æ¡† (æä¾›å•†é€‰æ‹©/å¯†é’¥æµ‹è¯•)
> - âœ… åˆ›å»º API å¯†é’¥ç®¡ç†é¡µé¢ (åˆ—è¡¨/åˆ é™¤/ç»Ÿè®¡)
> - âœ… åˆ›å»ºè®¾ç½®é¡µé¢å¸ƒå±€ (ä¾§è¾¹å¯¼èˆª)
> - âœ… åˆ›å»ºä¸ªäººèµ„æ–™é¡µé¢ (å¤´åƒ/åŸºæœ¬ä¿¡æ¯/å±é™©åŒºåŸŸ)
>
> **æ›´æ–° (v3.0)**:
>
> - âœ… åˆ›å»ºå·¥ä½œæµ API ç±»å‹å®šä¹‰ (WorkflowMeta/Workflow/Execution)
> - âœ… åˆ›å»ºå·¥ä½œæµ API æœåŠ¡å±‚ (workflowApi/folderApi/executionApi)
> - âœ… åˆ›å»ºå·¥ä½œæµå¡ç‰‡ç»„ä»¶ (ç»Ÿè®¡/æ ‡ç­¾/çŠ¶æ€)
> - âœ… åˆ›å»ºæ–°å»ºå·¥ä½œæµå¯¹è¯æ¡† (æ¨¡æ¿é€‰æ‹©)
> - âœ… åˆ›å»ºå·¥ä½œæµåˆ—è¡¨é¡µé¢ (æœç´¢/ç­›é€‰/æ’åº)
> - âœ… åˆ›å»º Dashboard å¸ƒå±€ (å“åº”å¼å¯¼èˆª)
>
> **æ›´æ–° (v2.9)**:
>
> - âœ… åˆ›å»ºè®¤è¯ç±»å‹å®šä¹‰ (User/AuthTokens/ç™»å½•æ³¨å†Œæ¥å£)
> - âœ… åˆ›å»ºè®¤è¯ API æœåŠ¡å±‚ (authApi/userApi)
> - âœ… åˆ›å»ºè®¤è¯çŠ¶æ€ç®¡ç† (useAuthStore)
> - âœ… åˆ›å»ºç™»å½•é¡µé¢ç»„ä»¶ (æ”¯æŒ OAuth)
> - âœ… åˆ›å»ºæ³¨å†Œé¡µé¢ç»„ä»¶ (å¯†ç å¼ºåº¦æ£€æµ‹)
> - âœ… åˆ›å»ºè·¯ç”±ä¿æŠ¤ç»„ä»¶ (AuthGuard)
>
> **æ›´æ–° (v2.8)**:
>
> - âœ… è®¾è®¡å‰ç«¯æ‰§è¡Œå¼•æ“æ¶æ„ (WorkflowExecutor)
> - âœ… å®ç° DAG ä¾èµ–åˆ†æ (æ‹“æ‰‘æ’åº/å¾ªç¯æ£€æµ‹)
> - âœ… å®ç°å·¥ä½œæµæ‰§è¡Œå™¨ (å¹¶å‘æ§åˆ¶/çŠ¶æ€ç®¡ç†)
> - âœ… å®ç°æ‰§è¡ŒçŠ¶æ€ç®¡ç† (èŠ‚ç‚¹çŠ¶æ€/æ—¥å¿—/äº‹ä»¶)
> - âœ… åˆ›å»º useExecution Hook (React é›†æˆ)
>
> **æ›´æ–° (v2.7)**:
>
> - âœ… å®ç° LLM è°ƒç”¨èŠ‚ç‚¹æ‰§è¡Œå™¨ (æ”¯æŒ OpenAI/Anthropic/æœ¬åœ°æ¨¡å‹)
> - âœ… å®ç° HTTP è¯·æ±‚èŠ‚ç‚¹æ‰§è¡Œå™¨ (æ”¯æŒè®¤è¯/é‡è¯•/è¶…æ—¶)
> - âœ… å®ç°æ¡ä»¶åˆ¤æ–­èŠ‚ç‚¹æ‰§è¡Œå™¨ (å¤šæ¡ä»¶ç»„/AND/OR)
> - âœ… å®ç°å¾ªç¯èŠ‚ç‚¹æ‰§è¡Œå™¨ (forEach/while/count)
> - âœ… å®ç°å˜é‡è®¾ç½®èŠ‚ç‚¹æ‰§è¡Œå™¨
> - âœ… å®ç°æ–‡æœ¬æ¨¡æ¿èŠ‚ç‚¹æ‰§è¡Œå™¨
> - âœ… åˆ›å»ºèŠ‚ç‚¹æ‰§è¡Œå™¨æ¶æ„ (types/utils/executors)
>
> **æ›´æ–° (v2.6)**:
>
> - âœ… å®ç°è¿çº¿åŠ¨ç”»æ•ˆæœ (æ•°æ®æµåŠ¨/æ‰§è¡Œä¸­/è„‰å†²åŠ¨ç”»)
> - âœ… å®ç°å“åº”å¼é€‚é… (ç§»åŠ¨ç«¯ Sheet å¸ƒå±€)
> - âœ… å®ç°é…ç½®å®æ—¶é¢„è§ˆ (Prompt é¢„è§ˆ/HTTP cURL é¢„è§ˆ)
> - âœ… å®Œæˆå¯è§†åŒ–ç¼–è¾‘å™¨å…¨éƒ¨åŠŸèƒ½!
>
> **æ›´æ–° (v2.5)**:
>
> - âœ… å®ç°è¿çº¿ç±»å‹æ£€æŸ¥ (é˜²æ­¢è‡ªè¿æ¥/å¾ªç¯è¿æ¥/ç±»å‹ä¸å…¼å®¹)
> - âœ… å®ç°è¡¨å•æ ¡éªŒ (åŸºäº zod schema)
> - âœ… å®ç°æ·±è‰²/æµ…è‰²ä¸»é¢˜åˆ‡æ¢ (åŸºäº next-themes)
> - âœ… å®ç°è¿çº¿æ ‡ç­¾ (æ¡ä»¶è¾¹/æ ‡ç­¾è¾¹)
>
> **æ›´æ–° (v2.4)**:
>
> - âœ… å®ç°èŠ‚ç‚¹å¤åˆ¶ç²˜è´´åŠŸèƒ½ (Ctrl+C/V/D)
> - âœ… å®ç°è‡ªåŠ¨å¸ƒå±€ç®—æ³• (åŸºäº dagre)
> - âœ… å®ç°å˜é‡é€‰æ‹©å™¨ç»„ä»¶
> - âœ… å®ç°æ¡ä»¶èŠ‚ç‚¹é…ç½®é¢æ¿ (æ¡ä»¶æ„å»ºå™¨)
> - âœ… å®ç°å¾ªç¯èŠ‚ç‚¹é…ç½®é¢æ¿
>
> **æ›´æ–° (v2.3)**:
>
> - âœ… å®Œæˆç¼–è¾‘å™¨æ•´ä½“å¸ƒå±€å®ç° (WorkflowEditor)
> - âœ… å®Œæˆ React Flow ç”»å¸ƒé›†æˆ (EditorCanvas)
> - âœ… å®ŒæˆèŠ‚ç‚¹é¢æ¿å®ç° (NodePanel) - æ”¯æŒåˆ†ç±»ã€æœç´¢ã€æ‹–æ‹½
> - âœ… å®Œæˆé…ç½®é¢æ¿å®ç° (ConfigPanel) - æ”¯æŒ LLM/HTTP/Code ç­‰èŠ‚ç‚¹é…ç½®
> - âœ… å®Œæˆé¡¶éƒ¨å·¥å…·æ  (EditorToolbar)
> - âœ… å®ç° 10 ç§è‡ªå®šä¹‰èŠ‚ç‚¹ç»„ä»¶: Start, End, LLM, HTTP, Condition, Loop, Code, Template, Variable, Base
> - âœ… å®Œæˆå¿«æ·é”®ç³»ç»Ÿ (ä¿å­˜/æ’¤é”€/é‡åš/åˆ é™¤/å…¨é€‰)
> - âœ… å®Œæˆå·¥ä½œæµåˆ—è¡¨é¡µé¢ (workflows)

---

## ç›®å½•

### ç¬¬ä¸€éƒ¨åˆ†ï¼šé¡¹ç›®åŸºç¡€

1. [é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
2. [æŠ€æœ¯æ ˆè¯¦æƒ…](#2-æŠ€æœ¯æ ˆè¯¦æƒ…)
3. [é¡¹ç›®ç»“æ„](#3-é¡¹ç›®ç»“æ„)
4. [å¼€å‘ç¯å¢ƒæ­å»º](#4-å¼€å‘ç¯å¢ƒæ­å»º)
5. [å¼€å‘é˜¶æ®µè§„åˆ’](#5-å¼€å‘é˜¶æ®µè§„åˆ’)
6. [TodoList ä»»åŠ¡æ¸…å•](#6-todolist-ä»»åŠ¡æ¸…å•)

### ç¬¬äºŒéƒ¨åˆ†ï¼šæ ¸å¿ƒåŠŸèƒ½å®ç°

7. [æ•°æ®åº“è®¾è®¡](#7-æ•°æ®åº“è®¾è®¡)
8. [API æ¥å£è®¾è®¡](#8-api-æ¥å£è®¾è®¡)
9. [å‰ç«¯ç»„ä»¶è®¾è®¡](#9-å‰ç«¯ç»„ä»¶è®¾è®¡)
10. [åç«¯æœåŠ¡è®¾è®¡](#10-åç«¯æœåŠ¡è®¾è®¡)

### ç¬¬ä¸‰éƒ¨åˆ†ï¼šä»£ç çº§è‡ªå®šä¹‰ç³»ç»Ÿ

11. [è‡ªå®šä¹‰èŠ‚ç‚¹ SDK](#11-è‡ªå®šä¹‰èŠ‚ç‚¹-sdk)
12. [Prompt æ¨¡æ¿å¼•æ“](#12-prompt-æ¨¡æ¿å¼•æ“)
13. [æ²™ç®±æ‰§è¡Œç¯å¢ƒ](#13-æ²™ç®±æ‰§è¡Œç¯å¢ƒ)
14. [æ’ä»¶ç³»ç»Ÿæ¶æ„](#14-æ’ä»¶ç³»ç»Ÿæ¶æ„)

### ç¬¬å››éƒ¨åˆ†ï¼šAgent åä½œç½‘ç»œ

15. [Agent å•†åº—ç³»ç»Ÿ](#15-agent-å•†åº—ç³»ç»Ÿ)
16. [Agent ç»„åˆå™¨](#16-agent-ç»„åˆå™¨)
17. [Agent è¿›åŒ–ç³»ç»Ÿ](#17-agent-è¿›åŒ–ç³»ç»Ÿ)
18. [åˆ›ä½œè€…ç»æµç³»ç»Ÿ](#18-åˆ›ä½œè€…ç»æµç³»ç»Ÿ)

### ç¬¬äº”éƒ¨åˆ†ï¼šæœ¬åœ°ä¼˜å…ˆæ¶æ„

19. [æœ¬åœ°/äº‘ç«¯åŒæ¨¡å¼æ¶æ„](#19-æœ¬åœ°äº‘ç«¯åŒæ¨¡å¼æ¶æ„)
20. [æœ¬åœ° LLM é›†æˆ](#20-æœ¬åœ°-llm-é›†æˆ)
21. [æ•°æ®åŒæ­¥æœºåˆ¶](#21-æ•°æ®åŒæ­¥æœºåˆ¶)
22. [ç¦»çº¿æ”¯æŒæ–¹æ¡ˆ](#22-ç¦»çº¿æ”¯æŒæ–¹æ¡ˆ)

### ç¬¬å…­éƒ¨åˆ†ï¼šè¿ç»´ä¸éƒ¨ç½²

23. [æµ‹è¯•ç­–ç•¥](#23-æµ‹è¯•ç­–ç•¥)
24. [éƒ¨ç½²æ–¹æ¡ˆ](#24-éƒ¨ç½²æ–¹æ¡ˆ)
25. [ç›‘æ§ä¸è¿ç»´](#25-ç›‘æ§ä¸è¿ç»´)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 äº§å“ç®€ä»‹

ReverseAI æ˜¯ä¸€ä¸ªæœ¬åœ°ä¼˜å…ˆã€ä»£ç çº§è‡ªå®šä¹‰ã€ç¤¾åŒºé©±åŠ¨çš„ AI Agent å·¥ä½œæµå¹³å°ï¼Œæ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬ï¼š

- å¯è§†åŒ– Workflow ç¼–è¾‘å™¨
- AI Agent å•†åº—
- è‡ªå®šä¹‰èŠ‚ç‚¹ SDK
- æœ¬åœ°/äº‘ç«¯åŒæ¨¡å¼æ‰§è¡Œ

### 1.2 æ ¸å¿ƒä»·å€¼

| ä»·å€¼ç‚¹       | æè¿°                              |
| ------------ | --------------------------------- |
| æœ¬åœ°ä¼˜å…ˆ     | æ”¯æŒå®Œå…¨æœ¬åœ°è¿è¡Œï¼Œæ•°æ®ä¸å‡ºæœ¬æœº    |
| ä»£ç çº§è‡ªå®šä¹‰ | ç”¨æˆ·å¯ç¼–å†™è‡ªå®šä¹‰èŠ‚ç‚¹å’Œæ’ä»¶        |
| ç¤¾åŒºç”Ÿæ€     | Agentå•†åº— + åˆ†äº«æœºåˆ¶ + åˆ›ä½œè€…ç»æµ |
| æè‡´ä½“éªŒ     | 5åˆ†é’Ÿä¸Šæ‰‹ï¼Œç¾è§‚ç°ä»£çš„ç•Œé¢         |

---

## 2. æŠ€æœ¯æ ˆè¯¦æƒ…

### 2.1 å‰ç«¯æŠ€æœ¯æ ˆ

```yaml
æ¡†æ¶:
  - Next.js 16 (App Router)
  - TypeScript 5.x
  - React 19

UIæ¡†æ¶:
  - shadcn/ui (åŸºäº Radix UI)
  - Tailwind CSS 4.x
  - Lucide Icons

çŠ¶æ€ç®¡ç†:
  - Zustand (å…¨å±€çŠ¶æ€)
  - TanStack Query v5 (æœåŠ¡ç«¯çŠ¶æ€)

ç”»å¸ƒå¼•æ“:
  - React Flow v12 (å·¥ä½œæµç¼–è¾‘å™¨)
  - dagre (è‡ªåŠ¨å¸ƒå±€ç®—æ³•)

ä»£ç ç¼–è¾‘:
  - Monaco Editor (ä»£ç èŠ‚ç‚¹)

å·¥ç¨‹åŒ–:
  - ESLint + Prettier
  - Vitest (å•å…ƒæµ‹è¯•)
  - Playwright (E2Eæµ‹è¯•)
```

### 2.2 åç«¯æŠ€æœ¯æ ˆ

```yaml
æ¡†æ¶:
  - Go 1.22+
  - Echo v4 (HTTPæ¡†æ¶)

æ•°æ®åº“:
  - PostgreSQL 16 (ä¸»æ•°æ®åº“)
  - Redis 7 (ç¼“å­˜/æ¶ˆæ¯é˜Ÿåˆ—)
  - SQLite (æœ¬åœ°æ¨¡å¼)

ORM & è¿ç§»:
  - GORM v2
  - golang-migrate

è®¤è¯:
  - JWT (github.com/golang-jwt/jwt/v5)
  - OAuth2 (ç¬¬ä¸‰æ–¹ç™»å½•)

ä»»åŠ¡é˜Ÿåˆ—:
  - Asynq (Redis-based)

APIæ–‡æ¡£:
  - Swagger/OpenAPI 3.0 (swaggo/swag)

æ—¥å¿—:
  - Zap (uber-go/zap)

é…ç½®ç®¡ç†:
  - Viper
```

### 2.3 åŸºç¡€è®¾æ–½

```yaml
å®¹å™¨åŒ–:
  - Docker + Docker Compose

CI/CD:
  - GitHub Actions

ç›‘æ§:
  - Prometheus + Grafana
  - Sentry (é”™è¯¯è¿½è¸ª)

äº‘æœåŠ¡:
  - Vercel (å‰ç«¯éƒ¨ç½²)
  - Railway / Fly.io (åç«¯éƒ¨ç½²)
  - Cloudflare R2 (å¯¹è±¡å­˜å‚¨)
  - Neon / Supabase (æ‰˜ç®¡PostgreSQL)
  - Upstash (æ‰˜ç®¡Redis)
```

---

## 3. é¡¹ç›®ç»“æ„

### 3.1 æ•´ä½“ç›®å½•ç»“æ„

```
reverseai/
â”œâ”€â”€ frontend/                 # Next.js å‰ç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ app/              # App Router é¡µé¢
â”‚   â”‚   â”œâ”€â”€ components/       # ç»„ä»¶åº“
â”‚   â”‚   â”œâ”€â”€ hooks/            # è‡ªå®šä¹‰ Hooks
â”‚   â”‚   â”œâ”€â”€ lib/              # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ stores/           # Zustand çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ types/            # TypeScript ç±»å‹
â”‚   â”‚   â””â”€â”€ styles/           # å…¨å±€æ ·å¼
â”‚   â”œâ”€â”€ public/               # é™æ€èµ„æº
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ next.config.ts
â”‚
â”œâ”€â”€ backend/                  # Golang åç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ cmd/
â”‚   â”‚   â””â”€â”€ server/           # ä¸»å…¥å£
â”‚   â”œâ”€â”€ internal/
â”‚   â”‚   â”œâ”€â”€ api/              # HTTP å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ config/           # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ domain/           # é¢†åŸŸæ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ middleware/       # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ repository/       # æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â”œâ”€â”€ service/          # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â””â”€â”€ pkg/              # å†…éƒ¨å·¥å…·åŒ…
â”‚   â”œâ”€â”€ migrations/           # æ•°æ®åº“è¿ç§»
â”‚   â”œâ”€â”€ go.mod
â”‚   â””â”€â”€ go.sum
â”‚
â”œâ”€â”€ docs/                     # æ–‡æ¡£
â”‚   â”œâ”€â”€ PRD.md
â”‚   â”œâ”€â”€ DEVELOPMENT.md
â”‚   â””â”€â”€ API.md
â”‚
â”œâ”€â”€ docker/                   # Docker é…ç½®
â”‚   â”œâ”€â”€ Dockerfile.frontend
â”‚   â”œâ”€â”€ Dockerfile.backend
â”‚   â””â”€â”€ docker-compose.yml
â”‚
â””â”€â”€ scripts/                  # è„šæœ¬å·¥å…·
    â”œâ”€â”€ setup.sh
    â””â”€â”€ migrate.sh
```

### 3.2 å‰ç«¯ç›®å½•è¯¦ç»†ç»“æ„

```
frontend/src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ (auth)/               # è®¤è¯ç›¸å…³é¡µé¢ç»„
â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”œâ”€â”€ register/
â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”œâ”€â”€ (dashboard)/          # ä¸»åº”ç”¨é¡µé¢ç»„
â”‚   â”‚   â”œâ”€â”€ workflows/
â”‚   â”‚   â”œâ”€â”€ agents/
â”‚   â”‚   â”œâ”€â”€ store/
â”‚   â”‚   â”œâ”€â”€ settings/
â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”œâ”€â”€ editor/[id]/          # å·¥ä½œæµç¼–è¾‘å™¨
â”‚   â”œâ”€â”€ api/                   # API Routes (BFF)
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”œâ”€â”€ page.tsx
â”‚   â””â”€â”€ globals.css
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/                   # shadcn/ui åŸºç¡€ç»„ä»¶
â”‚   â”œâ”€â”€ layout/               # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx
â”‚   â”‚   â””â”€â”€ Footer.tsx
â”‚   â”œâ”€â”€ workflow/             # å·¥ä½œæµç›¸å…³ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Canvas.tsx
â”‚   â”‚   â”œâ”€â”€ NodePanel.tsx
â”‚   â”‚   â”œâ”€â”€ ConfigPanel.tsx
â”‚   â”‚   â””â”€â”€ nodes/            # è‡ªå®šä¹‰èŠ‚ç‚¹ç»„ä»¶
â”‚   â”œâ”€â”€ agent/                # Agent å•†åº—ç»„ä»¶
â”‚   â””â”€â”€ shared/               # é€šç”¨ç»„ä»¶
â”‚
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useWorkflow.ts
â”‚   â”œâ”€â”€ useExecution.ts
â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â””â”€â”€ useWebSocket.ts
â”‚
â”œâ”€â”€ stores/
â”‚   â”œâ”€â”€ workflowStore.ts
â”‚   â”œâ”€â”€ userStore.ts
â”‚   â””â”€â”€ uiStore.ts
â”‚
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ api.ts                # API å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ utils.ts              # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ constants.ts          # å¸¸é‡å®šä¹‰
â”‚
â””â”€â”€ types/
    â”œâ”€â”€ workflow.ts
    â”œâ”€â”€ node.ts
    â”œâ”€â”€ user.ts
    â””â”€â”€ api.ts
```

### 3.3 åç«¯ç›®å½•è¯¦ç»†ç»“æ„

```
backend/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ server/
â”‚       â””â”€â”€ main.go           # ä¸»å…¥å£
â”‚
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ handler/          # HTTP å¤„ç†å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.go
â”‚   â”‚   â”‚   â”œâ”€â”€ workflow.go
â”‚   â”‚   â”‚   â”œâ”€â”€ execution.go
â”‚   â”‚   â”‚   â”œâ”€â”€ agent.go
â”‚   â”‚   â”‚   â””â”€â”€ user.go
â”‚   â”‚   â”œâ”€â”€ middleware/       # ä¸­é—´ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.go
â”‚   â”‚   â”‚   â”œâ”€â”€ cors.go
â”‚   â”‚   â”‚   â”œâ”€â”€ ratelimit.go
â”‚   â”‚   â”‚   â””â”€â”€ logger.go
â”‚   â”‚   â”œâ”€â”€ request/          # è¯·æ±‚ç»“æ„ä½“
â”‚   â”‚   â”œâ”€â”€ response/         # å“åº”ç»“æ„ä½“
â”‚   â”‚   â””â”€â”€ router.go         # è·¯ç”±å®šä¹‰
â”‚   â”‚
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ config.go         # é…ç½®ç»“æ„
â”‚   â”‚
â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”œâ”€â”€ entity/           # å®ä½“å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ user.go
â”‚   â”‚   â”‚   â”œâ”€â”€ workflow.go
â”‚   â”‚   â”‚   â”œâ”€â”€ execution.go
â”‚   â”‚   â”‚   â””â”€â”€ agent.go
â”‚   â”‚   â””â”€â”€ valueobject/      # å€¼å¯¹è±¡
â”‚   â”‚
â”‚   â”œâ”€â”€ repository/
â”‚   â”‚   â”œâ”€â”€ interface.go      # ä»“å‚¨æ¥å£
â”‚   â”‚   â”œâ”€â”€ user_repo.go
â”‚   â”‚   â”œâ”€â”€ workflow_repo.go
â”‚   â”‚   â”œâ”€â”€ execution_repo.go
â”‚   â”‚   â””â”€â”€ agent_repo.go
â”‚   â”‚
â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â”œâ”€â”€ auth_service.go
â”‚   â”‚   â”œâ”€â”€ workflow_service.go
â”‚   â”‚   â”œâ”€â”€ execution_service.go
â”‚   â”‚   â”œâ”€â”€ agent_service.go
â”‚   â”‚   â””â”€â”€ ai_service.go
â”‚   â”‚
â”‚   â””â”€â”€ pkg/
â”‚       â”œâ”€â”€ database/         # æ•°æ®åº“è¿æ¥
â”‚       â”œâ”€â”€ redis/            # Redis å®¢æˆ·ç«¯
â”‚       â”œâ”€â”€ jwt/              # JWT å·¥å…·
â”‚       â”œâ”€â”€ validator/        # éªŒè¯å™¨
â”‚       â””â”€â”€ executor/         # å·¥ä½œæµæ‰§è¡Œå¼•æ“
â”‚
â”œâ”€â”€ migrations/
â”‚   â”œâ”€â”€ 000001_init_schema.up.sql
â”‚   â””â”€â”€ 000001_init_schema.down.sql
â”‚
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ swagger/              # Swagger æ–‡æ¡£
â”‚
â””â”€â”€ config/
    â”œâ”€â”€ config.yaml           # é»˜è®¤é…ç½®
    â””â”€â”€ config.example.yaml   # é…ç½®ç¤ºä¾‹
```

---

## 4. å¼€å‘ç¯å¢ƒæ­å»º

### 4.1 å‰ç½®è¦æ±‚

```bash
# å¿…éœ€è½¯ä»¶
- Node.js >= 20.x
- pnpm >= 9.x (æ¨è) æˆ– npm >= 10.x
- Go >= 1.22
- PostgreSQL >= 16
- Redis >= 7
- Docker & Docker Compose (å¯é€‰)

# æ¨è IDE
- VS Code / Cursor
  - æ‰©å±•: ESLint, Prettier, Go, Tailwind CSS IntelliSense
```

### 4.2 å¿«é€Ÿå¼€å§‹

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/your-org/reverseai.git
cd reverseai

# 2. å®‰è£…å‰ç«¯ä¾èµ–
cd frontend
pnpm install

# 3. å®‰è£…åç«¯ä¾èµ–
cd ../backend
go mod download

# 4. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®æ•°æ®åº“è¿æ¥ç­‰

# 5. å¯åŠ¨æ•°æ®åº“ (Docker)
docker-compose up -d postgres redis

# 6. è¿è¡Œæ•°æ®åº“è¿ç§»
go run cmd/migrate/main.go up

# 7. å¯åŠ¨åç«¯æœåŠ¡
go run cmd/server/main.go

# 8. å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨ (æ–°ç»ˆç«¯)
cd frontend
pnpm dev
```

### 4.3 ç¯å¢ƒå˜é‡é…ç½®

#### å‰ç«¯ (.env.local)

```env
# API åœ°å€
NEXT_PUBLIC_API_URL=http://localhost:8080/api/v1
NEXT_PUBLIC_WS_URL=ws://localhost:8080/ws

# è®¤è¯
NEXT_PUBLIC_GITHUB_CLIENT_ID=xxx
NEXT_PUBLIC_GOOGLE_CLIENT_ID=xxx

# åŠŸèƒ½å¼€å…³
NEXT_PUBLIC_ENABLE_LOCAL_MODE=true
```

#### åç«¯ (config.yaml)

```yaml
server:
  port: 8080
  mode: development # development | production

database:
  host: localhost
  port: 5432
  user: postgres
  password: postgres
  name: reverseai
  ssl_mode: disable

redis:
  host: localhost
  port: 6379
  password: ''
  db: 0

jwt:
  secret: your-jwt-secret-key
  access_token_expire: 15m
  refresh_token_expire: 168h # 7 days

ai:
  openai_api_key: ${OPENAI_API_KEY}
  anthropic_api_key: ${ANTHROPIC_API_KEY}
  default_model: gpt-4
```

---

## 5. å¼€å‘é˜¶æ®µè§„åˆ’

### 5.1 Phase 1: æ ¸å¿ƒ MVP (Q1 2026)

**ç›®æ ‡**: å¯ç”¨çš„å·¥ä½œæµç¼–è¾‘å™¨å’Œæ‰§è¡Œå¼•æ“

| å‘¨æ¬¡   | é‡Œç¨‹ç¢‘     | äº¤ä»˜ç‰©                      |
| ------ | ---------- | --------------------------- |
| W1-2   | é¡¹ç›®å¯åŠ¨   | æŠ€æœ¯é€‰å‹ã€å¼€å‘ç¯å¢ƒã€CI/CD   |
| W3-4   | ç¼–è¾‘å™¨åŸºç¡€ | ç”»å¸ƒã€èŠ‚ç‚¹æ‹–æ‹½ã€è¿çº¿        |
| W5-6   | åŸºç¡€èŠ‚ç‚¹   | LLMã€HTTPã€æ¡ä»¶ã€å¾ªç¯èŠ‚ç‚¹   |
| W7-8   | æ‰§è¡Œå¼•æ“   | ä»»åŠ¡è°ƒåº¦ã€çŠ¶æ€ç®¡ç†          |
| W9-10  | ç”¨æˆ·ç³»ç»Ÿ   | æ³¨å†Œç™»å½•ã€å·¥ä½œæµç®¡ç†        |
| W11-12 | æ‰“ç£¨ä¼˜åŒ–   | Bugä¿®å¤ã€æ€§èƒ½ä¼˜åŒ–ã€å†…æµ‹å‘å¸ƒ |

### 5.2 Phase 2: è‡ªå®šä¹‰èƒ½åŠ› (Q2 2026)

**ç›®æ ‡**: å¼€æ”¾è‡ªå®šä¹‰èƒ½åŠ›ï¼Œå¸å¼•å¼€å‘è€…

| å‘¨æ¬¡   | é‡Œç¨‹ç¢‘   | äº¤ä»˜ç‰©                 |
| ------ | -------- | ---------------------- |
| W1-3   | èŠ‚ç‚¹SDK  | SDKè®¾è®¡ã€å¼€å‘è€…æ–‡æ¡£    |
| W4-6   | æ’ä»¶ç³»ç»Ÿ | åŠ è½½å™¨ã€æ²™ç®±ã€åŸºç¡€å¸‚åœº |
| W7-8   | æœ¬åœ°æ¨¡å¼ | æ¡Œé¢åº”ç”¨ã€æœ¬åœ°LLMé›†æˆ  |
| W9-10  | è°ƒè¯•å·¥å…· | æ–­ç‚¹ã€æ—¥å¿—ã€æ€§èƒ½åˆ†æ   |
| W11-12 | å…¬æµ‹å‘å¸ƒ | å…¬æµ‹ã€åé¦ˆæ”¶é›†ã€è¿­ä»£   |

### 5.3 Phase 3: ç¤¾åŒºç”Ÿæ€ (Q3 2026)

**ç›®æ ‡**: å»ºç«‹ç¤¾åŒºé£è½®ï¼Œå®ç°æœ‰æœºå¢é•¿

| å‘¨æ¬¡   | é‡Œç¨‹ç¢‘     | äº¤ä»˜ç‰©                   |
| ------ | ---------- | ------------------------ |
| W1-3   | Agentå•†åº—  | å‘å¸ƒæµç¨‹ã€å®¡æ ¸ç³»ç»Ÿ       |
| W4-6   | åˆ†äº«æœºåˆ¶   | é“¾æ¥åˆ†äº«ã€åµŒå…¥é¢„è§ˆã€Fork |
| W7-9   | åˆ›ä½œè€…ç»æµ | æ”¯ä»˜ç³»ç»Ÿã€åˆ†æˆç»“ç®—       |
| W10-12 | æ­£å¼å‘å¸ƒ   | å…¨é‡ä¸Šçº¿ã€è¿è¥æ´»åŠ¨       |

### 5.4 Phase 4: è§„æ¨¡åŒ– (Q4 2026)

**ç›®æ ‡**: å•†ä¸šåŒ–å˜ç°ï¼Œä¼ä¸šå¸‚åœºæ‹“å±•

| å‘¨æ¬¡  | é‡Œç¨‹ç¢‘   | äº¤ä»˜ç‰©              |
| ----- | -------- | ------------------- |
| W1-4  | ä¼ä¸šç‰ˆ   | ç§æœ‰éƒ¨ç½²ã€SSOã€å®¡è®¡ |
| W5-8  | å›¢é˜Ÿåä½œ | å¤šäººåä½œã€æƒé™ç®¡ç†  |
| W9-12 | é«˜çº§åŠŸèƒ½ | åˆ†æã€ç›‘æ§ã€ä¼˜åŒ–    |

---

## 6. TodoList ä»»åŠ¡æ¸…å•

> ğŸ“‹ **è¯´æ˜**ï¼šæœ¬ä»»åŠ¡æ¸…å•é‡‡ç”¨è¯¦ç»†çš„ä»»åŠ¡åˆ†è§£æ–¹å¼ï¼Œæ¯ä¸ªä»»åŠ¡åŒ…å«éªŒæ”¶æ ‡å‡†ã€ä¾èµ–å…³ç³»ã€ä¼˜å…ˆçº§å’ŒæŠ€æœ¯è¦ç‚¹ã€‚
>
> **ä¼˜å…ˆçº§è¯´æ˜**ï¼šğŸ”´ P0 (é˜»å¡çº§) | ğŸŸ  P1 (é«˜ä¼˜å…ˆ) | ğŸŸ¡ P2 (ä¸­ä¼˜å…ˆ) | ğŸŸ¢ P3 (ä½ä¼˜å…ˆ)
>
> **çŠ¶æ€è¯´æ˜**ï¼šâ¬œ æœªå¼€å§‹ | ğŸ”„ è¿›è¡Œä¸­ | âœ… å·²å®Œæˆ | â¸ï¸ æš‚åœ | âŒ å–æ¶ˆ

---

### 6.1 Phase 1: æ ¸å¿ƒ MVP (W1-12)

#### 6.1.1 é¡¹ç›®åˆå§‹åŒ– (W1-2)

##### å‰ç«¯åˆå§‹åŒ–

| ID     | ä»»åŠ¡                              | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ–   | ä¼°æ—¶ |
| ------ | --------------------------------- | ------ | ---- | ------ | ---- |
| FE-001 | åˆ›å»º Next.js 16 é¡¹ç›® (App Router) | ğŸ”´ P0  | âœ…   | -      | 2h   |
| FE-002 | é…ç½® TypeScript å’Œè·¯å¾„åˆ«å        | ğŸ”´ P0  | âœ…   | FE-001 | 1h   |
| FE-003 | å®‰è£…é…ç½® Tailwind CSS 4.x         | ğŸ”´ P0  | âœ…   | FE-001 | 1h   |
| FE-004 | å®‰è£…é…ç½® shadcn/ui ç»„ä»¶åº“         | ğŸŸ  P1  | âœ…   | FE-003 | 2h   |
| FE-005 | é…ç½® ESLint + Prettier            | ğŸŸ  P1  | âœ…   | FE-002 | 1h   |
| FE-006 | å®‰è£…é…ç½® Zustand çŠ¶æ€ç®¡ç†         | ğŸŸ  P1  | âœ…   | FE-001 | 2h   |
| FE-007 | å®‰è£…é…ç½® TanStack Query           | ğŸŸ  P1  | âœ…   | FE-001 | 2h   |
| FE-008 | åˆ›å»ºåŸºç¡€ç›®å½•ç»“æ„                  | ğŸ”´ P0  | âœ…   | FE-001 | 1h   |
| FE-009 | é…ç½®ç¯å¢ƒå˜é‡                      | ğŸŸ  P1  | âœ…   | FE-001 | 1h   |
| FE-010 | ç¼–å†™ API å®¢æˆ·ç«¯å°è£…               | ğŸŸ  P1  | âœ…   | FE-007 | 4h   |

**è¯¦ç»†ä»»åŠ¡è¯´æ˜ï¼š**

- [x] **FE-001: åˆ›å»º Next.js 16 é¡¹ç›®** ğŸ”´ P0 âœ…
  - **å‘½ä»¤**: `pnpm create next-app@canary reverseai-web --typescript --app --tailwind`
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ é¡¹ç›®å¯æ­£å¸¸å¯åŠ¨ `pnpm dev`
    - âœ“ ä½¿ç”¨ App Router æ¶æ„
    - âœ“ TypeScript ä¸¥æ ¼æ¨¡å¼å¼€å¯
  - **æŠ€æœ¯è¦ç‚¹**:
    - Next.js 16 ä½¿ç”¨ React 19
    - å¯ç”¨ Turbopack åŠ é€Ÿå¼€å‘æ„å»º
    - é…ç½® `next.config.ts` æ”¯æŒå›¾ç‰‡åŸŸåç™½åå•

- [x] **FE-002: é…ç½® TypeScript å’Œè·¯å¾„åˆ«å** ğŸ”´ P0 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ `@/*` åˆ«åæŒ‡å‘ `src/*`
    - âœ“ `@components/*` æŒ‡å‘ç»„ä»¶ç›®å½•
    - âœ“ ä¸¥æ ¼ç±»å‹æ£€æŸ¥ `strict: true`
  - **é…ç½®æ–‡ä»¶**: `tsconfig.json`

  ```json
  {
    "compilerOptions": {
      "paths": {
        "@/*": ["./src/*"],
        "@components/*": ["./src/components/*"],
        "@lib/*": ["./src/lib/*"],
        "@hooks/*": ["./src/hooks/*"],
        "@stores/*": ["./src/stores/*"],
        "@types/*": ["./src/types/*"]
      }
    }
  }
  ```

- [x] **FE-003: å®‰è£…é…ç½® Tailwind CSS 4.x** ğŸ”´ P0 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ Tailwind v4 æ­£ç¡®å®‰è£…
    - âœ“ ä¸»é¢˜è‰²å˜é‡é…ç½®å®Œæˆ
    - âœ“ æš—è‰²æ¨¡å¼æ”¯æŒ
  - **æŠ€æœ¯è¦ç‚¹**:
    - Tailwind v4 ä½¿ç”¨æ–°çš„é…ç½®æ–¹å¼ (CSS-first)
    - é…ç½® CSS å˜é‡å®ç°ä¸»é¢˜åˆ‡æ¢
    - é›†æˆ tailwind-merge å’Œ clsx

- [x] **FE-004: å®‰è£…é…ç½® shadcn/ui ç»„ä»¶åº“** ğŸŸ  P1 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ shadcn/ui CLI åˆå§‹åŒ–å®Œæˆ
    - âœ“ åŸºç¡€ç»„ä»¶å®‰è£…: Button, Input, Dialog, Toast, DropdownMenu
    - âœ“ ç»„ä»¶æ ·å¼ä¸è®¾è®¡ç³»ç»Ÿä¸€è‡´
  - **å‘½ä»¤**: `pnpm dlx shadcn@latest init`
  - **éœ€å®‰è£…ç»„ä»¶**:
    - é€šç”¨: Button, Badge, Avatar, Skeleton
    - è¡¨å•: Input, Textarea, Select, Checkbox, Switch, Form
    - åé¦ˆ: Toast, Dialog, AlertDialog, Tooltip
    - å¯¼èˆª: Tabs, DropdownMenu, Command, Menubar
    - å¸ƒå±€: Card, Separator, ScrollArea, Sheet

- [x] **FE-005: é…ç½® ESLint + Prettier** ğŸŸ  P1 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ ESLint è§„åˆ™é…ç½®å®Œæˆ
    - âœ“ Prettier æ ¼å¼åŒ–é…ç½®å®Œæˆ
    - âœ“ VS Code ä¿å­˜æ—¶è‡ªåŠ¨æ ¼å¼åŒ–
    - âœ“ Git pre-commit hook é…ç½® (lint-staged)
  - **ä¾èµ–**: `eslint`, `prettier`, `eslint-config-next`, `@typescript-eslint/*`, `husky`, `lint-staged`

- [x] **FE-006: å®‰è£…é…ç½® Zustand çŠ¶æ€ç®¡ç†** ğŸŸ  P1 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ Zustand store ç›®å½•ç»“æ„å»ºç«‹
    - âœ“ æŒä¹…åŒ–ä¸­é—´ä»¶é…ç½® (zustand/middleware)
    - âœ“ DevTools é›†æˆ
  - **Store ç»“æ„**:
    ```
    src/stores/
    â”œâ”€â”€ useAuthStore.ts      # ç”¨æˆ·è®¤è¯çŠ¶æ€
    â”œâ”€â”€ useEditorStore.ts    # ç¼–è¾‘å™¨çŠ¶æ€
    â”œâ”€â”€ useWorkflowStore.ts  # å·¥ä½œæµæ•°æ®
    â””â”€â”€ useUIStore.ts        # UI çŠ¶æ€ (ä¸»é¢˜ã€ä¾§è¾¹æ ç­‰)
    ```

- [x] **FE-007: å®‰è£…é…ç½® TanStack Query** ğŸŸ  P1 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ QueryClientProvider é…ç½®
    - âœ“ é»˜è®¤é…ç½®: staleTime, cacheTime, retry
    - âœ“ DevTools é›†æˆ (å¼€å‘ç¯å¢ƒ)
    - âœ“ é”™è¯¯è¾¹ç•Œå¤„ç†
  - **æŠ€æœ¯è¦ç‚¹**:
    - é…ç½®å…¨å±€é”™è¯¯å¤„ç†
    - é…ç½®è¯·æ±‚é‡è¯•ç­–ç•¥
    - é›†æˆ Suspense æ¨¡å¼

- [x] **FE-008: åˆ›å»ºåŸºç¡€ç›®å½•ç»“æ„** ğŸ”´ P0 âœ…
  - **éªŒæ”¶æ ‡å‡†**: ç›®å½•ç»“æ„ç¬¦åˆè§„èŒƒ
  - **ç›®å½•ç»“æ„**:
    ```
    src/
    â”œâ”€â”€ app/                    # Next.js App Router é¡µé¢
    â”‚   â”œâ”€â”€ (auth)/            # è®¤è¯ç›¸å…³é¡µé¢ç»„
    â”‚   â”œâ”€â”€ (dashboard)/       # ä¸»åº”ç”¨é¡µé¢ç»„
    â”‚   â”œâ”€â”€ api/               # API Routes
    â”‚   â””â”€â”€ layout.tsx
    â”œâ”€â”€ components/
    â”‚   â”œâ”€â”€ ui/                # shadcn/ui ç»„ä»¶
    â”‚   â”œâ”€â”€ editor/            # ç¼–è¾‘å™¨ç»„ä»¶
    â”‚   â”œâ”€â”€ workflow/          # å·¥ä½œæµç»„ä»¶
    â”‚   â””â”€â”€ shared/            # é€šç”¨ä¸šåŠ¡ç»„ä»¶
    â”œâ”€â”€ hooks/                 # è‡ªå®šä¹‰ Hooks
    â”œâ”€â”€ lib/                   # å·¥å…·å‡½æ•°
    â”œâ”€â”€ stores/                # Zustand stores
    â”œâ”€â”€ types/                 # TypeScript ç±»å‹
    â””â”€â”€ styles/                # å…¨å±€æ ·å¼
    ```

- [x] **FE-009: é…ç½®ç¯å¢ƒå˜é‡** ğŸŸ  P1 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ `.env.local` æ¨¡æ¿åˆ›å»º
    - âœ“ `.env.example` ç¤ºä¾‹æ–‡ä»¶
    - âœ“ ç±»å‹å®‰å…¨çš„ç¯å¢ƒå˜é‡è®¿é—®
  - **ç¯å¢ƒå˜é‡**:

    ```env
    # API
    NEXT_PUBLIC_API_URL=http://localhost:8080/api/v1
    NEXT_PUBLIC_WS_URL=ws://localhost:8080/ws

    # Auth
    NEXT_PUBLIC_GITHUB_CLIENT_ID=
    NEXT_PUBLIC_GOOGLE_CLIENT_ID=

    # Feature Flags
    NEXT_PUBLIC_ENABLE_LOCAL_MODE=true
    ```

- [x] **FE-010: ç¼–å†™ API å®¢æˆ·ç«¯å°è£…** ğŸŸ  P1 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ åŸºäº fetch çš„è¯·æ±‚å°è£…
    - âœ“ è‡ªåŠ¨æºå¸¦ Authorization header
    - âœ“ ç»Ÿä¸€é”™è¯¯å¤„ç†
    - âœ“ è¯·æ±‚/å“åº”æ‹¦æˆªå™¨
    - âœ“ TypeScript ç±»å‹å®Œå–„
  - **åŠŸèƒ½è¦æ±‚**:
    - Token è‡ªåŠ¨åˆ·æ–°
    - è¯·æ±‚å–æ¶ˆæ”¯æŒ (AbortController)
    - è¯·æ±‚é‡è¯•æœºåˆ¶
    - è¯·æ±‚æ—¥å¿— (å¼€å‘ç¯å¢ƒ)

---

##### åç«¯åˆå§‹åŒ–

| ID     | ä»»åŠ¡                   | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ–   | ä¼°æ—¶ |
| ------ | ---------------------- | ------ | ---- | ------ | ---- |
| BE-001 | åˆ›å»º Go é¡¹ç›®ç»“æ„       | ğŸ”´ P0  | âœ…   | -      | 2h   |
| BE-002 | é…ç½® Echo æ¡†æ¶         | ğŸ”´ P0  | âœ…   | BE-001 | 2h   |
| BE-003 | é…ç½® GORM å’Œæ•°æ®åº“è¿æ¥ | ğŸ”´ P0  | âœ…   | BE-001 | 3h   |
| BE-004 | é…ç½® Redis å®¢æˆ·ç«¯      | ğŸŸ  P1  | âœ…   | BE-001 | 2h   |
| BE-005 | é…ç½® JWT è®¤è¯          | ğŸ”´ P0  | âœ…   | BE-002 | 3h   |
| BE-006 | é…ç½®æ—¥å¿—ç³»ç»Ÿ (Zap)     | ğŸŸ  P1  | âœ…   | BE-001 | 2h   |
| BE-007 | é…ç½® Swagger æ–‡æ¡£      | ğŸŸ¡ P2  | âœ…   | BE-002 | 2h   |
| BE-008 | åˆ›å»ºåŸºç¡€ç›®å½•ç»“æ„       | ğŸ”´ P0  | âœ…   | BE-001 | 1h   |
| BE-009 | ç¼–å†™é…ç½®ç®¡ç† (Viper)   | ğŸŸ  P1  | âœ…   | BE-001 | 2h   |
| BE-010 | åˆ›å»ºæ•°æ®åº“è¿ç§»å·¥å…·     | ğŸŸ  P1  | âœ…   | BE-003 | 3h   |

**è¯¦ç»†ä»»åŠ¡è¯´æ˜ï¼š**

- [x] **BE-001: åˆ›å»º Go é¡¹ç›®ç»“æ„** ğŸ”´ P0 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ `go mod init` å®Œæˆ
    - âœ“ ç›®å½•ç»“æ„ç¬¦åˆ Clean Architecture
    - âœ“ Makefile ç¼–å†™å®Œæˆ
  - **ç›®å½•ç»“æ„**:
    ```
    reverseai-server/
    â”œâ”€â”€ cmd/
    â”‚   â”œâ”€â”€ server/main.go     # ä¸»æœåŠ¡å…¥å£
    â”‚   â””â”€â”€ migrate/main.go    # è¿ç§»å·¥å…·
    â”œâ”€â”€ internal/
    â”‚   â”œâ”€â”€ config/            # é…ç½®
    â”‚   â”œâ”€â”€ domain/            # é¢†åŸŸæ¨¡å‹
    â”‚   â”œâ”€â”€ handler/           # HTTP å¤„ç†å™¨
    â”‚   â”œâ”€â”€ middleware/        # ä¸­é—´ä»¶
    â”‚   â”œâ”€â”€ repository/        # æ•°æ®è®¿é—®å±‚
    â”‚   â”œâ”€â”€ service/           # ä¸šåŠ¡é€»è¾‘å±‚
    â”‚   â””â”€â”€ pkg/               # å†…éƒ¨é€šç”¨åŒ…
    â”œâ”€â”€ pkg/                   # å¯å¯¼å‡ºçš„å…¬å…±åŒ…
    â”œâ”€â”€ migrations/            # æ•°æ®åº“è¿ç§»æ–‡ä»¶
    â”œâ”€â”€ docs/                  # Swagger æ–‡æ¡£
    â””â”€â”€ scripts/               # è„šæœ¬
    ```

- [x] **BE-002: é…ç½® Echo æ¡†æ¶** ğŸ”´ P0 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ Echo å®ä¾‹åˆå§‹åŒ–
    - âœ“ è·¯ç”±åˆ†ç»„é…ç½®
    - âœ“ CORS ä¸­é—´ä»¶é…ç½®
    - âœ“ Recovery ä¸­é—´ä»¶é…ç½®
    - âœ“ Request ID ä¸­é—´ä»¶
    - âœ“ è¯·æ±‚æ—¥å¿—ä¸­é—´ä»¶
  - **æŠ€æœ¯è¦ç‚¹**:
    - ä½¿ç”¨ Echo v4
    - é…ç½®ä¼˜é›…å…³é—­ (Graceful Shutdown)
    - é…ç½®è¯·æ±‚è¶…æ—¶

- [x] **BE-003: é…ç½® GORM å’Œæ•°æ®åº“è¿æ¥** ğŸ”´ P0 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ PostgreSQL è¿æ¥é…ç½®
    - âœ“ è¿æ¥æ± é…ç½® (MaxOpenConns, MaxIdleConns)
    - âœ“ æ…¢æŸ¥è¯¢æ—¥å¿—
    - âœ“ æ•°æ®åº“å¥åº·æ£€æŸ¥ç«¯ç‚¹
  - **é…ç½®ç¤ºä¾‹**:
    ```go
    db, err := gorm.Open(postgres.Open(dsn), &gorm.Config{
        Logger: logger.Default.LogMode(logger.Info),
        NamingStrategy: schema.NamingStrategy{
            TablePrefix:   "af_",
            SingularTable: true,
        },
    })
    sqlDB, _ := db.DB()
    sqlDB.SetMaxOpenConns(100)
    sqlDB.SetMaxIdleConns(10)
    sqlDB.SetConnMaxLifetime(time.Hour)
    ```

- [x] **BE-004: é…ç½® Redis å®¢æˆ·ç«¯** ğŸŸ  P1 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ go-redis/v9 å®¢æˆ·ç«¯é…ç½®
    - âœ“ è¿æ¥æ± é…ç½®
    - âœ“ å¥åº·æ£€æŸ¥
    - âœ“ å°è£…å¸¸ç”¨æ“ä½œ (Get/Set/Del/Expire)
  - **ç”¨é€”**:
    - Session å­˜å‚¨
    - ç¼“å­˜å±‚
    - åˆ†å¸ƒå¼é”
    - ä»»åŠ¡é˜Ÿåˆ— (Asynq)

- [x] **BE-005: é…ç½® JWT è®¤è¯** ğŸ”´ P0 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ Access Token ç”Ÿæˆå’ŒéªŒè¯
    - âœ“ Refresh Token æœºåˆ¶
    - âœ“ Token é»‘åå• (ç™»å‡º)
    - âœ“ JWT ä¸­é—´ä»¶
  - **Token é…ç½®**:
    - Access Token: æœ‰æ•ˆæœŸ 15 åˆ†é’Ÿ
    - Refresh Token: æœ‰æ•ˆæœŸ 7 å¤©
    - ç­¾åç®—æ³•: HS256 æˆ– RS256

- [x] **BE-006: é…ç½®æ—¥å¿—ç³»ç»Ÿ (Zap)** ğŸŸ  P1 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ Zap logger åˆå§‹åŒ–
    - âœ“ æ—¥å¿—çº§åˆ«é…ç½® (å¼€å‘/ç”Ÿäº§)
    - âœ“ ç»“æ„åŒ–æ—¥å¿—è¾“å‡º
    - âœ“ æ—¥å¿—æ–‡ä»¶è½®è½¬ (lumberjack)
    - âœ“ è¯·æ±‚æ—¥å¿—æ ¼å¼ç»Ÿä¸€

- [x] **BE-007: é…ç½® Swagger æ–‡æ¡£** ğŸŸ¡ P2 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ swaggo/swag é›†æˆ
    - âœ“ API æ³¨è§£ç¼–å†™è§„èŒƒ
    - âœ“ Swagger UI å¯è®¿é—®
  - **å‘½ä»¤**: `swag init -g cmd/server/main.go -o docs`

- [x] **BE-009: ç¼–å†™é…ç½®ç®¡ç† (Viper)** ğŸŸ  P1 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ é…ç½®æ–‡ä»¶æ”¯æŒ (YAML)
    - âœ“ ç¯å¢ƒå˜é‡è¦†ç›–
    - âœ“ é…ç½®çƒ­åŠ è½½ (å¼€å‘ç¯å¢ƒ)
  - **é…ç½®æ–‡ä»¶**: `config/config.yaml`

    ```yaml
    server:
      host: '0.0.0.0'
      port: 8080
      mode: 'development' # development/production

    database:
      host: 'localhost'
      port: 5432
      name: 'reverseai'
      user: 'postgres'
      password: ''
      sslmode: 'disable'

    redis:
      host: 'localhost'
      port: 6379
      db: 0

    jwt:
      secret: 'your-secret-key'
      access_expire: 15m
      refresh_expire: 168h
    ```

- [x] **BE-010: åˆ›å»ºæ•°æ®åº“è¿ç§»å·¥å…·** ğŸŸ  P1 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ golang-migrate é›†æˆ
    - âœ“ è¿ç§»å‘½ä»¤å°è£… (up/down/version)
    - âœ“ è¿ç§»æ–‡ä»¶å‘½åè§„èŒƒ
  - **å‘½ä»¤**:
    ```bash
    go run cmd/migrate/main.go up      # æ‰§è¡Œè¿ç§»
    go run cmd/migrate/main.go down    # å›æ»šä¸€ä¸ªç‰ˆæœ¬
    go run cmd/migrate/main.go version # æŸ¥çœ‹å½“å‰ç‰ˆæœ¬
    ```

---

##### åŸºç¡€è®¾æ–½

| ID        | ä»»åŠ¡                      | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ– | ä¼°æ—¶ |
| --------- | ------------------------- | ------ | ---- | ---- | ---- |
| INFRA-001 | é…ç½® Docker Compose       | ğŸ”´ P0  | âœ…   | -    | 2h   |
| INFRA-002 | é…ç½® GitHub Actions CI/CD | ğŸŸ  P1  | âœ…   | -    | 4h   |
| INFRA-003 | ç¼–å†™é¡¹ç›® README           | ğŸŸ¡ P2  | âœ…   | -    | 2h   |
| INFRA-004 | é…ç½®ä»£ç æäº¤è§„èŒƒ          | ğŸŸ¡ P2  | âœ…   | -    | 1h   |

**è¯¦ç»†ä»»åŠ¡è¯´æ˜ï¼š**

- [x] **INFRA-001: é…ç½® Docker Compose** ğŸ”´ P0 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ PostgreSQL æœåŠ¡é…ç½®
    - âœ“ Redis æœåŠ¡é…ç½®
    - âœ“ æ•°æ®æŒä¹…åŒ–é…ç½®
    - âœ“ ç½‘ç»œé…ç½®
  - **docker-compose.yml**:

    ```yaml
    version: '3.8'
    services:
      postgres:
        image: postgres:16-alpine
        environment:
          POSTGRES_DB: reverseai
          POSTGRES_USER: postgres
          POSTGRES_PASSWORD: postgres
        ports:
          - '5432:5432'
        volumes:
          - postgres_data:/var/lib/postgresql/data
        healthcheck:
          test: ['CMD-SHELL', 'pg_isready -U postgres']
          interval: 10s
          timeout: 5s
          retries: 5

      redis:
        image: redis:7-alpine
        ports:
          - '6379:6379'
        volumes:
          - redis_data:/data
        healthcheck:
          test: ['CMD', 'redis-cli', 'ping']
          interval: 10s
          timeout: 5s
          retries: 5

    volumes:
      postgres_data:
      redis_data:
    ```

- [x] **INFRA-002: é…ç½® GitHub Actions CI/CD** ğŸŸ  P1 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ PR æ£€æŸ¥å·¥ä½œæµ (lint, test, build)
    - âœ“ ä¸»åˆ†æ”¯éƒ¨ç½²å·¥ä½œæµ
    - âœ“ Docker é•œåƒæ„å»º
  - **å·¥ä½œæµæ–‡ä»¶**:
    - `.github/workflows/ci.yml` - PR æ£€æŸ¥
    - `.github/workflows/deploy.yml` - éƒ¨ç½²æµç¨‹

- [x] **INFRA-003: ç¼–å†™é¡¹ç›® README** ğŸŸ¡ P2 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ é¡¹ç›®ä»‹ç»
    - âœ“ å¿«é€Ÿå¼€å§‹æŒ‡å—
    - âœ“ å¼€å‘ç¯å¢ƒæ­å»º
    - âœ“ æŠ€æœ¯æ ˆè¯´æ˜
    - âœ“ è´¡çŒ®æŒ‡å—

- [x] **INFRA-004: é…ç½®ä»£ç æäº¤è§„èŒƒ** ğŸŸ¡ P2 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ commitlint é…ç½®
    - âœ“ husky pre-commit hook
    - âœ“ commit message æ¨¡æ¿
  - **æäº¤æ ¼å¼**: `<type>(<scope>): <subject>`
    - ç±»å‹: feat, fix, docs, style, refactor, test, chore

---

#### 6.1.2 å¯è§†åŒ–ç¼–è¾‘å™¨ (W3-4)

##### ç”»å¸ƒåŸºç¡€

| ID         | ä»»åŠ¡               | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ–       | ä¼°æ—¶ |
| ---------- | ------------------ | ------ | ---- | ---------- | ---- |
| CANVAS-001 | é›†æˆ React Flow åº“ | ğŸ”´ P0  | âœ…   | FE-001     | 4h   |
| CANVAS-002 | å®ç°æ— é™ç”»å¸ƒ       | ğŸ”´ P0  | âœ…   | CANVAS-001 | 4h   |
| CANVAS-003 | å®ç°ç”»å¸ƒèƒŒæ™¯ç½‘æ ¼   | ğŸŸ¡ P2  | âœ…   | CANVAS-001 | 2h   |
| CANVAS-004 | å®ç°å°åœ°å›¾ç»„ä»¶     | ğŸŸ¡ P2  | âœ…   | CANVAS-001 | 3h   |
| CANVAS-005 | å®ç°å¿«æ·é”®ç³»ç»Ÿ     | ğŸŸ  P1  | âœ…   | CANVAS-001 | 4h   |
| CANVAS-006 | å®ç°æ’¤é”€/é‡åšåŠŸèƒ½  | ğŸŸ  P1  | âœ…   | CANVAS-001 | 6h   |
| CANVAS-007 | å®ç°ç”»å¸ƒçŠ¶æ€æŒä¹…åŒ– | ğŸŸ  P1  | âœ…   | CANVAS-001 | 4h   |

**è¯¦ç»†ä»»åŠ¡è¯´æ˜ï¼š**

- [x] **CANVAS-001: é›†æˆ React Flow åº“** ğŸ”´ P0 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ @xyflow/react æ­£ç¡®å®‰è£…
    - âœ“ åŸºç¡€ç”»å¸ƒå¯æ¸²æŸ“
    - âœ“ è‡ªå®šä¹‰èŠ‚ç‚¹ç±»å‹æ³¨å†Œ
    - âœ“ è‡ªå®šä¹‰è¾¹ç±»å‹æ³¨å†Œ
  - **æŠ€æœ¯è¦ç‚¹**:
    - ä½¿ç”¨ React Flow v12+
    - é…ç½® ReactFlowProvider
    - å®ç°è‡ªå®šä¹‰æ§åˆ¶é¢æ¿
  - **å®ç°æ–‡ä»¶**: `src/components/editor/EditorCanvas.tsx`

- [x] **CANVAS-002: å®ç°æ— é™ç”»å¸ƒ** ğŸ”´ P0 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ ç¼©æ”¾èŒƒå›´: 25% - 400%
    - âœ“ å¹³ç§»æ— è¾¹ç•Œé™åˆ¶
    - âœ“ åŒæŒ‡/æ»šè½®ç¼©æ”¾æ”¯æŒ
    - âœ“ ç¼©æ”¾æ—¶ä»¥é¼ æ ‡ä½ç½®ä¸ºä¸­å¿ƒ
    - âœ“ å¹³æ»‘è¿‡æ¸¡åŠ¨ç”»
  - **æŠ€æœ¯è¦ç‚¹**:
    - é…ç½® minZoom/maxZoom
    - å®ç° fitView è‡ªé€‚åº”
    - è§¦æ§æ¿æ‰‹åŠ¿æ”¯æŒ
  - **å®ç°æ–‡ä»¶**: `src/components/editor/EditorCanvas.tsx`

- [x] **CANVAS-005: å®ç°å¿«æ·é”®ç³»ç»Ÿ** ğŸŸ  P1 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ å…¨å±€å¿«æ·é”®æ³¨å†Œ
    - âœ“ å¿«æ·é”®å†²çªæ£€æµ‹
    - âœ“ å¿«æ·é”®å¸®åŠ©é¢æ¿
  - **å¿«æ·é”®åˆ—è¡¨**:
    | å¿«æ·é”® | åŠŸèƒ½ |
    |---|---|
    | `Ctrl/Cmd + Z` | æ’¤é”€ |
    | `Ctrl/Cmd + Shift + Z` | é‡åš |
    | `Ctrl/Cmd + C` | å¤åˆ¶èŠ‚ç‚¹ |
    | `Ctrl/Cmd + V` | ç²˜è´´èŠ‚ç‚¹ |
    | `Ctrl/Cmd + D` | å¤åˆ¶é€‰ä¸­ |
    | `Delete/Backspace` | åˆ é™¤é€‰ä¸­ |
    | `Ctrl/Cmd + A` | å…¨é€‰ |
    | `Ctrl/Cmd + S` | ä¿å­˜ |
    | `Space + æ‹–æ‹½` | å¹³ç§»ç”»å¸ƒ |
    | `Ctrl/Cmd + +/-` | ç¼©æ”¾ |
    | `Ctrl/Cmd + 0` | é‡ç½®ç¼©æ”¾ |
    | `Ctrl/Cmd + 1` | é€‚åº”ç”»å¸ƒ |

- [x] **CANVAS-006: å®ç°æ’¤é”€/é‡åšåŠŸèƒ½** ğŸŸ  P1 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ å†å²è®°å½•æ ˆ (æœ€å¤š 50 æ­¥)
    - âœ“ æ”¯æŒèŠ‚ç‚¹å¢åˆ æ”¹
    - âœ“ æ”¯æŒè¿çº¿å¢åˆ 
    - âœ“ æ”¯æŒæ‰¹é‡æ“ä½œ
    - âœ“ å†å²è®°å½•å¯è§†åŒ– (å¯é€‰)
  - **æŠ€æœ¯è¦ç‚¹**:
    - ä½¿ç”¨ Immer å®ç°ä¸å¯å˜æ•°æ®
    - å®ç° Command æ¨¡å¼
    - åˆå¹¶è¿ç»­çš„åŒç±»æ“ä½œ
  - **å®ç°æ–‡ä»¶**: `src/stores/useWorkflowStore.ts`

---

##### èŠ‚ç‚¹ç³»ç»Ÿ

| ID       | ä»»åŠ¡               | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ–       | ä¼°æ—¶ |
| -------- | ------------------ | ------ | ---- | ---------- | ---- |
| NODE-001 | è®¾è®¡èŠ‚ç‚¹æ•°æ®ç»“æ„   | ğŸ”´ P0  | âœ…   | -          | 4h   |
| NODE-002 | å®ç°èŠ‚ç‚¹é¢æ¿       | ğŸ”´ P0  | âœ…   | CANVAS-001 | 6h   |
| NODE-003 | å®ç°èŠ‚ç‚¹æ‹–æ‹½åˆ°ç”»å¸ƒ | ğŸ”´ P0  | âœ…   | NODE-002   | 4h   |
| NODE-004 | å®ç°èŠ‚ç‚¹é€‰ä¸­/å¤šé€‰  | ğŸŸ  P1  | âœ…   | CANVAS-001 | 3h   |
| NODE-005 | å®ç°èŠ‚ç‚¹åˆ é™¤       | ğŸŸ  P1  | âœ…   | NODE-004   | 2h   |
| NODE-006 | å®ç°èŠ‚ç‚¹å¤åˆ¶ç²˜è´´   | ğŸŸ  P1  | âœ…   | NODE-004   | 4h   |
| NODE-007 | å®ç°èŠ‚ç‚¹åˆ†ç»„åŠŸèƒ½   | ğŸŸ¡ P2  | â¬œ   | NODE-004   | 6h   |

**è¯¦ç»†ä»»åŠ¡è¯´æ˜ï¼š**

- [x] **NODE-001: è®¾è®¡èŠ‚ç‚¹æ•°æ®ç»“æ„** ğŸ”´ P0 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ TypeScript ç±»å‹å®šä¹‰å®Œæ•´
    - âœ“ æ”¯æŒæ‰€æœ‰èŠ‚ç‚¹ç±»å‹
    - âœ“ å¯æ‰©å±•æ€§è®¾è®¡
  - **æ•°æ®ç»“æ„**:

    ```typescript
    interface WorkflowNode {
      id: string
      type: NodeType
      position: { x: number; y: number }
      data: {
        label: string
        icon?: string
        description?: string
        config: NodeConfig // èŠ‚ç‚¹ç‰¹å®šé…ç½®
        inputs: PortDefinition[]
        outputs: PortDefinition[]
      }
      selected?: boolean
      dragging?: boolean
      parentId?: string // åˆ†ç»„çˆ¶èŠ‚ç‚¹
    }

    interface PortDefinition {
      id: string
      name: string
      type: DataType
      required?: boolean
      multiple?: boolean // å…è®¸å¤šæ¡è¿çº¿
      defaultValue?: unknown
    }

    type NodeType =
      | 'llm'
      | 'http'
      | 'webhook'
      | 'condition'
      | 'loop'
      | 'parallel'
      | 'code'
      | 'template'
      | 'variable'
      | 'start'
      | 'end'
      | 'input'
      | 'output'

    type DataType = 'string' | 'number' | 'boolean' | 'object' | 'array' | 'any'
    ```

- [x] **NODE-002: å®ç°èŠ‚ç‚¹é¢æ¿** ğŸ”´ P0 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ åˆ†ç±»å±•ç¤ºæ‰€æœ‰èŠ‚ç‚¹
    - âœ“ èŠ‚ç‚¹æœç´¢åŠŸèƒ½
    - âœ“ èŠ‚ç‚¹é¢„è§ˆä¿¡æ¯
    - âœ“ å¯æŠ˜å åˆ†ç±»
  - **å®ç°æ–‡ä»¶**: `src/components/editor/NodePanel.tsx`
  - **åˆ†ç±»è®¾è®¡**:
    | åˆ†ç±» | å›¾æ ‡ | èŠ‚ç‚¹ |
    |---|---|---|
    | AI | ğŸ¤– | LLM Chat, LLM Complete, Embedding |
    | é›†æˆ | ğŸ”Œ | HTTP è¯·æ±‚, Webhook |
    | é€»è¾‘ | âš¡ | æ¡ä»¶, å¾ªç¯, å¹¶è¡Œ, å»¶è¿Ÿ, é”™è¯¯å¤„ç† |
    | æ•°æ® | ğŸ“Š | å˜é‡, è½¬æ¢, åˆå¹¶, ç­›é€‰ |
    | æ–‡æœ¬ | ğŸ“ | æ¨¡æ¿, æ­£åˆ™, åˆ†å‰²åˆå¹¶ |
    | ä»£ç  | ğŸ’» | JavaScript, è¡¨è¾¾å¼ |
    | æµç¨‹ | ğŸ”„ | å¼€å§‹, ç»“æŸ, è¾“å…¥, è¾“å‡º |

- [x] **NODE-007: å®ç°èŠ‚ç‚¹åˆ†ç»„åŠŸèƒ½** ğŸŸ¡ P2 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ åˆ›å»ºåˆ†ç»„ (Group Node)
    - âœ“ èŠ‚ç‚¹æ‹–å…¥/æ‹–å‡ºåˆ†ç»„
    - âœ“ åˆ†ç»„æŠ˜å /å±•å¼€
    - âœ“ åˆ†ç»„æ ·å¼è‡ªå®šä¹‰
  - **æŠ€æœ¯è¦ç‚¹**:
    - ä½¿ç”¨ React Flow çš„ parentId ç‰¹æ€§
    - åˆ†ç»„å¤§å°è‡ªåŠ¨è°ƒæ•´
    - åˆ†ç»„ç§»åŠ¨æ—¶å­èŠ‚ç‚¹è·Ÿéš

---

##### è¿çº¿ç³»ç»Ÿ

| ID       | ä»»åŠ¡             | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ–     | ä¼°æ—¶ |
| -------- | ---------------- | ------ | ---- | -------- | ---- |
| EDGE-001 | å®ç°èŠ‚ç‚¹ç«¯å£     | ğŸ”´ P0  | âœ…   | NODE-001 | 4h   |
| EDGE-002 | å®ç°è¿çº¿æ‹–æ‹½åˆ›å»º | ğŸ”´ P0  | âœ…   | EDGE-001 | 4h   |
| EDGE-003 | å®ç°è¿çº¿ç±»å‹æ£€æŸ¥ | ğŸŸ  P1  | âœ…   | EDGE-002 | 4h   |
| EDGE-004 | å®ç°è¿çº¿åŠ¨ç”»æ•ˆæœ | ğŸŸ¢ P3  | âœ…   | EDGE-002 | 3h   |
| EDGE-005 | å®ç°è¿çº¿æ ‡ç­¾     | ğŸŸ¡ P2  | âœ…   | EDGE-002 | 2h   |
| EDGE-006 | å®ç°è¿çº¿åˆ é™¤     | ğŸŸ  P1  | âœ…   | EDGE-002 | 2h   |

**è¯¦ç»†ä»»åŠ¡è¯´æ˜ï¼š**

- [x] **EDGE-001: å®ç°èŠ‚ç‚¹ç«¯å£** ğŸ”´ P0 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ è¾“å…¥ç«¯å£ (å·¦ä¾§)
    - âœ“ è¾“å‡ºç«¯å£ (å³ä¾§)
    - âœ“ ç«¯å£ç±»å‹é¢œè‰²åŒºåˆ†
    - âœ“ æ‚¬åœæç¤ºç«¯å£ä¿¡æ¯
    - âœ“ ç«¯å£è¿æ¥çŠ¶æ€æ˜¾ç¤º
  - **å®ç°æ–‡ä»¶**: `src/components/editor/nodes/BaseNode.tsx` åŠå„èŠ‚ç‚¹ç»„ä»¶

- [x] **EDGE-003: å®ç°è¿çº¿ç±»å‹æ£€æŸ¥** ğŸŸ  P1 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ ç›¸åŒç±»å‹å…è®¸è¿æ¥
    - âœ“ any ç±»å‹å¯è¿æ¥ä»»ä½•ç±»å‹
    - âœ“ ä¸å…¼å®¹æ—¶æ˜¾ç¤ºé”™è¯¯æç¤º
    - âœ“ é˜²æ­¢è‡ªè¿æ¥
    - âœ“ é˜²æ­¢å¾ªç¯è¿æ¥
  - **å®ç°æ–‡ä»¶**: `src/components/editor/EditorCanvas.tsx` (å¢å¼º isValidConnection)
  - **ç±»å‹å…¼å®¹çŸ©é˜µ**:
    | From \ To | string | number | boolean | object | array | any |
    |---|---|---|---|---|---|---|
    | string | âœ… | âŒ | âŒ | âŒ | âŒ | âœ… |
    | number | âŒ | âœ… | âŒ | âŒ | âŒ | âœ… |
    | boolean | âŒ | âŒ | âœ… | âŒ | âŒ | âœ… |
    | object | âŒ | âŒ | âŒ | âœ… | âŒ | âœ… |
    | array | âŒ | âŒ | âŒ | âŒ | âœ… | âœ… |
    | any | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… |

---

##### é…ç½®é¢æ¿

| ID        | ä»»åŠ¡             | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ–      | ä¼°æ—¶ |
| --------- | ---------------- | ------ | ---- | --------- | ---- |
| PANEL-001 | å®ç°å³ä¾§é…ç½®é¢æ¿ | ğŸ”´ P0  | âœ…   | NODE-004  | 4h   |
| PANEL-002 | å®ç°èŠ‚ç‚¹é…ç½®è¡¨å• | ğŸ”´ P0  | âœ…   | PANEL-001 | 8h   |
| PANEL-003 | å®ç°è¡¨å•æ ¡éªŒ     | ğŸŸ  P1  | âœ…   | PANEL-002 | 4h   |
| PANEL-004 | å®ç°é…ç½®å®æ—¶é¢„è§ˆ | ğŸŸ¡ P2  | âœ…   | PANEL-002 | 4h   |
| PANEL-005 | å®ç°å˜é‡é€‰æ‹©å™¨   | ğŸŸ  P1  | âœ…   | PANEL-002 | 6h   |

**è¯¦ç»†ä»»åŠ¡è¯´æ˜ï¼š**

- [x] **PANEL-005: å®ç°å˜é‡é€‰æ‹©å™¨** ğŸŸ  P1 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ æ˜¾ç¤ºä¸Šæ¸¸èŠ‚ç‚¹çš„è¾“å‡ºå˜é‡
    - âœ“ å˜é‡æœç´¢åŠŸèƒ½
    - âœ“ å˜é‡ç±»å‹æç¤º
    - âœ“ ç‚¹å‡»æ’å…¥å˜é‡åˆ°è¾“å…¥æ¡†
    - âœ“ æ”¯æŒ `{{variable}}` è¯­æ³•
  - **å˜é‡æ¥æº**:
    - å…¨å±€å˜é‡
    - ä¸Šæ¸¸èŠ‚ç‚¹è¾“å‡º
    - å¾ªç¯å˜é‡ (åœ¨å¾ªç¯èŠ‚ç‚¹å†…)
    - ç³»ç»Ÿå˜é‡ (æ—¶é—´ã€æ‰§è¡ŒIDç­‰)
  - **å®ç°æ–‡ä»¶**: `src/components/editor/VariableSelector.tsx`

---

##### å¸ƒå±€ä¸æ ·å¼

| ID         | ä»»åŠ¡               | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ–       | ä¼°æ—¶ |
| ---------- | ------------------ | ------ | ---- | ---------- | ---- |
| LAYOUT-001 | è®¾è®¡ç¼–è¾‘å™¨æ•´ä½“å¸ƒå±€ | ğŸ”´ P0  | âœ…   | -          | 4h   |
| LAYOUT-002 | å®ç°é¡¶éƒ¨å·¥å…·æ      | ğŸŸ  P1  | âœ…   | LAYOUT-001 | 4h   |
| LAYOUT-003 | å®ç°è‡ªåŠ¨å¸ƒå±€ç®—æ³•   | ğŸŸ¡ P2  | âœ…   | CANVAS-001 | 6h   |
| LAYOUT-004 | å®ç°æ·±è‰²/æµ…è‰²ä¸»é¢˜  | ğŸŸ  P1  | âœ…   | LAYOUT-001 | 4h   |
| LAYOUT-005 | å“åº”å¼é€‚é…         | ğŸŸ¡ P2  | âœ…   | LAYOUT-001 | 4h   |

**è¯¦ç»†ä»»åŠ¡è¯´æ˜ï¼š**

- [x] **LAYOUT-001: è®¾è®¡ç¼–è¾‘å™¨æ•´ä½“å¸ƒå±€** ğŸ”´ P0 âœ…
  - **å®ç°æ–‡ä»¶**: `src/components/editor/WorkflowEditor.tsx`
  - **å¸ƒå±€ç»“æ„**:
    ```
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    é¡¶éƒ¨å·¥å…·æ                          â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚            â”‚                         â”‚               â”‚
    â”‚   èŠ‚ç‚¹é¢æ¿  â”‚        ç”»å¸ƒåŒºåŸŸ         â”‚   é…ç½®é¢æ¿    â”‚
    â”‚  (å¯æŠ˜å )  â”‚                         â”‚   (å¯æŠ˜å )   â”‚
    â”‚            â”‚                         â”‚               â”‚
    â”‚   240px    â”‚        flex-1           â”‚    360px      â”‚
    â”‚            â”‚                         â”‚               â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                    åº•éƒ¨çŠ¶æ€æ                          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    ```

- [x] **LAYOUT-003: å®ç°è‡ªåŠ¨å¸ƒå±€ç®—æ³•** ğŸŸ¡ P2 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ ä¸€é”®è‡ªåŠ¨æ’åˆ—èŠ‚ç‚¹
    - âœ“ æ”¯æŒå¤šç§å¸ƒå±€ç®—æ³• (æ°´å¹³/å‚ç›´/æ ‘å½¢)
    - âœ“ ä¿æŒè¿çº¿ä¸äº¤å‰ (å°½é‡)
  - **æŠ€æœ¯è¦ç‚¹**:
    - ä½¿ç”¨ dagre å¸ƒå±€åº“
    - é…ç½®èŠ‚ç‚¹é—´è·å‚æ•°
    - åŠ¨ç”»è¿‡æ¸¡æ•ˆæœ
  - **å®ç°æ–‡ä»¶**: `src/hooks/useAutoLayout.ts`

---

#### 6.1.3 åŸºç¡€èŠ‚ç‚¹é›† (W5-6)

##### AI èŠ‚ç‚¹

| ID     | ä»»åŠ¡                      | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ–                | ä¼°æ—¶ |
| ------ | ------------------------- | ------ | ---- | ------------------- | ---- |
| AI-001 | LLM è°ƒç”¨èŠ‚ç‚¹ (Chat)       | ğŸ”´ P0  | âœ…   | NODE-001, PANEL-002 | 12h  |
| AI-002 | LLM è°ƒç”¨èŠ‚ç‚¹ (Completion) | ğŸŸ¡ P2  | â¬œ   | AI-001              | 4h   |
| AI-003 | æ–‡æœ¬åµŒå…¥èŠ‚ç‚¹ (Embedding)  | ğŸŸ¡ P2  | â¬œ   | NODE-001            | 6h   |

**è¯¦ç»†ä»»åŠ¡è¯´æ˜ï¼š**

- [x] **AI-001: LLM è°ƒç”¨èŠ‚ç‚¹ (Chat)** ğŸ”´ P0 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ æ¨¡å‹é€‰æ‹© (OpenAI GPT-4/3.5, Claude 3, æœ¬åœ°æ¨¡å‹)
    - âœ“ System Prompt é…ç½® (å¤šè¡Œæ–‡æœ¬)
    - âœ“ User Prompt é…ç½® (æ”¯æŒå˜é‡æ’å€¼ `{{var}}`)
    - âœ“ é«˜çº§å‚æ•°è®¾ç½®:
      - Temperature: 0-2 (é»˜è®¤ 0.7)
      - Max Tokens: 1-32000 (é»˜è®¤ 2048)
      - Top P: 0-1 (é»˜è®¤ 1)
      - Frequency Penalty: 0-2 (é»˜è®¤ 0)
      - Presence Penalty: 0-2 (é»˜è®¤ 0)
    - âœ“ æµå¼è¾“å‡ºæ”¯æŒ (SSE)
    - âœ“ è¶…æ—¶é…ç½® (é»˜è®¤ 60s)
    - âœ“ é‡è¯•é…ç½® (æ¬¡æ•°ã€é—´éš”)
  - **è¾“å…¥ç«¯å£**:
    | åç§° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
    |---|---|---|---|
    | messages | array | âŒ | å†å²æ¶ˆæ¯ (å¤šè½®å¯¹è¯) |
    | variables | object | âŒ | Prompt å˜é‡ |
  - **è¾“å‡ºç«¯å£**:
    | åç§° | ç±»å‹ | è¯´æ˜ |
    |---|---|---|
    | content | string | ç”Ÿæˆçš„æ–‡æœ¬å†…å®¹ |
    | usage | object | Token ä½¿ç”¨é‡ |
    | raw | object | åŸå§‹å“åº” |
  - **èŠ‚ç‚¹é…ç½®ç•Œé¢**:
    ```
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ğŸ¤– LLM Chat                         â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ æ¨¡å‹: [OpenAI GPT-4     â–¼]          â”‚
    â”‚                                     â”‚
    â”‚ System Prompt:                      â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚ â”‚ ä½ æ˜¯ä¸€ä¸ªæœ‰å¸®åŠ©çš„AIåŠ©æ‰‹...        â”‚ â”‚
    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â”‚                                     â”‚
    â”‚ User Prompt:                        â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚ â”‚ {{input}}                        â”‚ â”‚
    â”‚ â”‚                         [å˜é‡ ğŸ“‹]â”‚ â”‚
    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â”‚                                     â”‚
    â”‚ â–¸ é«˜çº§è®¾ç½®                          â”‚
    â”‚   Temperature: [0.7      ]          â”‚
    â”‚   Max Tokens:  [2048     ]          â”‚
    â”‚   â˜‘ æµå¼è¾“å‡º                        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    ```

---

##### é›†æˆèŠ‚ç‚¹

| ID      | ä»»åŠ¡             | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ–             | ä¼°æ—¶ |
| ------- | ---------------- | ------ | ---- | ---------------- | ---- |
| INT-001 | HTTP è¯·æ±‚èŠ‚ç‚¹    | ğŸ”´ P0  | âœ…   | NODE-001         | 8h   |
| INT-002 | Webhook è§¦å‘èŠ‚ç‚¹ | ğŸŸ  P1  | âœ…   | NODE-001, BE-002 | 8h   |

**è¯¦ç»†ä»»åŠ¡è¯´æ˜ï¼š**

- [x] **INT-001: HTTP è¯·æ±‚èŠ‚ç‚¹** ğŸ”´ P0 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ æ–¹æ³•é€‰æ‹©: GET, POST, PUT, PATCH, DELETE
    - âœ“ URL é…ç½® (æ”¯æŒå˜é‡)
    - âœ“ Headers é…ç½® (é”®å€¼å¯¹)
    - âœ“ Query Params é…ç½®
    - âœ“ Body é…ç½®:
      - JSON æ¨¡å¼ (ç¼–è¾‘å™¨)
      - Form Data æ¨¡å¼
      - Raw æ¨¡å¼
    - âœ“ å“åº”è§£æé…ç½®
    - âœ“ è¶…æ—¶è®¾ç½®
    - âœ“ è®¤è¯é…ç½® (Basic, Bearer, API Key)
  - **è¾“å…¥ç«¯å£**: url (string), headers (object), body (any)
  - **è¾“å‡ºç«¯å£**: data (any), status (number), headers (object)

- [x] **INT-002: Webhook è§¦å‘èŠ‚ç‚¹** ğŸŸ  P1 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ ç”Ÿæˆå”¯ä¸€ Webhook URL
    - âœ“ è¯·æ±‚ç­¾åéªŒè¯ (HMAC-SHA256)
    - âœ“ æ”¯æŒ GET/POST æ–¹æ³•
    - âœ“ Payload è§£æ (JSON, Form)
    - âœ“ IP ç™½åå• (å¯é€‰)
  - **Webhook URL æ ¼å¼**: `https://api.reverseai.ai/webhooks/{workflow_id}/{node_id}`
  - **å®ç°æ–‡ä»¶**:
    - å‰ç«¯: `apps/web/src/components/editor/nodes/WebhookNode.tsx`
    - åç«¯: `apps/server/internal/pkg/executor/webhook_executor.go`

---

##### é€»è¾‘èŠ‚ç‚¹

| ID        | ä»»åŠ¡                     | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ–     | ä¼°æ—¶ |
| --------- | ------------------------ | ------ | ---- | -------- | ---- |
| LOGIC-001 | æ¡ä»¶åˆ¤æ–­èŠ‚ç‚¹ (If/Else)   | ğŸ”´ P0  | âœ…   | NODE-001 | 8h   |
| LOGIC-002 | å¾ªç¯èŠ‚ç‚¹ (Loop)          | ğŸ”´ P0  | âœ…   | NODE-001 | 10h  |
| LOGIC-003 | å¹¶è¡Œæ‰§è¡ŒèŠ‚ç‚¹ (Parallel)  | ğŸŸ  P1  | âœ…   | NODE-001 | 6h   |
| LOGIC-004 | ç­‰å¾…èŠ‚ç‚¹ (Delay)         | ğŸŸ¡ P2  | âœ…   | NODE-001 | 2h   |
| LOGIC-005 | é”™è¯¯å¤„ç†èŠ‚ç‚¹ (Try/Catch) | ğŸŸ  P1  | âœ…   | NODE-001 | 6h   |

**è¯¦ç»†ä»»åŠ¡è¯´æ˜ï¼š**

- [x] **LOGIC-001: æ¡ä»¶åˆ¤æ–­èŠ‚ç‚¹ (If/Else)** ğŸ”´ P0 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ å¤šæ¡ä»¶é…ç½® (AND/OR)
    - âœ“ æ¯”è¾ƒè¿ç®—ç¬¦: ==, !=, >, >=, <, <=, contains, startsWith, endsWith, matches (æ­£åˆ™)
    - âœ“ é€»è¾‘è¿ç®—ç¬¦: AND, OR, NOT
    - âœ“ ä¸¤ä¸ªè¾“å‡ºåˆ†æ”¯: true, false
    - âœ“ æ¡ä»¶è¡¨è¾¾å¼æ¨¡å¼ (é«˜çº§)
  - **æ¡ä»¶é…ç½®ç•Œé¢**:

    ```
    æ¡ä»¶ç»„ 1 (AND):
    â”œâ”€â”€ {{user.age}} [>=] [18]
    â””â”€â”€ {{user.verified}} [==] [true]

    OR

    æ¡ä»¶ç»„ 2:
    â””â”€â”€ {{user.role}} [==] ["admin"]
    ```

- [x] **LOGIC-002: å¾ªç¯èŠ‚ç‚¹ (Loop)** ğŸ”´ P0 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ For Each æ¨¡å¼ (éå†æ•°ç»„)
    - âœ“ While æ¨¡å¼ (æ¡ä»¶å¾ªç¯)
    - âœ“ å›ºå®šæ¬¡æ•°æ¨¡å¼
    - âœ“ å¾ªç¯æ¬¡æ•°é™åˆ¶ (é˜²æ­¢æ— é™å¾ªç¯ï¼Œé»˜è®¤ 1000)
    - âœ“ å¾ªç¯å†…å˜é‡ (item, index)
    - âœ“ break/continue æ”¯æŒ
  - **è¾“å…¥ç«¯å£**: items (array), condition (boolean)
  - **è¾“å‡ºç«¯å£**: item (any), index (number), results (array)
  - **å¾ªç¯ä½“**: ä½œä¸ºå­ç”»å¸ƒå®ç°

- [x] **LOGIC-004: ç­‰å¾…èŠ‚ç‚¹ (Delay)** ğŸŸ¡ P2 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ å›ºå®šå»¶è¿Ÿæ¨¡å¼ (æŒ‡å®šæ—¶é—´)
    - âœ“ éšæœºå»¶è¿Ÿæ¨¡å¼ (èŒƒå›´å†…éšæœº)
    - âœ“ æ”¯æŒå¤šç§æ—¶é—´å•ä½ (ms, s, m, h)
    - âœ“ æœ€å¤§å»¶è¿Ÿé™åˆ¶ (1å°æ—¶)
    - âœ“ æ”¯æŒå–æ¶ˆå’Œä¸­æ–­
  - **é…ç½®é€‰é¡¹**:
    - `duration`: å»¶è¿Ÿæ—¶é—´
    - `unit`: æ—¶é—´å•ä½ (ms/s/m/h)
    - `mode`: æ¨¡å¼ (fixed/random)
    - `minDuration`: éšæœºæ¨¡å¼æœ€å°å€¼
    - `maxDuration`: éšæœºæ¨¡å¼æœ€å¤§å€¼
  - **å®ç°æ–‡ä»¶**:
    - å‰ç«¯: `apps/web/src/components/editor/nodes/DelayNode.tsx`
    - åç«¯: `apps/server/internal/pkg/executor/delay_executor.go`

---

##### æ•°æ®èŠ‚ç‚¹

| ID       | ä»»åŠ¡         | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ–     | ä¼°æ—¶ |
| -------- | ------------ | ------ | ---- | -------- | ---- |
| DATA-001 | å˜é‡è®¾ç½®èŠ‚ç‚¹ | ğŸ”´ P0  | âœ…   | NODE-001 | 4h   |
| DATA-002 | æ•°æ®è½¬æ¢èŠ‚ç‚¹ | ğŸŸ  P1  | âœ…   | NODE-001 | 6h   |
| DATA-003 | æ•°æ®åˆå¹¶èŠ‚ç‚¹ | ğŸŸ  P1  | âœ…   | NODE-001 | 4h   |
| DATA-004 | æ•°æ®ç­›é€‰èŠ‚ç‚¹ | ğŸŸ  P1  | âœ…   | NODE-001 | 4h   |

---

##### æ–‡æœ¬èŠ‚ç‚¹

| ID       | ä»»åŠ¡              | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ–     | ä¼°æ—¶ |
| -------- | ----------------- | ------ | ---- | -------- | ---- |
| TEXT-001 | æ–‡æœ¬æ¨¡æ¿èŠ‚ç‚¹      | ğŸ”´ P0  | âœ…   | NODE-001 | 6h   |
| TEXT-002 | æ­£åˆ™æå–èŠ‚ç‚¹      | ğŸŸ  P1  | âœ…   | NODE-001 | 4h   |
| TEXT-003 | æ–‡æœ¬åˆ†å‰²/åˆå¹¶èŠ‚ç‚¹ | ğŸŸ  P1  | âœ…   | NODE-001 | 4h   |

---

##### ä»£ç èŠ‚ç‚¹

| ID       | ä»»åŠ¡                | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ–     | ä¼°æ—¶ |
| -------- | ------------------- | ------ | ---- | -------- | ---- |
| CODE-001 | JavaScript ä»£ç èŠ‚ç‚¹ | ğŸŸ  P1  | âœ…   | NODE-001 | 8h   |
| CODE-002 | è¡¨è¾¾å¼è®¡ç®—èŠ‚ç‚¹      | ğŸŸ  P1  | âœ…   | NODE-001 | 4h   |

**è¯¦ç»†ä»»åŠ¡è¯´æ˜ï¼š**

- [x] **CODE-001: JavaScript ä»£ç èŠ‚ç‚¹** ğŸŸ  P1 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ Monaco Editor ä»£ç ç¼–è¾‘å™¨
    - âœ“ è¯­æ³•é«˜äº®å’Œè‡ªåŠ¨è¡¥å…¨
    - âœ“ æ²™ç®±æ‰§è¡Œ (isolated-vm)
    - âœ“ è¾“å…¥å˜é‡æ³¨å…¥
    - âœ“ æ‰§è¡Œè¶…æ—¶é™åˆ¶ (é»˜è®¤ 30s)
    - âœ“ å†…å­˜é™åˆ¶ (é»˜è®¤ 128MB)
  - **ä»£ç æ¨¡æ¿**:

    ```javascript
    // inputs åŒ…å«æ‰€æœ‰è¾“å…¥å˜é‡
    // è¿”å›å€¼ä½œä¸ºèŠ‚ç‚¹è¾“å‡º

    async function main(inputs) {
      const { data } = inputs

      // ä½ çš„ä»£ç 
      const result = data.map((item) => item * 2)

      return {
        output: result,
      }
    }
    ```

  - **å¯ç”¨ API**:
    - `console.log/warn/error` - æ—¥å¿—
    - `JSON.parse/stringify` - JSON å¤„ç†
    - `fetch` (å—é™) - HTTP è¯·æ±‚ (éœ€é…ç½®ç™½åå•)

---

##### æµç¨‹èŠ‚ç‚¹

| ID       | ä»»åŠ¡         | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ–     | ä¼°æ—¶ |
| -------- | ------------ | ------ | ---- | -------- | ---- |
| FLOW-001 | å¼€å§‹èŠ‚ç‚¹     | ğŸ”´ P0  | âœ…   | NODE-001 | 2h   |
| FLOW-002 | ç»“æŸèŠ‚ç‚¹     | ğŸ”´ P0  | âœ…   | NODE-001 | 2h   |
| FLOW-003 | ç”¨æˆ·è¾“å…¥èŠ‚ç‚¹ | ğŸŸ  P1  | âœ…   | NODE-001 | 4h   |
| FLOW-004 | è¾“å‡ºå±•ç¤ºèŠ‚ç‚¹ | ğŸŸ  P1  | âœ…   | NODE-001 | 4h   |

---

#### 6.1.4 æ‰§è¡Œå¼•æ“ (W7-8)

##### åç«¯æ‰§è¡Œå¼•æ“

| ID      | ä»»åŠ¡                      | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ–    | ä¼°æ—¶ |
| ------- | ------------------------- | ------ | ---- | ------- | ---- |
| EXE-001 | è®¾è®¡æ‰§è¡Œå¼•æ“æ¶æ„          | ğŸ”´ P0  | âœ…   | -       | 8h   |
| EXE-002 | å®ç°å·¥ä½œæµè§£æå™¨          | ğŸ”´ P0  | âœ…   | EXE-001 | 6h   |
| EXE-003 | å®ç° DAG ä¾èµ–åˆ†æ         | ğŸ”´ P0  | âœ…   | EXE-002 | 6h   |
| EXE-004 | å®ç°èŠ‚ç‚¹æ‰§è¡Œå™¨æ¥å£        | ğŸ”´ P0  | âœ…   | EXE-001 | 4h   |
| EXE-005 | å®ç° LLM èŠ‚ç‚¹æ‰§è¡Œå™¨       | ğŸ”´ P0  | âœ…   | EXE-004 | 8h   |
| EXE-006 | å®ç° HTTP èŠ‚ç‚¹æ‰§è¡Œå™¨      | ğŸ”´ P0  | âœ…   | EXE-004 | 4h   |
| EXE-007 | å®ç°æ¡ä»¶èŠ‚ç‚¹æ‰§è¡Œå™¨        | ğŸ”´ P0  | âœ…   | EXE-004 | 4h   |
| EXE-008 | å®ç°å¾ªç¯èŠ‚ç‚¹æ‰§è¡Œå™¨        | ğŸ”´ P0  | âœ…   | EXE-004 | 6h   |
| EXE-009 | å®ç°ä»£ç èŠ‚ç‚¹æ‰§è¡Œå™¨ (æ²™ç®±) | ğŸŸ  P1  | â¬œ   | EXE-004 | 8h   |
| EXE-010 | å®ç°æ‰§è¡ŒçŠ¶æ€ç®¡ç†          | ğŸ”´ P0  | âœ…   | EXE-001 | 6h   |
| EXE-011 | å®ç°æ‰§è¡Œæ—¥å¿—è®°å½•          | ğŸŸ  P1  | âœ…   | EXE-001 | 4h   |
| EXE-012 | å®ç°é”™è¯¯å¤„ç†å’Œé‡è¯•        | ğŸŸ  P1  | âœ…   | EXE-001 | 6h   |
| EXE-013 | å®ç°æ‰§è¡Œè¶…æ—¶æœºåˆ¶          | ğŸŸ  P1  | âœ…   | EXE-001 | 4h   |

**è¯¦ç»†ä»»åŠ¡è¯´æ˜ï¼š**

- [x] **EXE-001: è®¾è®¡æ‰§è¡Œå¼•æ“æ¶æ„** ğŸ”´ P0 âœ…
  - **æ¶æ„è®¾è®¡**:
    ```
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                  æ‰§è¡Œå¼•æ“æ¶æ„                        â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                                     â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
    â”‚  â”‚  Workflow   â”‚â”€â”€â”€â†’â”‚   Parser    â”‚               â”‚
    â”‚  â”‚  Definition â”‚    â”‚  å·¥ä½œæµè§£æ  â”‚               â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜               â”‚
    â”‚                            â†“                       â”‚
    â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
    â”‚                    â”‚  DAG Analyzer â”‚               â”‚
    â”‚                    â”‚  ä¾èµ–åˆ†æ      â”‚               â”‚
    â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
    â”‚                            â†“                       â”‚
    â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
    â”‚                    â”‚   Scheduler   â”‚               â”‚
    â”‚                    â”‚   è°ƒåº¦å™¨      â”‚               â”‚
    â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
    â”‚                            â†“                       â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚              Node Executor Pool              â”‚  â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”  â”‚  â”‚
    â”‚  â”‚  â”‚ LLM â”‚ â”‚HTTP â”‚ â”‚Code â”‚ â”‚Logicâ”‚ â”‚ ... â”‚  â”‚  â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                            â†“                       â”‚
    â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
    â”‚                    â”‚ State Manager â”‚               â”‚
    â”‚                    â”‚  çŠ¶æ€ç®¡ç†      â”‚               â”‚
    â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
    â”‚                                                     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    ```
  - **æ ¸å¿ƒæ¥å£**:

    ```go
    type ExecutionEngine interface {
        Execute(ctx context.Context, workflow *Workflow, inputs map[string]interface{}) (*ExecutionResult, error)
        Cancel(executionID string) error
        GetStatus(executionID string) (*ExecutionStatus, error)
    }

    type NodeExecutor interface {
        Execute(ctx context.Context, node *Node, inputs map[string]interface{}) (map[string]interface{}, error)
        GetType() string
    }
    ```

---

##### ä»»åŠ¡è°ƒåº¦

| ID        | ä»»åŠ¡                  | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ–      | ä¼°æ—¶ |
| --------- | --------------------- | ------ | ---- | --------- | ---- |
| SCHED-001 | é›†æˆ Asynq ä»»åŠ¡é˜Ÿåˆ—   | ğŸ”´ P0  | âœ…   | BE-004    | 6h   |
| SCHED-002 | å®ç°å³æ—¶æ‰§è¡Œ          | ğŸ”´ P0  | âœ…   | SCHED-001 | 4h   |
| SCHED-003 | å®ç°å®šæ—¶æ‰§è¡Œ (Cron)   | ğŸŸ  P1  | âœ…   | SCHED-001 | 6h   |
| SCHED-004 | å®ç° Webhook è§¦å‘æ‰§è¡Œ | ğŸŸ  P1  | âœ…   | SCHED-001 | 4h   |
| SCHED-005 | å®ç°æ‰§è¡Œå–æ¶ˆåŠŸèƒ½      | ğŸŸ  P1  | âœ…   | SCHED-001 | 4h   |

---

##### å®æ—¶é€šä¿¡

| ID     | ä»»åŠ¡                 | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ–   | ä¼°æ—¶ |
| ------ | -------------------- | ------ | ---- | ------ | ---- |
| WS-001 | å®ç° WebSocket æœåŠ¡  | ğŸ”´ P0  | âœ…   | BE-002 | 6h   |
| WS-002 | å®ç°æ‰§è¡ŒçŠ¶æ€æ¨é€     | ğŸ”´ P0  | âœ…   | WS-001 | 4h   |
| WS-003 | å®ç°èŠ‚ç‚¹æ‰§è¡Œè¿›åº¦æ¨é€ | ğŸŸ  P1  | âœ…   | WS-001 | 4h   |
| WS-004 | å®ç°æ‰§è¡Œæ—¥å¿—å®æ—¶æ¨é€ | ğŸŸ  P1  | âœ…   | WS-001 | 4h   |

**è¯¦ç»†ä»»åŠ¡è¯´æ˜ï¼š**

- [x] **WS-001: å®ç° WebSocket æœåŠ¡** ğŸ”´ P0 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ WebSocket è¿æ¥å»ºç«‹/æ–­å¼€å¤„ç†
    - âœ“ å¿ƒè·³æ£€æµ‹æœºåˆ¶
    - âœ“ è®¤è¯ (Token éªŒè¯)
    - âœ“ æˆ¿é—´/é¢‘é“æœºåˆ¶ (æŒ‰æ‰§è¡Œ ID)
    - âœ“ æ¶ˆæ¯æ ¼å¼è§„èŒƒ
  - **å®ç°æ–‡ä»¶**:
    - `internal/pkg/websocket/hub.go` - è¿æ¥ç®¡ç†ä¸­å¿ƒ
    - `internal/pkg/websocket/client.go` - å®¢æˆ·ç«¯å¤„ç†
    - `internal/api/handler/websocket.go` - HTTP å‡çº§å¤„ç†å™¨
  - **æ¶ˆæ¯æ ¼å¼**:
    ```json
    {
      "type": "execution.node.started",
      "payload": {
        "executionId": "xxx",
        "nodeId": "xxx",
        "timestamp": "2024-01-01T00:00:00Z"
      }
    }
    ```
  - **æ¶ˆæ¯ç±»å‹**:
    - `execution.started` - æ‰§è¡Œå¼€å§‹
    - `execution.completed` - æ‰§è¡Œå®Œæˆ
    - `execution.failed` - æ‰§è¡Œå¤±è´¥
    - `execution.node.started` - èŠ‚ç‚¹å¼€å§‹æ‰§è¡Œ
    - `execution.node.completed` - èŠ‚ç‚¹æ‰§è¡Œå®Œæˆ
    - `execution.node.failed` - èŠ‚ç‚¹æ‰§è¡Œå¤±è´¥
    - `execution.log` - æ‰§è¡Œæ—¥å¿—

---

##### å‰ç«¯æ‰§è¡Œå±•ç¤º

| ID          | ä»»åŠ¡               | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ–        | ä¼°æ—¶ |
| ----------- | ------------------ | ------ | ---- | ----------- | ---- |
| EXEC-UI-001 | å®ç°æ‰§è¡ŒçŠ¶æ€å¯è§†åŒ– | ğŸ”´ P0  | âœ…   | WS-001      | 6h   |
| EXEC-UI-002 | å®ç°èŠ‚ç‚¹æ‰§è¡Œé«˜äº®   | ğŸŸ  P1  | âœ…   | EXEC-UI-001 | 4h   |
| EXEC-UI-003 | å®ç°æ‰§è¡Œæ—¥å¿—é¢æ¿   | ğŸŸ  P1  | âœ…   | WS-004      | 6h   |
| EXEC-UI-004 | å®ç°æ‰§è¡Œç»“æœæŸ¥çœ‹   | ğŸŸ  P1  | âœ…   | EXEC-UI-001 | 4h   |

---

#### 6.1.5 ç”¨æˆ·ç³»ç»Ÿ (W9-10)

##### è®¤è¯ç³»ç»Ÿ

| ID       | ä»»åŠ¡                   | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ–           | ä¼°æ—¶ |
| -------- | ---------------------- | ------ | ---- | -------------- | ---- |
| AUTH-001 | å®ç°é‚®ç®±æ³¨å†Œ           | ğŸ”´ P0  | âœ…   | BE-003, BE-005 | 6h   |
| AUTH-002 | å®ç°é‚®ç®±éªŒè¯           | ğŸ”´ P0  | â¬œ   | AUTH-001       | 4h   |
| AUTH-003 | å®ç°å¯†ç ç™»å½•           | ğŸ”´ P0  | âœ…   | AUTH-001       | 4h   |
| AUTH-004 | å®ç° JWT Token ç­¾å‘    | ğŸ”´ P0  | âœ…   | BE-005         | 4h   |
| AUTH-005 | å®ç° Token åˆ·æ–°        | ğŸ”´ P0  | âœ…   | AUTH-004       | 4h   |
| AUTH-006 | å®ç°ç™»å‡ºåŠŸèƒ½           | ğŸŸ  P1  | âœ…   | AUTH-004       | 2h   |
| AUTH-007 | å®ç° GitHub OAuth ç™»å½• | ğŸŸ¡ P2  | â¬œ   | AUTH-004       | 6h   |
| AUTH-008 | å®ç° Google OAuth ç™»å½• | ğŸŸ¡ P2  | â¬œ   | AUTH-004       | 6h   |

**è¯¦ç»†ä»»åŠ¡è¯´æ˜ï¼š**

- [x] **AUTH-001: å®ç°é‚®ç®±æ³¨å†Œ** ğŸ”´ P0 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ é‚®ç®±æ ¼å¼éªŒè¯
    - âœ“ å¯†ç å¼ºåº¦éªŒè¯ (è‡³å°‘ 8 ä½ï¼ŒåŒ…å«å¤§å°å†™å’Œæ•°å­—)
    - âœ“ é‚®ç®±å”¯ä¸€æ€§æ£€æŸ¥
    - âœ“ å¯†ç  bcrypt åŠ å¯†å­˜å‚¨
    - âœ“ æ³¨å†ŒæˆåŠŸå‘é€éªŒè¯é‚®ä»¶
  - **API**: `POST /api/v1/auth/register`
    ```json
    // Request
    { "email": "user@example.com", "password": "Password123", "username": "johndoe" }
    // Response
    { "message": "æ³¨å†ŒæˆåŠŸï¼Œè¯·æŸ¥æ”¶éªŒè¯é‚®ä»¶", "user": { "id": "xxx", "email": "xxx" } }
    ```

---

##### ç”¨æˆ·ç®¡ç†

| ID       | ä»»åŠ¡             | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ–               | ä¼°æ—¶ |
| -------- | ---------------- | ------ | ---- | ------------------ | ---- |
| USER-001 | ç”¨æˆ·è¡¨è®¾è®¡å’Œè¿ç§» | ğŸ”´ P0  | âœ…   | BE-010             | 4h   |
| USER-002 | ç”¨æˆ·æ³¨å†Œ API     | ğŸ”´ P0  | âœ…   | USER-001, AUTH-001 | 4h   |
| USER-003 | ç”¨æˆ·ç™»å½• API     | ğŸ”´ P0  | âœ…   | USER-001, AUTH-003 | 4h   |
| USER-004 | è·å–å½“å‰ç”¨æˆ· API | ğŸ”´ P0  | âœ…   | USER-001, AUTH-004 | 2h   |
| USER-005 | æ›´æ–°ç”¨æˆ·èµ„æ–™ API | ğŸŸ  P1  | âœ…   | USER-004           | 4h   |
| USER-006 | ä¿®æ”¹å¯†ç  API     | ğŸŸ  P1  | âœ…   | USER-004           | 4h   |
| USER-007 | ä¸Šä¼ å¤´åƒåŠŸèƒ½     | ğŸŸ¡ P2  | â¬œ   | USER-004           | 4h   |

---

##### å·¥ä½œæµç®¡ç†

| ID     | ä»»åŠ¡               | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ–     | ä¼°æ—¶ |
| ------ | ------------------ | ------ | ---- | -------- | ---- |
| WF-001 | å·¥ä½œæµè¡¨è®¾è®¡å’Œè¿ç§» | ğŸ”´ P0  | âœ…   | USER-001 | 4h   |
| WF-002 | åˆ›å»ºå·¥ä½œæµ API     | ğŸ”´ P0  | âœ…   | WF-001   | 4h   |
| WF-003 | è·å–å·¥ä½œæµåˆ—è¡¨ API | ğŸ”´ P0  | âœ…   | WF-001   | 4h   |
| WF-004 | è·å–å·¥ä½œæµè¯¦æƒ… API | ğŸ”´ P0  | âœ…   | WF-001   | 2h   |
| WF-005 | æ›´æ–°å·¥ä½œæµ API     | ğŸ”´ P0  | âœ…   | WF-001   | 4h   |
| WF-006 | åˆ é™¤å·¥ä½œæµ API     | ğŸ”´ P0  | âœ…   | WF-001   | 2h   |
| WF-007 | å·¥ä½œæµæ–‡ä»¶å¤¹ç®¡ç†   | ğŸŸ¡ P2  | â¬œ   | WF-001   | 6h   |

---

##### API å¯†é’¥ç®¡ç†

| ID      | ä»»åŠ¡             | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ–     | ä¼°æ—¶ |
| ------- | ---------------- | ------ | ---- | -------- | ---- |
| KEY-001 | API å¯†é’¥åŠ å¯†å­˜å‚¨ | ğŸ”´ P0  | âœ…   | USER-001 | 4h   |
| KEY-002 | æ·»åŠ  API å¯†é’¥    | ğŸ”´ P0  | âœ…   | KEY-001  | 4h   |
| KEY-003 | åˆ é™¤ API å¯†é’¥    | ğŸŸ  P1  | âœ…   | KEY-001  | 2h   |
| KEY-004 | å¯†é’¥è„±æ•å±•ç¤º     | ğŸŸ  P1  | âœ…   | KEY-002  | 2h   |

**è¯¦ç»†ä»»åŠ¡è¯´æ˜ï¼š**

- [x] **KEY-001: API å¯†é’¥åŠ å¯†å­˜å‚¨** ğŸ”´ P0 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ AES-256 åŠ å¯†å­˜å‚¨
    - âœ“ åŠ å¯†å¯†é’¥ç‹¬ç«‹ç®¡ç†
    - âœ“ å¯†é’¥è½®æ¢æ”¯æŒ
  - **æŠ€æœ¯è¦ç‚¹**:
    - ä½¿ç”¨ AES-256-GCM åŠ å¯†
    - åŠ å¯†å¯†é’¥ä»ç¯å¢ƒå˜é‡è¯»å–
    - å¯†é’¥å‰ç¼€è¯†åˆ« (å¦‚ `sk-xxxx`)

---

##### å‰ç«¯é¡µé¢

| ID       | ä»»åŠ¡           | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ–              | ä¼°æ—¶ |
| -------- | -------------- | ------ | ---- | ----------------- | ---- |
| PAGE-001 | ç™»å½•é¡µé¢       | ğŸ”´ P0  | âœ…   | AUTH-003          | 4h   |
| PAGE-002 | æ³¨å†Œé¡µé¢       | ğŸ”´ P0  | âœ…   | AUTH-001          | 4h   |
| PAGE-003 | å¿˜è®°å¯†ç é¡µé¢   | ğŸŸ¡ P2  | â¬œ   | AUTH-002          | 4h   |
| PAGE-004 | ä¸ªäººä¸­å¿ƒé¡µé¢   | ğŸŸ  P1  | âœ…   | USER-004          | 6h   |
| PAGE-005 | å·¥ä½œæµåˆ—è¡¨é¡µé¢ | ğŸ”´ P0  | âœ…   | WF-003            | 6h   |
| PAGE-006 | è®¾ç½®é¡µé¢       | ğŸŸ  P1  | âœ…   | USER-004, KEY-002 | 6h   |

---

#### 6.1.6 æ‰“ç£¨ä¼˜åŒ– (W11-12)

##### æ€§èƒ½ä¼˜åŒ–

| ID       | ä»»åŠ¡           | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ–   | ä¼°æ—¶ |
| -------- | -------------- | ------ | ---- | ------ | ---- |
| PERF-001 | å‰ç«¯ä»£ç åˆ†å‰²   | ğŸŸ  P1  | âœ…   | -      | 4h   |
| PERF-002 | å›¾ç‰‡èµ„æºä¼˜åŒ–   | ğŸŸ¡ P2  | âœ…   | -      | 4h   |
| PERF-003 | API å“åº”ç¼“å­˜   | ğŸŸ  P1  | âœ…   | BE-004 | 4h   |
| PERF-004 | æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ– | ğŸŸ  P1  | âœ…   | -      | 6h   |
| PERF-005 | æ·»åŠ æ•°æ®åº“ç´¢å¼• | ğŸŸ  P1  | âœ…   | -      | 4h   |

**è¯¦ç»†ä»»åŠ¡è¯´æ˜ï¼š**

- [x] **PERF-001: å‰ç«¯ä»£ç åˆ†å‰²** ğŸŸ  P1 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ è·¯ç”±çº§ä»£ç åˆ†å‰²
    - âœ“ ç¼–è¾‘å™¨ç»„ä»¶åŠ¨æ€å¯¼å…¥
    - âœ“ é¦–å±åŠ è½½æ—¶é—´ < 2s (3G ç½‘ç»œ)
    - âœ“ Lighthouse Performance è¯„åˆ† > 80
  - **æŠ€æœ¯è¦ç‚¹**:
    - ä½¿ç”¨ `next/dynamic` åŠ¨æ€å¯¼å…¥
    - React Flow å»¶è¿ŸåŠ è½½
    - Monaco Editor æŒ‰éœ€åŠ è½½

---

##### ç”¨æˆ·ä½“éªŒ

| ID     | ä»»åŠ¡         | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ–       | ä¼°æ—¶ |
| ------ | ------------ | ------ | ---- | ---------- | ---- |
| UX-001 | åŠ è½½çŠ¶æ€ä¼˜åŒ– | ğŸŸ  P1  | âœ…   | -          | 4h   |
| UX-002 | é”™è¯¯æç¤ºä¼˜åŒ– | ğŸŸ  P1  | âœ…   | -          | 4h   |
| UX-003 | ç©ºçŠ¶æ€è®¾è®¡   | ğŸŸ¡ P2  | âœ…   | -          | 4h   |
| UX-004 | å¼•å¯¼æ•™ç¨‹     | ğŸŸ¡ P2  | âœ…   | -          | 8h   |
| UX-005 | å¿«æ·é”®å¸®åŠ©   | ğŸŸ¡ P2  | âœ…   | CANVAS-005 | 4h   |

---

##### Bug ä¿®å¤ & æµ‹è¯•

| ID       | ä»»åŠ¡             | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ– | ä¼°æ—¶ |
| -------- | ---------------- | ------ | ---- | ---- | ---- |
| FIX-001  | ç¼–è¾‘å™¨ç¨³å®šæ€§é—®é¢˜ | ğŸ”´ P0  | âœ…   | -    | 8h   |
| FIX-002  | æ‰§è¡Œå¼•æ“å¼‚å¸¸å¤„ç† | ğŸ”´ P0  | âœ…   | -    | 8h   |
| FIX-003  | å¹¶å‘é—®é¢˜ä¿®å¤     | ğŸŸ  P1  | âœ…   | -    | 6h   |
| TEST-001 | æ ¸å¿ƒç»„ä»¶å•å…ƒæµ‹è¯• | ğŸŸ  P1  | âœ…   | -    | 16h  |
| TEST-002 | API æ¥å£æµ‹è¯•     | ğŸŸ  P1  | âœ…   | -    | 12h  |
| TEST-003 | E2E æµ‹è¯•ç”¨ä¾‹     | ğŸŸ¡ P2  | âœ…   | -    | 16h  |
| TEST-004 | æ€§èƒ½æµ‹è¯•         | ğŸŸ¡ P2  | âœ…   | -    | 8h   |

**è¯¦ç»†ä»»åŠ¡è¯´æ˜ï¼š**

- [x] **TEST-001: æ ¸å¿ƒç»„ä»¶å•å…ƒæµ‹è¯•** ğŸŸ  P1 âœ…
  - **æµ‹è¯•è¦†ç›–è¦æ±‚**:
    - âœ“ èŠ‚ç‚¹ç»„ä»¶æµ‹è¯•
    - âœ“ é…ç½®é¢æ¿æµ‹è¯•
    - âœ“ Store æµ‹è¯•
    - âœ“ Hooks æµ‹è¯•
    - âœ“ å·¥å…·å‡½æ•°æµ‹è¯•
  - **æµ‹è¯•å·¥å…·**: Vitest + React Testing Library
  - **è¦†ç›–ç‡ç›®æ ‡**: > 70%

---

### 6.2 Phase 2: è‡ªå®šä¹‰èƒ½åŠ› (W1-10)

#### 6.2.1 èŠ‚ç‚¹ SDK (W1-3)

| ID      | ä»»åŠ¡                         | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ–        | ä¼°æ—¶ |
| ------- | ---------------------------- | ------ | ---- | ----------- | ---- |
| SDK-001 | è®¾è®¡ SDK API æ¥å£            | ğŸ”´ P0  | âœ…   | Phase 1     | 8h   |
| SDK-002 | å®ç°èŠ‚ç‚¹å®šä¹‰è§„èŒƒ             | ğŸ”´ P0  | âœ…   | SDK-001     | 8h   |
| SDK-003 | å®ç°è¾“å…¥/è¾“å‡ºç±»å‹ç³»ç»Ÿ        | ğŸ”´ P0  | âœ…   | SDK-002     | 8h   |
| SDK-004 | å®ç°èŠ‚ç‚¹éªŒè¯æœºåˆ¶             | ğŸŸ  P1  | âœ…   | SDK-003     | 6h   |
| SDK-005 | å®ç°èŠ‚ç‚¹æµ‹è¯•æ¡†æ¶             | ğŸŸ  P1  | âœ…   | SDK-002     | 8h   |
| SDK-006 | ç¼–å†™ SDK ä½¿ç”¨æ–‡æ¡£            | ğŸŸ  P1  | âœ…   | SDK-002     | 8h   |
| SDK-007 | æä¾›ç¤ºä¾‹èŠ‚ç‚¹                 | ğŸŸ  P1  | âœ…   | SDK-002     | 8h   |
| SDK-008 | å®ç° CLI å·¥å…·                | ğŸŸ  P1  | âœ…   | SDK-002     | 12h  |
| SDK-009 | å‘å¸ƒ npm åŒ… (@reverseai/sdk) | ğŸ”´ P0  | âœ…   | SDK-001~008 | 4h   |

**è¯¦ç»†ä»»åŠ¡è¯´æ˜ï¼š**

- [x] **SDK-001: è®¾è®¡ SDK API æ¥å£** ğŸ”´ P0 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ TypeScript ç±»å‹å®šä¹‰å®Œæ•´
    - âœ“ API ç®€æ´æ˜“ç”¨
    - âœ“ å¯æ‰©å±•æ€§è‰¯å¥½
  - **æ ¸å¿ƒ API**:

    ```typescript
    // åˆ›å»ºèŠ‚ç‚¹å®šä¹‰
    import { defineNode, input, output } from '@reverseai/sdk'

    export default defineNode({
      id: 'my-custom-node',
      name: 'è‡ªå®šä¹‰èŠ‚ç‚¹',
      description: 'è¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰èŠ‚ç‚¹',
      icon: 'puzzle',
      category: 'custom',

      inputs: {
        text: input.string('è¾“å…¥æ–‡æœ¬').required(),
        count: input.number('æ•°é‡').default(10),
        options: input.object('é€‰é¡¹').optional(),
      },

      outputs: {
        result: output.string('å¤„ç†ç»“æœ'),
        error: output.object('é”™è¯¯ä¿¡æ¯').optional(),
      },

      async execute(ctx) {
        const { text, count } = ctx.inputs
        // å¤„ç†é€»è¾‘
        return {
          result: text.repeat(count),
        }
      },
    })
    ```

- [x] **SDK-008: å®ç° CLI å·¥å…·** ğŸŸ  P1
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ `reverseai init` - åˆå§‹åŒ–èŠ‚ç‚¹é¡¹ç›®
    - âœ“ `reverseai build` - æ„å»ºèŠ‚ç‚¹
    - âœ“ `reverseai test` - è¿è¡Œæµ‹è¯•
    - âœ“ `reverseai publish` - å‘å¸ƒèŠ‚ç‚¹
  - **é¡¹ç›®æ¨¡æ¿ç»“æ„**:
    ```
    my-custom-node/
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ index.ts      # èŠ‚ç‚¹å®šä¹‰
    â”‚   â””â”€â”€ utils.ts      # å·¥å…·å‡½æ•°
    â”œâ”€â”€ test/
    â”‚   â””â”€â”€ index.test.ts # æµ‹è¯•æ–‡ä»¶
    â”œâ”€â”€ package.json
    â”œâ”€â”€ tsconfig.json
    â””â”€â”€ README.md
    ```

---

#### 6.2.2 æ’ä»¶ç³»ç»Ÿ (W4-6)

| ID         | ä»»åŠ¡                   | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ–       | ä¼°æ—¶ |
| ---------- | ---------------------- | ------ | ---- | ---------- | ---- |
| PLUGIN-001 | è®¾è®¡æ’ä»¶ Manifest è§„èŒƒ | ğŸ”´ P0  | âœ…   | SDK-009    | 6h   |
| PLUGIN-002 | å®ç°æ’ä»¶åŠ è½½æœºåˆ¶       | ğŸ”´ P0  | âœ…   | PLUGIN-001 | 12h  |
| PLUGIN-003 | å®ç°æ’ä»¶æ²™ç®±ç¯å¢ƒ       | ğŸ”´ P0  | âœ…   | PLUGIN-002 | 16h  |
| PLUGIN-004 | å®ç°æ’ä»¶æƒé™æ§åˆ¶       | ğŸŸ  P1  | âœ…   | PLUGIN-002 | 8h   |
| PLUGIN-005 | å®ç°æ’ä»¶å¸‚åœºåŸºç¡€       | ğŸŸ  P1  | âœ…   | PLUGIN-001 | 12h  |
| PLUGIN-006 | å®ç°æ’ä»¶å®‰è£…/å¸è½½      | ğŸŸ  P1  | âœ…   | PLUGIN-002 | 8h   |
| PLUGIN-007 | å®ç°æ’ä»¶ç‰ˆæœ¬ç®¡ç†       | ğŸŸ  P1  | âœ…   | PLUGIN-006 | 8h   |
| PLUGIN-008 | å®ç°æ’ä»¶ç­¾åéªŒè¯       | ğŸŸ¡ P2  | âœ…   | PLUGIN-002 | 8h   |
| PLUGIN-009 | ç¼–å†™ç¤ºä¾‹æ’ä»¶           | ğŸŸ  P1  | âœ…   | PLUGIN-002 | 8h   |
| PLUGIN-010 | ç¼–å†™å¼€å‘è€…æ–‡æ¡£         | ğŸŸ  P1  | âœ…   | PLUGIN-001 | 8h   |

---

#### 6.2.3 æœ¬åœ°æ¨¡å¼ (W7-8)

| ID        | ä»»åŠ¡                | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ–      | ä¼°æ—¶ |
| --------- | ------------------- | ------ | ---- | --------- | ---- |
| LOCAL-001 | Tauri æ¡Œé¢åº”ç”¨æ¡†æ¶  | ğŸ”´ P0  | âœ…   | Phase 1   | 16h  |
| LOCAL-002 | SQLite æœ¬åœ°æ•°æ®åº“   | ğŸ”´ P0  | âœ…   | LOCAL-001 | 12h  |
| LOCAL-003 | Ollama æœ¬åœ°æ¨¡å‹é›†æˆ | ğŸŸ  P1  | âœ…   | LOCAL-001 | 16h  |
| LOCAL-004 | LM Studio é›†æˆ      | ğŸŸ¡ P2  | âœ…   | LOCAL-003 | 8h   |
| LOCAL-005 | æœ¬åœ°/äº‘ç«¯æ•°æ®åŒæ­¥   | ğŸŸ  P1  | âœ…   | LOCAL-002 | 24h  |
| LOCAL-006 | æ¨¡å‹ç®¡ç† UI         | ğŸŸ  P1  | âœ…   | LOCAL-003 | 12h  |
| LOCAL-007 | ç¦»çº¿æ¨¡å¼æ”¯æŒ        | ğŸŸ  P1  | âœ…   | LOCAL-002 | 16h  |

**è¯¦ç»†ä»»åŠ¡è¯´æ˜ï¼š**

- [x] **LOCAL-001: Tauri æ¡Œé¢åº”ç”¨æ¡†æ¶** ğŸ”´ P0 âœ…
  - **éªŒæ”¶æ ‡å‡†**:
    - âœ“ Tauri v2 é¡¹ç›®åˆå§‹åŒ–
    - âœ“ æ‰“åŒ… Windows/macOS/Linux
    - âœ“ è‡ªåŠ¨æ›´æ–°æœºåˆ¶
    - âœ“ æœ¬åœ°æ–‡ä»¶è®¿é—®æƒé™
  - **æŠ€æœ¯è¦ç‚¹**:
    - ä½¿ç”¨ Tauri v2 (Rust åç«¯)
    - é›†æˆç°æœ‰ Next.js å‰ç«¯
    - é…ç½® IPC é€šä¿¡

---

#### 6.2.4 è°ƒè¯•å·¥å…· (W9-10)

| ID        | ä»»åŠ¡             | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ–      | ä¼°æ—¶ |
| --------- | ---------------- | ------ | ---- | --------- | ---- |
| DEBUG-001 | èŠ‚ç‚¹æ–­ç‚¹åŠŸèƒ½     | ğŸŸ  P1  | â¬œ   | EXE-001   | 12h  |
| DEBUG-002 | å˜é‡ç›‘è§†å™¨       | ğŸŸ  P1  | â¬œ   | DEBUG-001 | 8h   |
| DEBUG-003 | æ‰§è¡Œæ­¥è¿›åŠŸèƒ½     | ğŸŸ  P1  | â¬œ   | DEBUG-001 | 12h  |
| DEBUG-004 | æ€§èƒ½åˆ†æé¢æ¿     | ğŸŸ¡ P2  | â¬œ   | DEBUG-001 | 12h  |
| DEBUG-005 | æ‰§è¡Œæ—¶é—´çº¿å¯è§†åŒ– | ğŸŸ¡ P2  | â¬œ   | DEBUG-001 | 8h   |
| DEBUG-006 | è¾“å…¥/è¾“å‡ºæ£€æŸ¥å™¨  | ğŸŸ  P1  | â¬œ   | DEBUG-001 | 8h   |

---

### 6.3 Phase 3: ç¤¾åŒºç”Ÿæ€ (W1-9)

#### 6.3.1 Agent å•†åº— (W1-3)

| ID        | ä»»åŠ¡                  | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ–      | ä¼°æ—¶ |
| --------- | --------------------- | ------ | ---- | --------- | ---- |
| STORE-001 | è®¾è®¡å•†åº—é¦–é¡µ UI       | ğŸ”´ P0  | â¬œ   | Phase 1   | 12h  |
| STORE-002 | å®ç° Agent åˆ—è¡¨ä¸æœç´¢ | ğŸ”´ P0  | â¬œ   | STORE-001 | 12h  |
| STORE-003 | å®ç° Agent è¯¦æƒ…é¡µ     | ğŸ”´ P0  | â¬œ   | STORE-001 | 12h  |
| STORE-004 | å®ç°è¯„åˆ†è¯„ä»·ç³»ç»Ÿ      | ğŸŸ  P1  | â¬œ   | STORE-003 | 8h   |
| STORE-005 | å®ç°æ”¶è—åŠŸèƒ½          | ğŸŸ  P1  | â¬œ   | STORE-003 | 4h   |
| STORE-006 | å®ç°è¯•ç”¨åŠŸèƒ½          | ğŸŸ  P1  | â¬œ   | STORE-003 | 8h   |
| STORE-007 | å®ç° Fork åŠŸèƒ½        | ğŸŸ  P1  | â¬œ   | STORE-003 | 8h   |
| STORE-008 | å®ç°åˆ†ç±»ç®¡ç†          | ğŸŸ  P1  | â¬œ   | STORE-002 | 6h   |
| STORE-009 | Agent å‘å¸ƒæµç¨‹        | ğŸ”´ P0  | â¬œ   | STORE-001 | 12h  |
| STORE-010 | å®¡æ ¸ç³»ç»Ÿ              | ğŸŸ  P1  | â¬œ   | STORE-009 | 12h  |

---

#### 6.3.2 åˆ†äº«æœºåˆ¶ (W4-6)

| ID        | ä»»åŠ¡          | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ–      | ä¼°æ—¶ |
| --------- | ------------- | ------ | ---- | --------- | ---- |
| SHARE-001 | é“¾æ¥åˆ†äº«      | ğŸ”´ P0  | â¬œ   | STORE-009 | 8h   |
| SHARE-002 | åµŒå…¥ä»£ç ç”Ÿæˆ  | ğŸŸ  P1  | â¬œ   | SHARE-001 | 6h   |
| SHARE-003 | ç‰ˆæœ¬å†å²      | ğŸŸ  P1  | â¬œ   | STORE-009 | 12h  |
| SHARE-004 | åä½œæƒé™      | ğŸŸ  P1  | â¬œ   | SHARE-001 | 12h  |
| SHARE-005 | ç§æœ‰/å…¬å¼€åˆ‡æ¢ | ğŸŸ  P1  | â¬œ   | SHARE-001 | 4h   |
| SHARE-006 | åˆ†äº«ç»Ÿè®¡      | ğŸŸ¡ P2  | â¬œ   | SHARE-001 | 8h   |

---

#### 6.3.3 åˆ›ä½œè€…ç»æµ (W7-9)

| ID       | ä»»åŠ¡               | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ–         | ä¼°æ—¶ |
| -------- | ------------------ | ------ | ---- | ------------ | ---- |
| ECON-001 | å®ç°åˆ›ä½œè€…è´¦æˆ·ç³»ç»Ÿ | ğŸ”´ P0  | â¬œ   | Phase 1      | 12h  |
| ECON-002 | é›†æˆæ”¯ä»˜å®æ”¯ä»˜     | ğŸŸ  P1  | â¬œ   | ECON-001     | 16h  |
| ECON-003 | é›†æˆå¾®ä¿¡æ”¯ä»˜       | ğŸŸ  P1  | â¬œ   | ECON-001     | 16h  |
| ECON-004 | å®ç°è®¢å•ç®¡ç†       | ğŸ”´ P0  | â¬œ   | ECON-002/003 | 12h  |
| ECON-005 | å®ç°æ”¶å…¥åˆ†æˆè®¡ç®—   | ğŸ”´ P0  | â¬œ   | ECON-004     | 8h   |
| ECON-006 | å®ç°æç°åŠŸèƒ½       | ğŸŸ  P1  | â¬œ   | ECON-005     | 12h  |
| ECON-007 | å®ç°åˆ›ä½œè€…ç­‰çº§ç³»ç»Ÿ | ğŸŸ¡ P2  | â¬œ   | ECON-001     | 8h   |
| ECON-008 | å®ç°åˆ›ä½œè€…æ•°æ®åˆ†æ | ğŸŸ  P1  | â¬œ   | ECON-001     | 12h  |
| ECON-009 | å®ç°æ¿€åŠ±æœºåˆ¶       | ğŸŸ¡ P2  | â¬œ   | ECON-007     | 8h   |
| ECON-010 | å®ç°ç¨åŠ¡åˆè§„       | ğŸŸ  P1  | â¬œ   | ECON-006     | 12h  |

---

### 6.4 Phase 4: è§„æ¨¡åŒ– (W1-12)

#### 6.4.1 ä¼ä¸šç‰ˆ (W1-4)

| ID      | ä»»åŠ¡                 | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ–      | ä¼°æ—¶ |
| ------- | -------------------- | ------ | ---- | --------- | ---- |
| ENT-001 | ç§æœ‰åŒ–éƒ¨ç½²æ–¹æ¡ˆ       | ğŸ”´ P0  | â¬œ   | Phase 1~3 | 40h  |
| ENT-002 | Docker/K8s éƒ¨ç½²æ¨¡æ¿  | ğŸ”´ P0  | â¬œ   | ENT-001   | 24h  |
| ENT-003 | SSO é›†æˆ (SAML/OIDC) | ğŸŸ  P1  | â¬œ   | ENT-001   | 24h  |
| ENT-004 | LDAP/AD é›†æˆ         | ğŸŸ  P1  | â¬œ   | ENT-003   | 16h  |
| ENT-005 | å®¡è®¡æ—¥å¿—ç³»ç»Ÿ         | ğŸŸ  P1  | â¬œ   | ENT-001   | 16h  |
| ENT-006 | é«˜çº§æƒé™ç®¡ç† (RBAC)  | ğŸŸ  P1  | â¬œ   | ENT-001   | 20h  |
| ENT-007 | SLA ä¿éšœä¸ç›‘æ§       | ğŸŸ¡ P2  | â¬œ   | ENT-001   | 16h  |
| ENT-008 | ä¼ä¸šç®¡ç†åå°         | ğŸŸ  P1  | â¬œ   | ENT-001   | 24h  |

---

#### 6.4.2 å›¢é˜Ÿåä½œ (W5-8)

| ID       | ä»»åŠ¡                   | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ–     | ä¼°æ—¶ |
| -------- | ---------------------- | ------ | ---- | -------- | ---- |
| TEAM-001 | å›¢é˜Ÿ/ç»„ç»‡ç®¡ç†          | ğŸ”´ P0  | â¬œ   | Phase 1  | 16h  |
| TEAM-002 | æˆå‘˜é‚€è¯·ä¸è§’è‰²ç®¡ç†     | ğŸ”´ P0  | â¬œ   | TEAM-001 | 12h  |
| TEAM-003 | å®æ—¶åä½œç¼–è¾‘ (OT/CRDT) | ğŸŸ  P1  | â¬œ   | TEAM-001 | 40h  |
| TEAM-004 | èµ„æºå…±äº«ä¸æƒé™         | ğŸŸ  P1  | â¬œ   | TEAM-001 | 12h  |
| TEAM-005 | è¯„è®ºä¸æ ‡æ³¨åŠŸèƒ½         | ğŸŸ¡ P2  | â¬œ   | TEAM-001 | 12h  |
| TEAM-006 | æ´»åŠ¨æµä¸é€šçŸ¥           | ğŸŸ¡ P2  | â¬œ   | TEAM-001 | 8h   |
| TEAM-007 | å›¢é˜Ÿå·¥ä½œç©ºé—´           | ğŸŸ  P1  | â¬œ   | TEAM-001 | 12h  |

---

#### 6.4.3 é«˜çº§åŠŸèƒ½ (W9-12)

| ID      | ä»»åŠ¡               | ä¼˜å…ˆçº§ | çŠ¶æ€ | ä¾èµ–    | ä¼°æ—¶ |
| ------- | ------------------ | ------ | ---- | ------- | ---- |
| ADV-001 | ä½¿ç”¨åˆ†æä»ªè¡¨ç›˜     | ğŸŸ  P1  | â¬œ   | Phase 1 | 24h  |
| ADV-002 | æ€§èƒ½ç›‘æ§ç³»ç»Ÿ       | ğŸŸ  P1  | â¬œ   | Phase 1 | 20h  |
| ADV-003 | è‡ªåŠ¨ä¼˜åŒ–å»ºè®®       | ğŸŸ¡ P2  | â¬œ   | ADV-001 | 24h  |
| ADV-004 | AI è¾…åŠ©æ­å»º        | ğŸŸ¡ P2  | â¬œ   | Phase 1 | 32h  |
| ADV-005 | å·¥ä½œæµæ¨¡æ¿åº“       | ğŸŸ  P1  | â¬œ   | Phase 1 | 16h  |
| ADV-006 | æ‰¹é‡æ“ä½œæ”¯æŒ       | ğŸŸ¡ P2  | â¬œ   | Phase 1 | 12h  |
| ADV-007 | å¯¼å…¥/å¯¼å‡ºåŠŸèƒ½      | ğŸŸ  P1  | â¬œ   | Phase 1 | 12h  |
| ADV-008 | API é€Ÿç‡é™åˆ¶ä¸é…é¢ | ğŸŸ  P1  | â¬œ   | Phase 1 | 12h  |

---

### 6.5 ä»»åŠ¡ç»Ÿè®¡æ¦‚è§ˆ

| Phase               | ä»»åŠ¡æ•°   | P0     | P1     | P2     | P3    | é¢„ä¼°å·¥æ—¶   |
| ------------------- | -------- | ------ | ------ | ------ | ----- | ---------- |
| Phase 1: æ ¸å¿ƒ MVP   | 120+     | 45     | 50     | 20     | 5     | ~800h      |
| Phase 2: è‡ªå®šä¹‰èƒ½åŠ› | 35+      | 10     | 18     | 7      | 0     | ~300h      |
| Phase 3: ç¤¾åŒºç”Ÿæ€   | 30+      | 8      | 16     | 6      | 0     | ~280h      |
| Phase 4: è§„æ¨¡åŒ–     | 25+      | 5      | 14     | 6      | 0     | ~350h      |
| **æ€»è®¡**            | **210+** | **68** | **98** | **39** | **5** | **~1730h** |

---

### 6.6 é‡Œç¨‹ç¢‘æ£€æŸ¥ç‚¹

| é‡Œç¨‹ç¢‘         | ç›®æ ‡æ—¶é—´ | å…³é”®äº¤ä»˜ç‰©         | éªŒæ”¶æ ‡å‡†                 |
| -------------- | -------- | ------------------ | ------------------------ |
| M1: åŸºç¡€æ¡†æ¶   | W2       | å‰åç«¯é¡¹ç›®æ­å»ºå®Œæˆ | å¯è¿è¡Œã€CI é€šè¿‡          |
| M2: ç¼–è¾‘å™¨å¯ç”¨ | W4       | å¯è§†åŒ–ç¼–è¾‘å™¨ MVP   | å¯æ‹–æ‹½èŠ‚ç‚¹ã€è¿çº¿         |
| M3: æ‰§è¡Œå¼•æ“   | W8       | å·¥ä½œæµå¯æ‰§è¡Œ       | ç«¯åˆ°ç«¯æ‰§è¡ŒæˆåŠŸ           |
| M4: MVP å‘å¸ƒ   | W12      | Phase 1 å®Œæˆ       | å¯æ³¨å†Œã€åˆ›å»ºã€æ‰§è¡Œå·¥ä½œæµ |
| M5: SDK å‘å¸ƒ   | P2-W3    | èŠ‚ç‚¹ SDK           | å¼€å‘è€…å¯åˆ›å»ºè‡ªå®šä¹‰èŠ‚ç‚¹   |
| M6: å•†åº—ä¸Šçº¿   | P3-W3    | Agent å•†åº—         | ç”¨æˆ·å¯å‘å¸ƒ/ä¸‹è½½ Agent    |
| M7: ä¼ä¸šç‰ˆ     | P4-W4    | ä¼ä¸šåŠŸèƒ½           | ç§æœ‰éƒ¨ç½²ã€SSO            |

---

## 7. æ•°æ®åº“è®¾è®¡

### 7.1 ç”¨æˆ·è¡¨ (users)

```sql
CREATE TABLE users (
    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email           VARCHAR(255) UNIQUE NOT NULL,
    username        VARCHAR(50) UNIQUE NOT NULL,
    display_name    VARCHAR(100),
    avatar_url      VARCHAR(500),
    bio             TEXT,

    -- è®¤è¯ç›¸å…³
    password_hash   VARCHAR(255),
    email_verified  BOOLEAN DEFAULT FALSE,

    -- OAuth å…³è”
    github_id       VARCHAR(50),
    google_id       VARCHAR(50),

    -- é…ç½®
    settings        JSONB DEFAULT '{}',

    -- ç»Ÿè®¡
    workflow_count  INTEGER DEFAULT 0,
    agent_count     INTEGER DEFAULT 0,

    -- è®¢é˜…
    plan            VARCHAR(20) DEFAULT 'free',
    plan_expires_at TIMESTAMPTZ,

    -- æ—¶é—´æˆ³
    created_at      TIMESTAMPTZ DEFAULT NOW(),
    updated_at      TIMESTAMPTZ DEFAULT NOW(),
    last_login_at   TIMESTAMPTZ
);

CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_username ON users(username);
```

### 7.2 å·¥ä½œæµè¡¨ (workflows)

```sql
CREATE TABLE workflows (
    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id         UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,

    -- åŸºç¡€ä¿¡æ¯
    name            VARCHAR(200) NOT NULL,
    description     TEXT,
    icon            VARCHAR(50) DEFAULT 'ğŸ“‹',

    -- å·¥ä½œæµå®šä¹‰ (JSON)
    definition      JSONB NOT NULL,
    variables       JSONB DEFAULT '{}',

    -- çŠ¶æ€
    status          VARCHAR(20) DEFAULT 'draft',
    is_public       BOOLEAN DEFAULT FALSE,

    -- æ‰§è¡Œé…ç½®
    trigger_type    VARCHAR(50) DEFAULT 'manual',
    trigger_config  JSONB DEFAULT '{}',

    -- ç»Ÿè®¡
    run_count       INTEGER DEFAULT 0,
    star_count      INTEGER DEFAULT 0,
    fork_count      INTEGER DEFAULT 0,

    -- ç‰ˆæœ¬
    version         INTEGER DEFAULT 1,

    -- æ—¶é—´æˆ³
    created_at      TIMESTAMPTZ DEFAULT NOW(),
    updated_at      TIMESTAMPTZ DEFAULT NOW(),
    published_at    TIMESTAMPTZ,

    -- æ–‡ä»¶å¤¹
    folder_id       UUID
);

CREATE INDEX idx_workflows_user ON workflows(user_id);
CREATE INDEX idx_workflows_status ON workflows(status);
```

### 7.3 æ‰§è¡Œè®°å½•è¡¨ (executions)

```sql
CREATE TABLE executions (
    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    workflow_id     UUID NOT NULL REFERENCES workflows(id) ON DELETE CASCADE,
    user_id         UUID NOT NULL REFERENCES users(id),

    -- æ‰§è¡ŒçŠ¶æ€
    status          VARCHAR(20) NOT NULL DEFAULT 'pending',

    -- è§¦å‘ä¿¡æ¯
    trigger_type    VARCHAR(50) NOT NULL,
    trigger_data    JSONB DEFAULT '{}',

    -- æ‰§è¡Œæ•°æ®
    inputs          JSONB DEFAULT '{}',
    outputs         JSONB DEFAULT '{}',
    context         JSONB DEFAULT '{}',

    -- æ€§èƒ½æŒ‡æ ‡
    started_at      TIMESTAMPTZ,
    completed_at    TIMESTAMPTZ,
    duration_ms     INTEGER,

    -- é”™è¯¯ä¿¡æ¯
    error_message   TEXT,
    error_node_id   VARCHAR(100),

    -- èµ„æºæ¶ˆè€—
    token_usage     JSONB DEFAULT '{}',

    -- æ—¶é—´æˆ³
    created_at      TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_executions_workflow ON executions(workflow_id);
CREATE INDEX idx_executions_user ON executions(user_id);
CREATE INDEX idx_executions_status ON executions(status);
CREATE INDEX idx_executions_created ON executions(created_at);
```

### 7.4 èŠ‚ç‚¹æ‰§è¡Œæ—¥å¿—è¡¨ (node_logs)

```sql
CREATE TABLE node_logs (
    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    execution_id    UUID NOT NULL REFERENCES executions(id) ON DELETE CASCADE,
    node_id         VARCHAR(100) NOT NULL,
    node_type       VARCHAR(50) NOT NULL,

    -- æ‰§è¡Œæ•°æ®
    status          VARCHAR(20) NOT NULL,
    inputs          JSONB DEFAULT '{}',
    outputs         JSONB DEFAULT '{}',

    -- æ—¶é—´
    started_at      TIMESTAMPTZ,
    completed_at    TIMESTAMPTZ,
    duration_ms     INTEGER,

    -- é”™è¯¯
    error_message   TEXT,

    -- æ—¥å¿—
    logs            JSONB DEFAULT '[]',

    created_at      TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_node_logs_execution ON node_logs(execution_id);
CREATE INDEX idx_node_logs_node ON node_logs(node_id);
```

### 7.5 API å¯†é’¥è¡¨ (api_keys)

```sql
CREATE TABLE api_keys (
    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id         UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,

    provider        VARCHAR(50) NOT NULL,  -- openai, anthropic, etc.
    name            VARCHAR(100) NOT NULL,
    key_encrypted   TEXT NOT NULL,         -- åŠ å¯†å­˜å‚¨
    key_preview     VARCHAR(20),           -- sk-...xxxx

    is_active       BOOLEAN DEFAULT TRUE,
    last_used_at    TIMESTAMPTZ,

    created_at      TIMESTAMPTZ DEFAULT NOW(),
    updated_at      TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_api_keys_user ON api_keys(user_id);
```

### 7.6 Agent è¡¨ (agents)

```sql
CREATE TABLE agents (
    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id         UUID NOT NULL REFERENCES users(id),
    workflow_id     UUID NOT NULL REFERENCES workflows(id),

    -- åŸºç¡€ä¿¡æ¯
    name            VARCHAR(200) NOT NULL,
    slug            VARCHAR(100) UNIQUE NOT NULL,
    description     TEXT,
    long_description TEXT,
    icon            VARCHAR(50),
    cover_image     VARCHAR(500),

    -- åˆ†ç±»
    category        VARCHAR(50),
    tags            TEXT[] DEFAULT '{}',

    -- çŠ¶æ€
    status          VARCHAR(20) DEFAULT 'draft',

    -- å®šä»·
    pricing_type    VARCHAR(20) DEFAULT 'free',
    price           DECIMAL(10, 2),

    -- ç»Ÿè®¡
    use_count       INTEGER DEFAULT 0,
    star_count      INTEGER DEFAULT 0,
    avg_rating      DECIMAL(3, 2) DEFAULT 0,

    -- æ—¶é—´æˆ³
    created_at      TIMESTAMPTZ DEFAULT NOW(),
    updated_at      TIMESTAMPTZ DEFAULT NOW(),
    published_at    TIMESTAMPTZ
);

CREATE INDEX idx_agents_user ON agents(user_id);
CREATE INDEX idx_agents_slug ON agents(slug);
CREATE INDEX idx_agents_category ON agents(category);
CREATE INDEX idx_agents_status ON agents(status);
```

---

## 8. API æ¥å£è®¾è®¡

### 8.1 è®¤è¯æ¥å£

```yaml
# æ³¨å†Œ
POST /api/v1/auth/register
Request:
  email: string
  username: string
  password: string
Response:
  user: User
  access_token: string
  refresh_token: string

# ç™»å½•
POST /api/v1/auth/login
Request:
  email: string
  password: string
Response:
  user: User
  access_token: string
  refresh_token: string

# åˆ·æ–°Token
POST /api/v1/auth/refresh
Request:
  refresh_token: string
Response:
  access_token: string
  refresh_token: string

# ç™»å‡º
POST /api/v1/auth/logout
Header: Authorization: Bearer <token>

# OAuth ç™»å½•
GET /api/v1/auth/github
GET /api/v1/auth/github/callback
GET /api/v1/auth/google
GET /api/v1/auth/google/callback
```

### 8.2 å·¥ä½œæµæ¥å£

```yaml
# è·å–å·¥ä½œæµåˆ—è¡¨
GET /api/v1/workflows
Query:
  page: number (default: 1)
  page_size: number (default: 20)
  status: string (draft/published)
  search: string
Response:
  workflows: Workflow[]
  total: number

# åˆ›å»ºå·¥ä½œæµ
POST /api/v1/workflows
Request:
  name: string
  description?: string
  definition: WorkflowDefinition
Response:
  workflow: Workflow

# è·å–å·¥ä½œæµè¯¦æƒ…
GET /api/v1/workflows/:id
Response:
  workflow: Workflow

# æ›´æ–°å·¥ä½œæµ
PUT /api/v1/workflows/:id
Request:
  name?: string
  description?: string
  definition?: WorkflowDefinition
Response:
  workflow: Workflow

# åˆ é™¤å·¥ä½œæµ
DELETE /api/v1/workflows/:id

# æ‰§è¡Œå·¥ä½œæµ
POST /api/v1/workflows/:id/execute
Request:
  inputs?: object
  trigger_type: string
Response:
  execution: Execution

# å¤åˆ¶å·¥ä½œæµ
POST /api/v1/workflows/:id/duplicate
Response:
  workflow: Workflow
```

### 8.3 æ‰§è¡Œæ¥å£

```yaml
# è·å–æ‰§è¡Œåˆ—è¡¨
GET /api/v1/executions
Query:
  workflow_id?: string
  status?: string
  page: number
  page_size: number
Response:
  executions: Execution[]
  total: number

# è·å–æ‰§è¡Œè¯¦æƒ…
GET /api/v1/executions/:id
Response:
  execution: Execution
  node_logs: NodeLog[]

# å–æ¶ˆæ‰§è¡Œ
POST /api/v1/executions/:id/cancel

# é‡è¯•æ‰§è¡Œ
POST /api/v1/executions/:id/retry
```

### 8.4 ç”¨æˆ·æ¥å£

```yaml
# è·å–å½“å‰ç”¨æˆ·
GET /api/v1/users/me
Response:
  user: User

# æ›´æ–°ç”¨æˆ·èµ„æ–™
PUT /api/v1/users/me
Request:
  display_name?: string
  bio?: string
  avatar_url?: string
Response:
  user: User

# æ›´æ–°å¯†ç 
PUT /api/v1/users/me/password
Request:
  old_password: string
  new_password: string

# è·å– API å¯†é’¥åˆ—è¡¨
GET /api/v1/users/me/api-keys
Response:
  api_keys: ApiKey[]

# æ·»åŠ  API å¯†é’¥
POST /api/v1/users/me/api-keys
Request:
  provider: string
  name: string
  key: string
Response:
  api_key: ApiKey

# åˆ é™¤ API å¯†é’¥
DELETE /api/v1/users/me/api-keys/:id
```

### 8.5 Agent å•†åº—æ¥å£

```yaml
# è·å– Agent åˆ—è¡¨
GET /api/v1/agents
Query:
  category?: string
  search?: string
  sort?: string (popular/newest/rating)
  page: number
  page_size: number
Response:
  agents: Agent[]
  total: number

# è·å–ç²¾é€‰ Agent
GET /api/v1/agents/featured
Response:
  agents: Agent[]

# è·å–åˆ†ç±»åˆ—è¡¨
GET /api/v1/agents/categories
Response:
  categories: Category[]

# è·å– Agent è¯¦æƒ…
GET /api/v1/agents/:slug
Response:
  agent: AgentDetail

# ä½¿ç”¨ Agent
POST /api/v1/agents/:id/use
Request:
  inputs?: object
Response:
  execution: Execution

# Fork Agent
POST /api/v1/agents/:id/fork
Response:
  workflow: Workflow

# æ”¶è— Agent
POST /api/v1/agents/:id/star
DELETE /api/v1/agents/:id/star

# å‘å¸ƒ Agent
POST /api/v1/agents
Request:
  workflow_id: string
  name: string
  description: string
  category: string
  tags: string[]
  pricing_type: string
  price?: number
Response:
  agent: Agent
```

### 8.6 WebSocket äº‹ä»¶

```yaml
# è¿æ¥
ws://api.reverseai.app/ws?token=<jwt>

# è®¢é˜…æ‰§è¡ŒçŠ¶æ€
Client -> Server:
{
  "type": "subscribe",
  "payload": {
    "execution_id": "xxx"
  }
}

# æ‰§è¡Œäº‹ä»¶æ¨é€
Server -> Client:
{
  "type": "execution:started" | "execution:node_started" | "execution:node_completed" | "execution:completed" | "execution:failed",
  "payload": {
    "execution_id": "xxx",
    "node_id"?: "xxx",
    "status": "xxx",
    "outputs"?: {},
    "error"?: {}
  },
  "timestamp": "2026-01-26T10:00:00Z"
}
```

---

## 9. å‰ç«¯ç»„ä»¶è®¾è®¡

### 9.1 å¸ƒå±€ç»„ä»¶

```tsx
// components/layout/DashboardLayout.tsx
- Header (Logo, å¯¼èˆª, ç”¨æˆ·èœå•)
- Sidebar (å¯¼èˆªèœå•, å·¥ä½œæµåˆ—è¡¨)
- Main Content Area

// components/layout/EditorLayout.tsx
- Top Toolbar (ä¿å­˜, è¿è¡Œ, å‘å¸ƒ)
- Left Panel (èŠ‚ç‚¹é¢æ¿)
- Center Canvas (å·¥ä½œæµç”»å¸ƒ)
- Right Panel (é…ç½®é¢æ¿)
- Bottom Panel (æ—¥å¿—, å˜é‡)
```

### 9.2 å·¥ä½œæµç¼–è¾‘å™¨ç»„ä»¶

```tsx
// components/workflow/Canvas.tsx
- React Flow ç”»å¸ƒå®¹å™¨
- ç¼©æ”¾/å¹³ç§»æ§åˆ¶
- å°åœ°å›¾
- èƒŒæ™¯ç½‘æ ¼

// components/workflow/NodePanel.tsx
- èŠ‚ç‚¹åˆ†ç±»åˆ—è¡¨
- èŠ‚ç‚¹æœç´¢
- èŠ‚ç‚¹æ‹–æ‹½æº

// components/workflow/ConfigPanel.tsx
- èŠ‚ç‚¹é…ç½®è¡¨å•
- è¾“å…¥æ˜ å°„ç¼–è¾‘å™¨
- æµ‹è¯•é¢æ¿

// components/workflow/nodes/
- StartNode.tsx
- EndNode.tsx
- LLMNode.tsx
- HTTPNode.tsx
- ConditionNode.tsx
- LoopNode.tsx
- CodeNode.tsx
- ...
```

### 9.3 å…±äº«ç»„ä»¶

```tsx
// components/shared/
;-LoadingSpinner.tsx -
  EmptyState.tsx -
  ErrorBoundary.tsx -
  ConfirmDialog.tsx -
  SearchInput.tsx -
  Pagination.tsx -
  Badge.tsx -
  Avatar.tsx
```

### 9.4 çŠ¶æ€ç®¡ç†

```tsx
// stores/workflowStore.ts
interface WorkflowStore {
  // å½“å‰å·¥ä½œæµ
  workflow: Workflow | null
  nodes: Node[]
  edges: Edge[]

  // æ“ä½œ
  setWorkflow: (workflow: Workflow) => void
  addNode: (node: Node) => void
  updateNode: (id: string, data: Partial<Node>) => void
  removeNode: (id: string) => void
  addEdge: (edge: Edge) => void
  removeEdge: (id: string) => void

  // å†å²è®°å½•
  history: HistoryEntry[]
  undo: () => void
  redo: () => void
}

// stores/userStore.ts
interface UserStore {
  user: User | null
  isAuthenticated: boolean

  setUser: (user: User) => void
  logout: () => void
}

// stores/executionStore.ts
interface ExecutionStore {
  currentExecution: Execution | null
  nodeLogs: Record<string, NodeLog>

  setExecution: (execution: Execution) => void
  updateNodeLog: (nodeId: string, log: NodeLog) => void
}
```

---

## 10. åç«¯æœåŠ¡è®¾è®¡

### 10.1 æœåŠ¡å±‚æ¶æ„

```go
// internal/service/

// AuthService - è®¤è¯æœåŠ¡
type AuthService interface {
    Register(ctx context.Context, req RegisterRequest) (*User, *TokenPair, error)
    Login(ctx context.Context, email, password string) (*User, *TokenPair, error)
    RefreshToken(ctx context.Context, refreshToken string) (*TokenPair, error)
    OAuthLogin(ctx context.Context, provider string, code string) (*User, *TokenPair, error)
}

// WorkflowService - å·¥ä½œæµæœåŠ¡
type WorkflowService interface {
    Create(ctx context.Context, userID uuid.UUID, req CreateWorkflowRequest) (*Workflow, error)
    GetByID(ctx context.Context, id uuid.UUID) (*Workflow, error)
    List(ctx context.Context, userID uuid.UUID, params ListParams) (*PagedResult[Workflow], error)
    Update(ctx context.Context, id uuid.UUID, req UpdateWorkflowRequest) (*Workflow, error)
    Delete(ctx context.Context, id uuid.UUID) error
    Duplicate(ctx context.Context, id uuid.UUID) (*Workflow, error)
}

// ExecutionService - æ‰§è¡ŒæœåŠ¡
type ExecutionService interface {
    Execute(ctx context.Context, workflowID uuid.UUID, req ExecuteRequest) (*Execution, error)
    GetByID(ctx context.Context, id uuid.UUID) (*Execution, error)
    List(ctx context.Context, params ListParams) (*PagedResult[Execution], error)
    Cancel(ctx context.Context, id uuid.UUID) error
    Retry(ctx context.Context, id uuid.UUID) (*Execution, error)
}

// AgentService - Agent æœåŠ¡
type AgentService interface {
    Publish(ctx context.Context, req PublishAgentRequest) (*Agent, error)
    GetBySlug(ctx context.Context, slug string) (*Agent, error)
    List(ctx context.Context, params AgentListParams) (*PagedResult[Agent], error)
    Use(ctx context.Context, agentID uuid.UUID, inputs map[string]any) (*Execution, error)
    Fork(ctx context.Context, agentID uuid.UUID, userID uuid.UUID) (*Workflow, error)
}
```

### 10.2 æ‰§è¡Œå¼•æ“è®¾è®¡

```go
// internal/pkg/executor/

// Executor - å·¥ä½œæµæ‰§è¡Œå¼•æ“
type Executor struct {
    nodeExecutors map[string]NodeExecutor
    storage       ExecutionStorage
    notifier      ExecutionNotifier
}

// NodeExecutor - èŠ‚ç‚¹æ‰§è¡Œå™¨æ¥å£
type NodeExecutor interface {
    Execute(ctx context.Context, node Node, inputs map[string]any) (map[string]any, error)
    Validate(node Node) error
}

// å…·ä½“èŠ‚ç‚¹æ‰§è¡Œå™¨
type LLMNodeExecutor struct {
    aiService AIService
}

type HTTPNodeExecutor struct {
    httpClient *http.Client
}

type ConditionNodeExecutor struct {}

type LoopNodeExecutor struct {
    executor *Executor // ç”¨äºæ‰§è¡Œå¾ªç¯å†…çš„å­èŠ‚ç‚¹
}

type CodeNodeExecutor struct {
    sandbox Sandbox
}
```

### 10.3 ä¸­é—´ä»¶è®¾è®¡

```go
// internal/api/middleware/

// AuthMiddleware - JWT è®¤è¯ä¸­é—´ä»¶
func AuthMiddleware(jwtService JWTService) echo.MiddlewareFunc

// RateLimitMiddleware - é€Ÿç‡é™åˆ¶ä¸­é—´ä»¶
func RateLimitMiddleware(limiter RateLimiter) echo.MiddlewareFunc

// LoggerMiddleware - æ—¥å¿—ä¸­é—´ä»¶
func LoggerMiddleware(logger *zap.Logger) echo.MiddlewareFunc

// CORSMiddleware - CORS ä¸­é—´ä»¶
func CORSMiddleware() echo.MiddlewareFunc

// RecoverMiddleware - å¼‚å¸¸æ¢å¤ä¸­é—´ä»¶
func RecoverMiddleware() echo.MiddlewareFunc
```

---

## 11. æµ‹è¯•ç­–ç•¥

### 11.1 å‰ç«¯æµ‹è¯•

```yaml
å•å…ƒæµ‹è¯• (Vitest):
  - ç»„ä»¶æµ‹è¯•
  - Hook æµ‹è¯•
  - å·¥å…·å‡½æ•°æµ‹è¯•
  - Store æµ‹è¯•

é›†æˆæµ‹è¯•:
  - API é›†æˆæµ‹è¯•
  - ç»„ä»¶é›†æˆæµ‹è¯•

E2E æµ‹è¯• (Playwright):
  - ç”¨æˆ·æ³¨å†Œç™»å½•æµç¨‹
  - å·¥ä½œæµåˆ›å»ºç¼–è¾‘æµç¨‹
  - å·¥ä½œæµæ‰§è¡Œæµç¨‹
  - Agent å•†åº—æµç¨‹
```

### 11.2 åç«¯æµ‹è¯•

```yaml
å•å…ƒæµ‹è¯•:
  - Service å±‚æµ‹è¯•
  - Repository å±‚æµ‹è¯•
  - å·¥å…·å‡½æ•°æµ‹è¯•
  - æ‰§è¡Œå¼•æ“æµ‹è¯•

é›†æˆæµ‹è¯•:
  - API æ¥å£æµ‹è¯•
  - æ•°æ®åº“é›†æˆæµ‹è¯•
  - Redis é›†æˆæµ‹è¯•

æ€§èƒ½æµ‹è¯•:
  - API å‹åŠ›æµ‹è¯•
  - æ‰§è¡Œå¼•æ“æ€§èƒ½æµ‹è¯•
```

### 11.3 æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡

| ç±»å‹            | ç›®æ ‡è¦†ç›–ç‡ |
| --------------- | ---------- |
| å‰ç«¯æ ¸å¿ƒç»„ä»¶    | > 80%      |
| åç«¯ Service å±‚ | > 80%      |
| åç«¯ API æ¥å£   | > 90%      |
| E2E æ ¸å¿ƒæµç¨‹    | 100%       |

---

## 12. éƒ¨ç½²æ–¹æ¡ˆ

### 12.1 å¼€å‘ç¯å¢ƒ

```yaml
# docker-compose.dev.yml
services:
  postgres:
    image: postgres:16
    ports:
      - '5432:5432'
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: reverseai

  redis:
    image: redis:7
    ports:
      - '6379:6379'
```

### 12.2 ç”Ÿäº§ç¯å¢ƒ

```yaml
å‰ç«¯éƒ¨ç½²:
  - Vercel (è‡ªåŠ¨éƒ¨ç½²)
  - ç¯å¢ƒå˜é‡é…ç½®
  - CDN åŠ é€Ÿ

åç«¯éƒ¨ç½²:
  - Railway / Fly.io
  - Docker å®¹å™¨
  - è‡ªåŠ¨æ‰©ç¼©å®¹

æ•°æ®åº“:
  - Neon / Supabase (æ‰˜ç®¡ PostgreSQL)
  - Upstash (æ‰˜ç®¡ Redis)

æ–‡ä»¶å­˜å‚¨:
  - Cloudflare R2

ç›‘æ§:
  - Sentry (é”™è¯¯è¿½è¸ª)
  - Grafana Cloud (æŒ‡æ ‡ç›‘æ§)
```

### 12.3 CI/CD æµç¨‹

```yaml
# .github/workflows/ci.yml
name: CI/CD

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  frontend-test:
    - pnpm install
    - pnpm lint
    - pnpm test
    - pnpm build

  backend-test:
    - go mod download
    - go test ./...
    - go build

  deploy-preview:
    - è‡ªåŠ¨é¢„è§ˆéƒ¨ç½² (PR)

  deploy-production:
    - è‡ªåŠ¨ç”Ÿäº§éƒ¨ç½² (main)
```

---

# ç¬¬ä¸‰éƒ¨åˆ†ï¼šä»£ç çº§è‡ªå®šä¹‰ç³»ç»Ÿ

---

## 11. è‡ªå®šä¹‰èŠ‚ç‚¹ SDK

### 11.1 SDK æ¶æ„æ¦‚è¿°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     @reverseai/sdk æ¶æ„                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       å¼€å‘è€… API å±‚                              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ defineNode  â”‚  â”‚ Input/Outputâ”‚  â”‚ NodeContext (è¿è¡Œæ—¶)    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ (èŠ‚ç‚¹å®šä¹‰)  â”‚  â”‚ (ç±»å‹ç³»ç»Ÿ)  â”‚  â”‚ - llm, http, cache...  â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       æ ¸å¿ƒè¿è¡Œæ—¶å±‚                               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ èŠ‚ç‚¹åŠ è½½å™¨  â”‚  â”‚ ç±»å‹éªŒè¯å™¨  â”‚  â”‚ æ‰§è¡Œä¸Šä¸‹æ–‡ç®¡ç†å™¨        â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       æ²™ç®±æ‰§è¡Œå±‚                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ èµ„æºéš”ç¦»    â”‚  â”‚ æƒé™æ§åˆ¶    â”‚  â”‚ è¶…æ—¶ç®¡ç†                â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.2 èŠ‚ç‚¹å®šä¹‰æ¥å£

```typescript
// @reverseai/sdk/types.ts

/**
 * èŠ‚ç‚¹å®šä¹‰ä¸»æ¥å£
 */
export interface NodeDefinition<
  TInputs extends Record<string, InputDefinition> = Record<string, InputDefinition>,
  TOutputs extends Record<string, OutputDefinition> = Record<string, OutputDefinition>,
> {
  // ===== åŸºç¡€å…ƒæ•°æ® =====
  /** å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œæ ¼å¼: vendor/node-name æˆ– node-name */
  id: string
  /** æ˜¾ç¤ºåç§° */
  name: string
  /** èŠ‚ç‚¹æè¿° */
  description: string
  /** å›¾æ ‡ (emoji æˆ– å›¾ç‰‡URL) */
  icon: string
  /** åˆ†ç±» */
  category: NodeCategory
  /** ç‰ˆæœ¬å· (semver) */
  version: string
  /** ä½œè€… */
  author: string
  /** å…³é”®è¯ï¼Œç”¨äºæœç´¢ */
  keywords?: string[]
  /** æ–‡æ¡£é“¾æ¥ */
  documentation?: string

  // ===== è¾“å…¥è¾“å‡ºå®šä¹‰ =====
  /** è¾“å…¥ç«¯å£å®šä¹‰ */
  inputs: TInputs
  /** è¾“å‡ºç«¯å£å®šä¹‰ */
  outputs: TOutputs

  // ===== ç”Ÿå‘½å‘¨æœŸé’©å­ =====
  /** è¾“å…¥éªŒè¯ */
  validate?: (params: ValidateParams<TInputs>) => void | Promise<void>
  /** èŠ‚ç‚¹åˆå§‹åŒ– */
  setup?: (context: NodeContext) => void | Promise<void>
  /** æ ¸å¿ƒæ‰§è¡Œé€»è¾‘ */
  execute: (params: ExecuteParams<TInputs>) => Promise<OutputValues<TOutputs>>
  /** æ¸…ç†èµ„æº */
  teardown?: (context: NodeContext) => void | Promise<void>

  // ===== å¯é€‰é…ç½® =====
  /** æ‰§è¡Œè¶…æ—¶ (æ¯«ç§’) */
  timeout?: number
  /** é‡è¯•é…ç½® */
  retry?: RetryConfig
  /** æ‰€éœ€æƒé™ */
  permissions?: Permission[]
  /** æµ‹è¯•ç”¨ä¾‹ */
  tests?: TestCase<TInputs, TOutputs>[]
}

/**
 * èŠ‚ç‚¹åˆ†ç±»
 */
export type NodeCategory =
  | 'ai' // AI/LLM ç›¸å…³
  | 'integration' // ç¬¬ä¸‰æ–¹é›†æˆ
  | 'logic' // é€»è¾‘æ§åˆ¶
  | 'data' // æ•°æ®å¤„ç†
  | 'text' // æ–‡æœ¬å¤„ç†
  | 'code' // ä»£ç æ‰§è¡Œ
  | 'io' // è¾“å…¥è¾“å‡º
  | 'utility' // å·¥å…·ç±»
  | 'custom' // è‡ªå®šä¹‰

/**
 * æƒé™å£°æ˜
 */
export type Permission =
  | 'llm:call' // è°ƒç”¨ LLM
  | 'http:request' // å‘é€ HTTP è¯·æ±‚
  | 'http:internal' // è®¿é—®å†…ç½‘
  | 'fs:read' // è¯»å–æ–‡ä»¶
  | 'fs:write' // å†™å…¥æ–‡ä»¶
  | 'env:read' // è¯»å–ç¯å¢ƒå˜é‡
  | 'secrets:read' // è¯»å–ç”¨æˆ·å¯†é’¥
  | 'cache:read' // è¯»å–ç¼“å­˜
  | 'cache:write' // å†™å…¥ç¼“å­˜
```

### 11.3 è¾“å…¥è¾“å‡ºç±»å‹ç³»ç»Ÿ

```typescript
// @reverseai/sdk/inputs.ts

/**
 * è¾“å…¥ç±»å‹æ„å»ºå™¨
 */
export const Input = {
  /**
   * æ–‡æœ¬è¾“å…¥
   */
  text(options: TextInputOptions): TextInputDefinition {
    return {
      type: 'text',
      ...options,
    }
  },

  /**
   * é•¿æ–‡æœ¬è¾“å…¥
   */
  textarea(options: TextareaInputOptions): TextareaInputDefinition {
    return {
      type: 'textarea',
      ...options,
    }
  },

  /**
   * æ•°å­—è¾“å…¥
   */
  number(options: NumberInputOptions): NumberInputDefinition {
    return {
      type: 'number',
      ...options,
    }
  },

  /**
   * å¸ƒå°”è¾“å…¥
   */
  boolean(options: BooleanInputOptions): BooleanInputDefinition {
    return {
      type: 'boolean',
      ...options,
    }
  },

  /**
   * ä¸‹æ‹‰é€‰æ‹©
   */
  select<T extends string>(options: SelectInputOptions<T>): SelectInputDefinition<T> {
    return {
      type: 'select',
      ...options,
    }
  },

  /**
   * å¤šé€‰
   */
  multiSelect<T extends string>(
    options: MultiSelectInputOptions<T>
  ): MultiSelectInputDefinition<T> {
    return {
      type: 'multiSelect',
      ...options,
    }
  },

  /**
   * JSON å¯¹è±¡
   */
  json<T = unknown>(options: JsonInputOptions<T>): JsonInputDefinition<T> {
    return {
      type: 'json',
      ...options,
    }
  },

  /**
   * æ•°ç»„
   */
  array<T>(options: ArrayInputOptions<T>): ArrayInputDefinition<T> {
    return {
      type: 'array',
      ...options,
    }
  },

  /**
   * æ–‡ä»¶ä¸Šä¼ 
   */
  file(options: FileInputOptions): FileInputDefinition {
    return {
      type: 'file',
      ...options,
    }
  },

  /**
   * ä»£ç ç¼–è¾‘å™¨
   */
  code(options: CodeInputOptions): CodeInputDefinition {
    return {
      type: 'code',
      language: options.language || 'javascript',
      ...options,
    }
  },

  /**
   * å¯†é’¥å¼•ç”¨
   */
  secret(options: SecretInputOptions): SecretInputDefinition {
    return {
      type: 'secret',
      ...options,
    }
  },

  /**
   * åŠ¨æ€è¾“å…¥ (è¿è¡Œæ—¶ç¡®å®š)
   */
  dynamic(options: DynamicInputOptions): DynamicInputDefinition {
    return {
      type: 'dynamic',
      ...options,
    }
  },
}

/**
 * è¾“å‡ºç±»å‹æ„å»ºå™¨
 */
export const Output = {
  text(options: OutputOptions): TextOutputDefinition {
    return { type: 'text', ...options }
  },

  number(options: OutputOptions): NumberOutputDefinition {
    return { type: 'number', ...options }
  },

  boolean(options: OutputOptions): BooleanOutputDefinition {
    return { type: 'boolean', ...options }
  },

  json<T = unknown>(options: JsonOutputOptions<T>): JsonOutputDefinition<T> {
    return { type: 'json', ...options }
  },

  array<T>(options: ArrayOutputOptions<T>): ArrayOutputDefinition<T> {
    return { type: 'array', ...options }
  },

  file(options: FileOutputOptions): FileOutputDefinition {
    return { type: 'file', ...options }
  },

  stream(options: StreamOutputOptions): StreamOutputDefinition {
    return { type: 'stream', ...options }
  },
}

// ===== è¾“å…¥é€‰é¡¹ç±»å‹å®šä¹‰ =====

interface BaseInputOptions {
  /** æ˜¾ç¤ºæ ‡ç­¾ */
  label: string
  /** æ˜¯å¦å¿…å¡« */
  required?: boolean
  /** æè¿°è¯´æ˜ */
  description?: string
  /** å ä½ç¬¦ */
  placeholder?: string
  /** é»˜è®¤å€¼ */
  default?: unknown
  /** æ˜¯å¦æ”¯æŒå˜é‡å¼•ç”¨ */
  allowVariable?: boolean
  /** æ¡ä»¶æ˜¾ç¤º */
  showIf?: (inputs: Record<string, unknown>) => boolean
}

interface TextInputOptions extends BaseInputOptions {
  default?: string
  minLength?: number
  maxLength?: number
  pattern?: string
  patternError?: string
}

interface NumberInputOptions extends BaseInputOptions {
  default?: number
  min?: number
  max?: number
  step?: number
  unit?: string
}

interface SelectInputOptions<T extends string> extends BaseInputOptions {
  options: Array<{ value: T; label: string; description?: string }>
  default?: T
}

interface CodeInputOptions extends BaseInputOptions {
  language: 'javascript' | 'typescript' | 'python' | 'json' | 'yaml' | 'sql'
  default?: string
  height?: number
}
```

### 11.4 æ‰§è¡Œä¸Šä¸‹æ–‡ (NodeContext)

```typescript
// @reverseai/sdk/context.ts

/**
 * èŠ‚ç‚¹æ‰§è¡Œä¸Šä¸‹æ–‡ - æä¾›è¿è¡Œæ—¶èƒ½åŠ›
 */
export interface NodeContext {
  // ===== æ‰§è¡Œä¿¡æ¯ =====
  /** å½“å‰æ‰§è¡ŒID */
  executionId: string
  /** å½“å‰èŠ‚ç‚¹ID */
  nodeId: string
  /** å·¥ä½œæµID */
  workflowId: string
  /** ç”¨æˆ·ID */
  userId: string

  // ===== LLM æœåŠ¡ =====
  llm: {
    /**
     * å¯¹è¯å¼è°ƒç”¨
     */
    chat(options: LLMChatOptions): Promise<LLMChatResponse>

    /**
     * æµå¼å¯¹è¯
     */
    chatStream(options: LLMChatOptions): AsyncIterable<LLMStreamChunk>

    /**
     * æ–‡æœ¬åµŒå…¥
     */
    embed(options: EmbedOptions): Promise<EmbedResponse>

    /**
     * è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨
     */
    listModels(): Promise<ModelInfo[]>
  }

  // ===== HTTP å®¢æˆ·ç«¯ =====
  http: {
    /**
     * å‘é€ HTTP è¯·æ±‚
     */
    request<T = unknown>(options: HttpRequestOptions): Promise<HttpResponse<T>>

    /**
     * GET è¯·æ±‚
     */
    get<T = unknown>(url: string, options?: HttpOptions): Promise<HttpResponse<T>>

    /**
     * POST è¯·æ±‚
     */
    post<T = unknown>(url: string, data?: unknown, options?: HttpOptions): Promise<HttpResponse<T>>
  }

  // ===== ç¼“å­˜æœåŠ¡ =====
  cache: {
    /**
     * è·å–ç¼“å­˜
     */
    get<T = unknown>(key: string): Promise<T | null>

    /**
     * è®¾ç½®ç¼“å­˜
     */
    set<T = unknown>(key: string, value: T, ttl?: number): Promise<void>

    /**
     * åˆ é™¤ç¼“å­˜
     */
    delete(key: string): Promise<void>

    /**
     * æ£€æŸ¥ç¼“å­˜æ˜¯å¦å­˜åœ¨
     */
    has(key: string): Promise<boolean>
  }

  // ===== å¯†é’¥ç®¡ç† =====
  secrets: {
    /**
     * è·å–ç”¨æˆ·é…ç½®çš„å¯†é’¥
     */
    get(provider: string): Promise<string | null>

    /**
     * åˆ—å‡ºå·²é…ç½®çš„å¯†é’¥æä¾›å•†
     */
    list(): Promise<string[]>
  }

  // ===== æ–‡ä»¶æ“ä½œ (æ²™ç®±å†…) =====
  fs: {
    /**
     * è¯»å–æ–‡ä»¶
     */
    read(path: string): Promise<Buffer>

    /**
     * è¯»å–æ–‡æœ¬æ–‡ä»¶
     */
    readText(path: string, encoding?: string): Promise<string>

    /**
     * å†™å…¥æ–‡ä»¶
     */
    write(path: string, data: Buffer | string): Promise<void>

    /**
     * åˆ—å‡ºç›®å½•
     */
    list(path: string): Promise<FileInfo[]>

    /**
     * ä¸´æ—¶æ–‡ä»¶
     */
    temp(prefix?: string): Promise<string>
  }

  // ===== æ—¥å¿—æœåŠ¡ =====
  log: {
    debug(message: string, data?: Record<string, unknown>): void
    info(message: string, data?: Record<string, unknown>): void
    warn(message: string, data?: Record<string, unknown>): void
    error(message: string, error?: Error, data?: Record<string, unknown>): void
  }

  // ===== è¿›åº¦ä¸ŠæŠ¥ =====
  progress: {
    /**
     * æ›´æ–°è¿›åº¦ (0-100)
     */
    update(percent: number, message?: string): void

    /**
     * å¢åŠ è¿›åº¦
     */
    increment(delta: number, message?: string): void
  }

  // ===== äº‹ä»¶ç³»ç»Ÿ =====
  events: {
    /**
     * å‘é€è‡ªå®šä¹‰äº‹ä»¶
     */
    emit(event: string, data?: unknown): void
  }

  // ===== é…ç½®è®¿é—® =====
  config: {
    /** é»˜è®¤æ¨¡å‹ */
    defaultModel: string
    /** æ‰§è¡Œæ¨¡å¼ */
    executionMode: 'cloud' | 'local' | 'hybrid'
    /** ç”¨æˆ·åå¥½ */
    preferences: Record<string, unknown>
  }

  // ===== å·¥å…·æ–¹æ³• =====
  utils: {
    /**
     * ç”Ÿæˆå”¯ä¸€ID
     */
    uuid(): string

    /**
     * å»¶æ—¶
     */
    sleep(ms: number): Promise<void>

    /**
     * é‡è¯•
     */
    retry<T>(fn: () => Promise<T>, options?: RetryOptions): Promise<T>
  }
}

// ===== LLM ç›¸å…³ç±»å‹ =====

interface LLMChatOptions {
  model?: string
  messages: Array<{
    role: 'system' | 'user' | 'assistant'
    content: string
  }>
  temperature?: number
  maxTokens?: number
  topP?: number
  stop?: string[]
  responseFormat?: {
    type: 'text' | 'json'
    schema?: Record<string, unknown>
  }
}

interface LLMChatResponse {
  content: string
  model: string
  usage: {
    promptTokens: number
    completionTokens: number
    totalTokens: number
  }
  finishReason: 'stop' | 'length' | 'content_filter'
}
```

### 11.5 å®Œæ•´èŠ‚ç‚¹ç¤ºä¾‹

```typescript
// examples/translator-node.ts
import { defineNode, Input, Output, NodeContext, ValidationError } from '@reverseai/sdk'

/**
 * å¤šè¯­è¨€ç¿»è¯‘èŠ‚ç‚¹
 * æ”¯æŒè‡ªåŠ¨è¯­è¨€æ£€æµ‹å’Œå¤šç§ç¿»è¯‘é£æ ¼
 */
export default defineNode({
  // ===== å…ƒæ•°æ® =====
  id: 'reverseai/translator',
  name: 'å¤šè¯­è¨€ç¿»è¯‘å™¨',
  description: 'ä½¿ç”¨ AI å°†æ–‡æœ¬ç¿»è¯‘æˆç›®æ ‡è¯­è¨€ï¼Œæ”¯æŒè‡ªåŠ¨è¯­è¨€æ£€æµ‹',
  icon: 'ğŸŒ',
  category: 'ai',
  version: '1.0.0',
  author: 'reverseai',
  keywords: ['ç¿»è¯‘', 'translate', 'language', 'å¤šè¯­è¨€'],
  documentation: 'https://docs.reverseai.app/nodes/translator',

  // ===== è¾“å…¥å®šä¹‰ =====
  inputs: {
    text: Input.textarea({
      label: 'å¾…ç¿»è¯‘æ–‡æœ¬',
      required: true,
      placeholder: 'è¾“å…¥éœ€è¦ç¿»è¯‘çš„æ–‡æœ¬...',
      description: 'æ”¯æŒæœ€å¤š 10000 å­—ç¬¦',
      maxLength: 10000,
      allowVariable: true,
    }),

    sourceLang: Input.select({
      label: 'æºè¯­è¨€',
      options: [
        { value: 'auto', label: 'ğŸ” è‡ªåŠ¨æ£€æµ‹' },
        { value: 'zh', label: 'ğŸ‡¨ğŸ‡³ ä¸­æ–‡' },
        { value: 'en', label: 'ğŸ‡ºğŸ‡¸ è‹±æ–‡' },
        { value: 'ja', label: 'ğŸ‡¯ğŸ‡µ æ—¥æ–‡' },
        { value: 'ko', label: 'ğŸ‡°ğŸ‡· éŸ©æ–‡' },
        { value: 'fr', label: 'ğŸ‡«ğŸ‡· æ³•æ–‡' },
        { value: 'de', label: 'ğŸ‡©ğŸ‡ª å¾·æ–‡' },
        { value: 'es', label: 'ğŸ‡ªğŸ‡¸ è¥¿ç­ç‰™æ–‡' },
      ],
      default: 'auto',
      description: 'é€‰æ‹©æºæ–‡æœ¬çš„è¯­è¨€',
    }),

    targetLang: Input.select({
      label: 'ç›®æ ‡è¯­è¨€',
      required: true,
      options: [
        { value: 'zh', label: 'ğŸ‡¨ğŸ‡³ ä¸­æ–‡' },
        { value: 'en', label: 'ğŸ‡ºğŸ‡¸ è‹±æ–‡' },
        { value: 'ja', label: 'ğŸ‡¯ğŸ‡µ æ—¥æ–‡' },
        { value: 'ko', label: 'ğŸ‡°ğŸ‡· éŸ©æ–‡' },
        { value: 'fr', label: 'ğŸ‡«ğŸ‡· æ³•æ–‡' },
        { value: 'de', label: 'ğŸ‡©ğŸ‡ª å¾·æ–‡' },
        { value: 'es', label: 'ğŸ‡ªğŸ‡¸ è¥¿ç­ç‰™æ–‡' },
      ],
      description: 'é€‰æ‹©ç¿»è¯‘ç›®æ ‡è¯­è¨€',
    }),

    style: Input.select({
      label: 'ç¿»è¯‘é£æ ¼',
      options: [
        { value: 'formal', label: 'ğŸ“ æ­£å¼', description: 'é€‚åˆå•†åŠ¡ã€å­¦æœ¯åœºæ™¯' },
        { value: 'casual', label: 'ğŸ’¬ å£è¯­åŒ–', description: 'é€‚åˆæ—¥å¸¸å¯¹è¯' },
        { value: 'technical', label: 'ğŸ”§ æŠ€æœ¯æ–‡æ¡£', description: 'ä¿ç•™ä¸“ä¸šæœ¯è¯­' },
        { value: 'creative', label: 'âœ¨ åˆ›æ„', description: 'æ›´è‡ªç„¶æµç•…çš„è¡¨è¾¾' },
      ],
      default: 'formal',
    }),

    preserveFormatting: Input.boolean({
      label: 'ä¿ç•™æ ¼å¼',
      default: true,
      description: 'ä¿ç•™åŸæ–‡çš„æ¢è¡Œå’Œæ®µè½æ ¼å¼',
    }),

    glossary: Input.json({
      label: 'æœ¯è¯­è¡¨',
      required: false,
      description: 'è‡ªå®šä¹‰æœ¯è¯­æ˜ å°„ï¼Œæ ¼å¼: {"åŸæ–‡": "è¯‘æ–‡"}',
      placeholder: '{"API": "åº”ç”¨ç¨‹åºæ¥å£"}',
    }),
  },

  // ===== è¾“å‡ºå®šä¹‰ =====
  outputs: {
    translatedText: Output.text({
      label: 'ç¿»è¯‘ç»“æœ',
    }),

    detectedLang: Output.text({
      label: 'æ£€æµ‹åˆ°çš„æºè¯­è¨€',
    }),

    confidence: Output.number({
      label: 'ç¿»è¯‘ç½®ä¿¡åº¦',
      description: '0-1 ä¹‹é—´çš„ç½®ä¿¡åº¦åˆ†æ•°',
    }),

    wordCount: Output.json({
      label: 'å­—æ•°ç»Ÿè®¡',
      schema: {
        source: 'number',
        target: 'number',
      },
    }),
  },

  // ===== æƒé™å£°æ˜ =====
  permissions: ['llm:call'],

  // ===== è¶…æ—¶é…ç½® =====
  timeout: 60000, // 60ç§’

  // ===== é‡è¯•é…ç½® =====
  retry: {
    maxRetries: 3,
    backoffMs: 1000,
    backoffMultiplier: 2,
  },

  // ===== è¾“å…¥éªŒè¯ =====
  validate({ inputs }) {
    if (!inputs.text?.trim()) {
      throw new ValidationError('text', 'ç¿»è¯‘æ–‡æœ¬ä¸èƒ½ä¸ºç©º')
    }

    if (inputs.text.length > 10000) {
      throw new ValidationError('text', 'æ–‡æœ¬é•¿åº¦ä¸èƒ½è¶…è¿‡ 10000 å­—ç¬¦')
    }

    if (inputs.sourceLang !== 'auto' && inputs.sourceLang === inputs.targetLang) {
      throw new ValidationError('targetLang', 'ç›®æ ‡è¯­è¨€ä¸èƒ½ä¸æºè¯­è¨€ç›¸åŒ')
    }

    // éªŒè¯æœ¯è¯­è¡¨æ ¼å¼
    if (inputs.glossary) {
      try {
        const glossary =
          typeof inputs.glossary === 'string' ? JSON.parse(inputs.glossary) : inputs.glossary

        if (typeof glossary !== 'object' || Array.isArray(glossary)) {
          throw new Error()
        }
      } catch {
        throw new ValidationError('glossary', 'æœ¯è¯­è¡¨æ ¼å¼æ— æ•ˆï¼Œè¯·ä½¿ç”¨ JSON å¯¹è±¡æ ¼å¼')
      }
    }
  },

  // ===== æ ¸å¿ƒæ‰§è¡Œé€»è¾‘ =====
  async execute({ inputs, context }) {
    const { text, sourceLang, targetLang, style, preserveFormatting, glossary } = inputs

    context.log.info('å¼€å§‹ç¿»è¯‘', {
      sourceLang,
      targetLang,
      textLength: text.length,
    })

    // æ›´æ–°è¿›åº¦
    context.progress.update(10, 'å‡†å¤‡ç¿»è¯‘...')

    // æ„å»ºç³»ç»Ÿæç¤ºè¯
    const styleGuides: Record<string, string> = {
      formal: 'ä½¿ç”¨æ­£å¼ã€ä¸“ä¸šçš„è¯­è¨€é£æ ¼',
      casual: 'ä½¿ç”¨å£è¯­åŒ–ã€è‡ªç„¶çš„è¡¨è¾¾æ–¹å¼',
      technical: 'ä¿ç•™æŠ€æœ¯æœ¯è¯­ï¼Œä½¿ç”¨å‡†ç¡®çš„ä¸“ä¸šè¡¨è¾¾',
      creative: 'è¿½æ±‚è‡ªç„¶æµç•…ï¼Œå¯ä»¥é€‚å½“æ„è¯‘ä»¥æå‡å¯è¯»æ€§',
    }

    let systemPrompt = `ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„ç¿»è¯‘ä¸“å®¶ã€‚è¯·å°†ç”¨æˆ·æä¾›çš„æ–‡æœ¬ç¿»è¯‘æˆ${getLanguageName(targetLang)}ã€‚

ç¿»è¯‘è¦æ±‚ï¼š
1. ${styleGuides[style]}
2. ${preserveFormatting ? 'ä¿ç•™åŸæ–‡çš„æ¢è¡Œå’Œæ®µè½æ ¼å¼' : 'å¯ä»¥è°ƒæ•´æ ¼å¼ä»¥æå‡å¯è¯»æ€§'}
3. ç¡®ä¿ç¿»è¯‘å‡†ç¡®ã€é€šé¡º`

    // æ·»åŠ æœ¯è¯­è¡¨
    if (glossary && Object.keys(glossary).length > 0) {
      const glossaryText = Object.entries(glossary)
        .map(([k, v]) => `"${k}" â†’ "${v}"`)
        .join('\n')
      systemPrompt += `\n\nä¸“ä¸šæœ¯è¯­æ˜ å°„ï¼ˆè¯·ä¸¥æ ¼éµå¾ªï¼‰ï¼š\n${glossaryText}`
    }

    if (sourceLang === 'auto') {
      systemPrompt += '\n\nè¯·é¦–å…ˆæ£€æµ‹æºæ–‡æœ¬çš„è¯­è¨€ã€‚'
    }

    context.progress.update(30, 'è°ƒç”¨ç¿»è¯‘æ¨¡å‹...')

    // è°ƒç”¨ LLM
    const response = await context.llm.chat({
      model: context.config.defaultModel,
      messages: [
        { role: 'system', content: systemPrompt },
        {
          role: 'user',
          content: `è¯·ç¿»è¯‘ä»¥ä¸‹æ–‡æœ¬ï¼š\n\n${text}\n\nè¯·ä»¥ JSON æ ¼å¼è¿”å›ï¼š
{
  "translatedText": "ç¿»è¯‘ç»“æœ",
  "detectedLang": "æ£€æµ‹åˆ°çš„æºè¯­è¨€ä»£ç ",
  "confidence": 0.95
}`,
        },
      ],
      temperature: 0.3,
      responseFormat: {
        type: 'json',
        schema: {
          type: 'object',
          properties: {
            translatedText: { type: 'string' },
            detectedLang: { type: 'string' },
            confidence: { type: 'number' },
          },
          required: ['translatedText', 'detectedLang', 'confidence'],
        },
      },
    })

    context.progress.update(90, 'å¤„ç†ç»“æœ...')

    // è§£æå“åº”
    const result = JSON.parse(response.content)

    // è®¡ç®—å­—æ•°
    const wordCount = {
      source: countWords(text, result.detectedLang),
      target: countWords(result.translatedText, targetLang),
    }

    context.log.info('ç¿»è¯‘å®Œæˆ', {
      detectedLang: result.detectedLang,
      confidence: result.confidence,
      wordCount,
      tokensUsed: response.usage.totalTokens,
    })

    context.progress.update(100, 'å®Œæˆ')

    return {
      translatedText: result.translatedText,
      detectedLang: result.detectedLang,
      confidence: result.confidence,
      wordCount,
    }
  },

  // ===== æµ‹è¯•ç”¨ä¾‹ =====
  tests: [
    {
      name: 'ä¸­æ–‡åˆ°è‹±æ–‡ç¿»è¯‘',
      inputs: {
        text: 'ä½ å¥½ï¼Œä¸–ç•Œï¼',
        sourceLang: 'auto',
        targetLang: 'en',
        style: 'casual',
        preserveFormatting: true,
      },
      expected: {
        detectedLang: 'zh',
      },
      validate(outputs) {
        return outputs.translatedText.toLowerCase().includes('hello')
      },
    },
    {
      name: 'å¸¦æœ¯è¯­è¡¨ç¿»è¯‘',
      inputs: {
        text: 'API æ˜¯åº”ç”¨ç¨‹åºçš„æ ¸å¿ƒã€‚',
        sourceLang: 'zh',
        targetLang: 'en',
        style: 'technical',
        glossary: { API: 'Application Programming Interface' },
      },
      validate(outputs) {
        return outputs.translatedText.includes('Application Programming Interface')
      },
    },
  ],
})

// ===== è¾…åŠ©å‡½æ•° =====

function getLanguageName(code: string): string {
  const names: Record<string, string> = {
    zh: 'ä¸­æ–‡',
    en: 'è‹±æ–‡',
    ja: 'æ—¥æ–‡',
    ko: 'éŸ©æ–‡',
    fr: 'æ³•æ–‡',
    de: 'å¾·æ–‡',
    es: 'è¥¿ç­ç‰™æ–‡',
  }
  return names[code] || code
}

function countWords(text: string, lang: string): number {
  if (['zh', 'ja', 'ko'].includes(lang)) {
    // CJK è¯­è¨€æŒ‰å­—ç¬¦è®¡æ•°
    return text.replace(/\s/g, '').length
  }
  // å…¶ä»–è¯­è¨€æŒ‰ç©ºæ ¼åˆ†è¯
  return text.trim().split(/\s+/).length
}
```

### 11.6 SDK å·¥ç¨‹ç»“æ„

```
@reverseai/sdk/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts              # ä¸»å…¥å£ï¼Œå¯¼å‡ºæ‰€æœ‰å…¬å¼€ API
â”‚   â”œâ”€â”€ define.ts             # defineNode å‡½æ•°
â”‚   â”œâ”€â”€ inputs.ts             # Input ç±»å‹æ„å»ºå™¨
â”‚   â”œâ”€â”€ outputs.ts            # Output ç±»å‹æ„å»ºå™¨
â”‚   â”œâ”€â”€ context.ts            # NodeContext æ¥å£
â”‚   â”œâ”€â”€ validation.ts         # éªŒè¯ç›¸å…³
â”‚   â”œâ”€â”€ errors.ts             # é”™è¯¯ç±»å‹
â”‚   â”‚
â”‚   â”œâ”€â”€ runtime/              # è¿è¡Œæ—¶å®ç°
â”‚   â”‚   â”œâ”€â”€ loader.ts         # èŠ‚ç‚¹åŠ è½½å™¨
â”‚   â”‚   â”œâ”€â”€ executor.ts       # èŠ‚ç‚¹æ‰§è¡Œå™¨
â”‚   â”‚   â”œâ”€â”€ sandbox.ts        # æ²™ç®±ç¯å¢ƒ
â”‚   â”‚   â””â”€â”€ context-impl.ts   # Context å®ç°
â”‚   â”‚
â”‚   â”œâ”€â”€ types/                # ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ node.ts
â”‚   â”‚   â”œâ”€â”€ input.ts
â”‚   â”‚   â”œâ”€â”€ output.ts
â”‚   â”‚   â””â”€â”€ common.ts
â”‚   â”‚
â”‚   â””â”€â”€ utils/                # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ retry.ts
â”‚       â”œâ”€â”€ timeout.ts
â”‚       â””â”€â”€ validation.ts
â”‚
â”œâ”€â”€ cli/                      # CLI å·¥å…·
â”‚   â”œâ”€â”€ init.ts               # åˆå§‹åŒ–é¡¹ç›®
â”‚   â”œâ”€â”€ build.ts              # æ„å»ºèŠ‚ç‚¹
â”‚   â”œâ”€â”€ test.ts               # æµ‹è¯•èŠ‚ç‚¹
â”‚   â””â”€â”€ publish.ts            # å‘å¸ƒèŠ‚ç‚¹
â”‚
â”œâ”€â”€ templates/                # é¡¹ç›®æ¨¡æ¿
â”‚   â”œâ”€â”€ basic/
â”‚   â””â”€â”€ advanced/
â”‚
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ README.md
```

### 11.7 SDK TodoList

- [x] å®šä¹‰ NodeDefinition æ ¸å¿ƒæ¥å£
- [x] å®ç° Input ç±»å‹æ„å»ºå™¨
- [x] å®ç° Output ç±»å‹æ„å»ºå™¨
- [x] å®ç° NodeContext æ¥å£
- [x] å®ç° ValidationError ç±»
- [x] å®ç°èŠ‚ç‚¹åŠ è½½å™¨
- [x] å®ç°èŠ‚ç‚¹æµ‹è¯•æ¡†æ¶
- [x] ç¼–å†™ CLI å·¥å…· (init/build/test/publish)
- [x] ç¼–å†™ç¤ºä¾‹èŠ‚ç‚¹
- [x] ç¼–å†™å®Œæ•´æ–‡æ¡£
- [ ] å‘å¸ƒ npm åŒ…

---

## 12. Prompt æ¨¡æ¿å¼•æ“

### 12.1 æ¨¡æ¿å¼•æ“æ¦‚è¿°

ReverseAI Prompt æ¨¡æ¿å¼•æ“æ˜¯ä¸€ä¸ªä¸“ä¸º AI Prompt è®¾è®¡çš„ DSLï¼ˆé¢†åŸŸç‰¹å®šè¯­è¨€ï¼‰ï¼Œæ”¯æŒå˜é‡æ’å€¼ã€æ¡ä»¶é€»è¾‘ã€å¾ªç¯ã€è¿‡æ»¤å™¨å’Œæ¨¡æ¿ç»§æ‰¿ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Prompt æ¨¡æ¿å¼•æ“æ¶æ„                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       æ¨¡æ¿è¯­æ³•å±‚                                 â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  {{ variable }}              å˜é‡æ’å€¼                           â”‚   â”‚
â”‚  â”‚  {% if condition %}          æ¡ä»¶è¯­å¥                           â”‚   â”‚
â”‚  â”‚  {% for item in list %}      å¾ªç¯è¯­å¥                           â”‚   â”‚
â”‚  â”‚  {{ value | filter }}        è¿‡æ»¤å™¨                             â”‚   â”‚
â”‚  â”‚  {# comment #}               æ³¨é‡Š                               â”‚   â”‚
â”‚  â”‚  {% include "partial" %}     æ¨¡æ¿åŒ…å«                           â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“ è§£æ                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       ç¼–è¯‘å™¨å±‚                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚   è¯æ³•åˆ†æ   â”‚â†’â”‚   è¯­æ³•åˆ†æ   â”‚â†’â”‚      AST ä¼˜åŒ–           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   Lexer     â”‚  â”‚   Parser    â”‚  â”‚   (å¸¸é‡æŠ˜å /æ­»ç æ¶ˆé™¤)   â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“ æ‰§è¡Œ                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       è¿è¡Œæ—¶å±‚                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚  ä¸Šä¸‹æ–‡ç®¡ç†  â”‚  â”‚  è¿‡æ»¤å™¨æ³¨å†Œ â”‚  â”‚     å®‰å…¨æ²™ç®±            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Context    â”‚  â”‚  Filters    â”‚  â”‚     (é˜²æ³¨å…¥)            â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 12.2 æ¨¡æ¿è¯­æ³•è§„èŒƒ

#### 12.2.1 å˜é‡æ’å€¼

```jinja2
{# åŸºç¡€å˜é‡ #}
Hello, {{ name }}!

{# å¯¹è±¡å±æ€§è®¿é—® #}
ç”¨æˆ·å: {{ user.name }}
é‚®ç®±: {{ user.email }}

{# æ•°ç»„ç´¢å¼•è®¿é—® #}
ç¬¬ä¸€é¡¹: {{ items[0] }}
æœ€åä¸€é¡¹: {{ items[-1] }}

{# é»˜è®¤å€¼ #}
{{ name | default("åŒ¿åç”¨æˆ·") }}

{# å¯é€‰é“¾ (å®‰å…¨è®¿é—®) #}
{{ user?.profile?.avatar }}

{# åŸå§‹è¾“å‡º (ä¸è½¬ä¹‰) #}
{% raw %}{{ è¿™é‡Œä¸ä¼šè¢«è§£æ }}{% endraw %}
```

#### 12.2.2 æ¡ä»¶è¯­å¥

```jinja2
{# åŸºç¡€ if #}
{% if isVIP %}
æ‚¨æ˜¯ VIP ç”¨æˆ·ï¼Œäº«å—ä¸“å±æœåŠ¡ã€‚
{% endif %}

{# if-else #}
{% if score >= 90 %}
ä¼˜ç§€
{% elif score >= 60 %}
åŠæ ¼
{% else %}
ä¸åŠæ ¼
{% endif %}

{# å¤æ‚æ¡ä»¶ #}
{% if user.age >= 18 and user.verified %}
å·²æˆå¹´ä¸”å·²éªŒè¯
{% endif %}

{% if status == "active" or status == "pending" %}
çŠ¶æ€æœ‰æ•ˆ
{% endif %}

{# å­˜åœ¨æ€§æ£€æŸ¥ #}
{% if user.email is defined %}
é‚®ç®±: {{ user.email }}
{% endif %}

{# ç©ºå€¼æ£€æŸ¥ #}
{% if items is not empty %}
å…± {{ items | length }} é¡¹
{% endif %}
```

#### 12.2.3 å¾ªç¯è¯­å¥

```jinja2
{# åŸºç¡€å¾ªç¯ #}
{% for item in items %}
- {{ item }}
{% endfor %}

{# å¸¦ç´¢å¼•å¾ªç¯ #}
{% for item, index in items %}
{{ index + 1 }}. {{ item }}
{% endfor %}

{# å¯¹è±¡å¾ªç¯ #}
{% for key, value in user %}
{{ key }}: {{ value }}
{% endfor %}

{# å¾ªç¯æ§åˆ¶ #}
{% for item in items %}
  {% if item.skip %}
    {% continue %}
  {% endif %}

  {% if item.stop %}
    {% break %}
  {% endif %}

  {{ item.name }}
{% endfor %}

{# å¾ªç¯å˜é‡ #}
{% for item in items %}
  {{ loop.index }}      {# å½“å‰ç´¢å¼• (ä»1å¼€å§‹) #}
  {{ loop.index0 }}     {# å½“å‰ç´¢å¼• (ä»0å¼€å§‹) #}
  {{ loop.first }}      {# æ˜¯å¦ç¬¬ä¸€é¡¹ #}
  {{ loop.last }}       {# æ˜¯å¦æœ€åä¸€é¡¹ #}
  {{ loop.length }}     {# æ€»é•¿åº¦ #}
{% endfor %}

{# ç©ºå¾ªç¯å¤„ç† #}
{% for item in items %}
  {{ item }}
{% else %}
  åˆ—è¡¨ä¸ºç©º
{% endfor %}
```

#### 12.2.4 è¿‡æ»¤å™¨

```jinja2
{# å­—ç¬¦ä¸²è¿‡æ»¤å™¨ #}
{{ name | upper }}              {# è½¬å¤§å†™ #}
{{ name | lower }}              {# è½¬å°å†™ #}
{{ name | capitalize }}         {# é¦–å­—æ¯å¤§å†™ #}
{{ name | title }}              {# æ ‡é¢˜æ ¼å¼ #}
{{ text | trim }}               {# å»é™¤é¦–å°¾ç©ºç™½ #}
{{ text | truncate(100) }}      {# æˆªæ–­ #}
{{ text | replace("a", "b") }}  {# æ›¿æ¢ #}
{{ text | split(",") }}         {# åˆ†å‰² #}

{# æ•°å­—è¿‡æ»¤å™¨ #}
{{ price | round(2) }}          {# å››èˆäº”å…¥ #}
{{ price | floor }}             {# å‘ä¸‹å–æ•´ #}
{{ price | ceil }}              {# å‘ä¸Šå–æ•´ #}
{{ price | abs }}               {# ç»å¯¹å€¼ #}
{{ price | currency("Â¥") }}     {# è´§å¸æ ¼å¼ #}

{# æ•°ç»„è¿‡æ»¤å™¨ #}
{{ items | length }}            {# é•¿åº¦ #}
{{ items | first }}             {# ç¬¬ä¸€é¡¹ #}
{{ items | last }}              {# æœ€åä¸€é¡¹ #}
{{ items | reverse }}           {# åè½¬ #}
{{ items | sort }}              {# æ’åº #}
{{ items | sort("name") }}      {# æŒ‰å±æ€§æ’åº #}
{{ items | unique }}            {# å»é‡ #}
{{ items | join(", ") }}        {# è¿æ¥ #}
{{ items | slice(0, 5) }}       {# åˆ‡ç‰‡ #}
{{ items | map("name") }}       {# æå–å±æ€§ #}
{{ items | filter("active") }}  {# è¿‡æ»¤ #}
{{ items | groupBy("category") }} {# åˆ†ç»„ #}

{# JSON è¿‡æ»¤å™¨ #}
{{ data | json }}               {# è½¬ JSON å­—ç¬¦ä¸² #}
{{ data | json(2) }}            {# æ ¼å¼åŒ– JSON #}
{{ jsonStr | fromJson }}        {# è§£æ JSON #}

{# æ—¥æœŸè¿‡æ»¤å™¨ #}
{{ date | formatDate("YYYY-MM-DD") }}
{{ date | relativeTime }}       {# ç›¸å¯¹æ—¶é—´: "3å¤©å‰" #}

{# AI ä¸“ç”¨è¿‡æ»¤å™¨ #}
{{ text | tokenCount }}         {# Token è®¡æ•° #}
{{ text | summarize(100) }}     {# æ‘˜è¦ (éœ€ LLM) #}
{{ list | bulletPoints }}       {# è½¬ä¸º bullet åˆ—è¡¨ #}
{{ text | escape }}             {# è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ #}
{{ text | stripHtml }}          {# å»é™¤ HTML æ ‡ç­¾ #}
{{ text | markdown }}           {# Markdown è½¬æ–‡æœ¬ #}

{# é“¾å¼è¿‡æ»¤ #}
{{ name | trim | lower | capitalize }}
```

#### 12.2.5 å®å®šä¹‰ä¸æ¨¡æ¿å¤ç”¨

```jinja2
{# å®šä¹‰å® #}
{% macro userCard(user) %}
å§“å: {{ user.name }}
é‚®ç®±: {{ user.email }}
è§’è‰²: {{ user.role | default("æ™®é€šç”¨æˆ·") }}
{% endmacro %}

{# ä½¿ç”¨å® #}
{{ userCard(currentUser) }}

{# å¸¦é»˜è®¤å‚æ•°çš„å® #}
{% macro button(text, type="primary", size="medium") %}
[{{ type | upper }}] {{ text }} ({{ size }})
{% endmacro %}

{{ button("æäº¤") }}
{{ button("å–æ¶ˆ", type="secondary") }}

{# åŒ…å«å¤–éƒ¨æ¨¡æ¿ #}
{% include "partials/header.prompt" %}

{# å¸¦ä¸Šä¸‹æ–‡åŒ…å« #}
{% include "partials/item.prompt" with item=currentItem %}

{# æ¨¡æ¿ç»§æ‰¿ #}
{# base.prompt #}
{% block system %}
ä½ æ˜¯ä¸€ä¸ªæœ‰å¸®åŠ©çš„ AI åŠ©æ‰‹ã€‚
{% endblock %}

{% block instructions %}
{% endblock %}

{% block examples %}
{% endblock %}

{# child.prompt #}
{% extends "base.prompt" %}

{% block instructions %}
è¯·å¸®åŠ©ç”¨æˆ·å®Œæˆç¿»è¯‘ä»»åŠ¡ã€‚
{% endblock %}
```

### 12.3 æ¨¡æ¿å¼•æ“å®ç°

```typescript
// lib/prompt-template/index.ts

/**
 * æ¨¡æ¿å¼•æ“ä¸»ç±»
 */
export class PromptTemplate {
  private ast: ASTNode[]
  private filters: Map<string, FilterFunction>
  private macros: Map<string, MacroDefinition>

  constructor(template: string, options?: TemplateOptions) {
    // è§£ææ¨¡æ¿ä¸º AST
    const lexer = new Lexer(template)
    const tokens = lexer.tokenize()
    const parser = new Parser(tokens)
    this.ast = parser.parse()

    // æ³¨å†Œé»˜è®¤è¿‡æ»¤å™¨
    this.filters = new Map(Object.entries(defaultFilters))

    // æ³¨å†Œè‡ªå®šä¹‰è¿‡æ»¤å™¨
    if (options?.filters) {
      for (const [name, fn] of Object.entries(options.filters)) {
        this.filters.set(name, fn)
      }
    }
  }

  /**
   * æ¸²æŸ“æ¨¡æ¿
   */
  render(context: Record<string, unknown>): string {
    const runtime = new TemplateRuntime({
      context,
      filters: this.filters,
      macros: this.macros,
    })

    return runtime.execute(this.ast)
  }

  /**
   * å¼‚æ­¥æ¸²æŸ“ (æ”¯æŒå¼‚æ­¥è¿‡æ»¤å™¨)
   */
  async renderAsync(context: Record<string, unknown>): Promise<string> {
    const runtime = new TemplateRuntime({
      context,
      filters: this.filters,
      macros: this.macros,
      async: true,
    })

    return runtime.executeAsync(this.ast)
  }

  /**
   * éªŒè¯æ¨¡æ¿è¯­æ³•
   */
  static validate(template: string): ValidationResult {
    try {
      const lexer = new Lexer(template)
      const tokens = lexer.tokenize()
      const parser = new Parser(tokens)
      parser.parse()
      return { valid: true, errors: [] }
    } catch (error) {
      return {
        valid: false,
        errors: [{ message: error.message, line: error.line, column: error.column }],
      }
    }
  }

  /**
   * æå–æ¨¡æ¿ä¸­ä½¿ç”¨çš„å˜é‡
   */
  getVariables(): string[] {
    const variables = new Set<string>()
    this.walkAST(this.ast, (node) => {
      if (node.type === 'Variable') {
        variables.add(node.name)
      }
    })
    return Array.from(variables)
  }
}

/**
 * å¿«æ·æ¸²æŸ“å‡½æ•°
 */
export function render(template: string, context: Record<string, unknown>): string {
  return new PromptTemplate(template).render(context)
}

/**
 * é¢„ç¼–è¯‘æ¨¡æ¿ (æé«˜é‡å¤æ¸²æŸ“æ€§èƒ½)
 */
export function compile(template: string, options?: TemplateOptions): CompiledTemplate {
  return new PromptTemplate(template, options)
}
```

### 12.4 AI ä¸“ç”¨è¿‡æ»¤å™¨

```typescript
// lib/prompt-template/filters/ai.ts

export const aiFilters = {
  /**
   * è®¡ç®—æ–‡æœ¬çš„ token æ•°é‡
   */
  tokenCount: (text: string, model: string = 'gpt-4'): number => {
    const encoder = getEncoder(model)
    return encoder.encode(text).length
  },

  /**
   * æˆªæ–­åˆ°æŒ‡å®š token æ•°é‡
   */
  truncateTokens: (text: string, maxTokens: number, model: string = 'gpt-4'): string => {
    const encoder = getEncoder(model)
    const tokens = encoder.encode(text)
    if (tokens.length <= maxTokens) return text
    return encoder.decode(tokens.slice(0, maxTokens)) + '...'
  },

  /**
   * è½¬æ¢ä¸º bullet åˆ—è¡¨
   */
  bulletPoints: (items: unknown[]): string => {
    return items.map((item) => `â€¢ ${item}`).join('\n')
  },

  /**
   * è½¬æ¢ä¸ºç¼–å·åˆ—è¡¨
   */
  numberedList: (items: unknown[]): string => {
    return items.map((item, i) => `${i + 1}. ${item}`).join('\n')
  },

  /**
   * XML æ ‡ç­¾åŒ…è£…
   */
  xmlTag: (content: string, tag: string): string => {
    return `<${tag}>\n${content}\n</${tag}>`
  },

  /**
   * ä»£ç å—åŒ…è£…
   */
  codeBlock: (code: string, language: string = ''): string => {
    return `\`\`\`${language}\n${code}\n\`\`\``
  },

  /**
   * å‹ç¼©ç©ºç™½å­—ç¬¦
   */
  compressWhitespace: (text: string): string => {
    return text.replace(/\s+/g, ' ').trim()
  },

  /**
   * ç§»é™¤ç©ºè¡Œ
   */
  removeEmptyLines: (text: string): string => {
    return text
      .split('\n')
      .filter((line) => line.trim())
      .join('\n')
  },

  /**
   * è§’è‰²æ ‡ç­¾åŒ…è£… (ç”¨äº chat æ ¼å¼)
   */
  role: (content: string, role: 'system' | 'user' | 'assistant'): string => {
    return `<|${role}|>\n${content}\n<|end|>`
  },
}
```

### 12.5 æ¨¡æ¿ç¤ºä¾‹

````jinja2
{# templates/translation.prompt #}

{# ç³»ç»Ÿæç¤ºè¯ #}
{% block system %}
ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„ç¿»è¯‘ä¸“å®¶ï¼Œç²¾é€šå¤šç§è¯­è¨€ã€‚

{% if glossary is not empty %}
## æœ¯è¯­è¡¨
è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æœ¯è¯­è¿›è¡Œç¿»è¯‘ï¼š
{% for term, translation in glossary %}
- "{{ term }}" â†’ "{{ translation }}"
{% endfor %}
{% endif %}

## ç¿»è¯‘è¦æ±‚
1. ç›®æ ‡è¯­è¨€: {{ targetLang | languageName }}
2. ç¿»è¯‘é£æ ¼: {{ style | styleName }}
3. {% if preserveFormatting %}ä¿ç•™åŸæ–‡æ ¼å¼{% else %}å¯è°ƒæ•´æ ¼å¼{% endif %}
{% endblock %}

{# ç”¨æˆ·æ¶ˆæ¯ #}
{% block user %}
è¯·ç¿»è¯‘ä»¥ä¸‹{{ sourceLang | languageName | default("") }}æ–‡æœ¬:

{{ text | xmlTag("source") }}

{% if examples is not empty %}
## å‚è€ƒç¤ºä¾‹
{% for example in examples %}
åŸæ–‡: {{ example.source }}
è¯‘æ–‡: {{ example.target }}
{% endfor %}
{% endif %}
{% endblock %}

{# æœŸæœ›çš„è¾“å‡ºæ ¼å¼ #}
{% block format %}
è¯·ä»¥ JSON æ ¼å¼è¿”å›ç¿»è¯‘ç»“æœï¼š
```json
{
  "translation": "ç¿»è¯‘åçš„æ–‡æœ¬",
  "confidence": 0.95,
  "notes": "ç¿»è¯‘è¯´æ˜ï¼ˆå¯é€‰ï¼‰"
}
````

{% endblock %}

```

### 12.6 æ¨¡æ¿å¼•æ“ TodoList

- [ ] å®ç°è¯æ³•åˆ†æå™¨ (Lexer)
- [ ] å®ç°è¯­æ³•åˆ†æå™¨ (Parser)
- [ ] å®ç° AST èŠ‚ç‚¹ç±»å‹
- [ ] å®ç°æ¨¡æ¿è¿è¡Œæ—¶
- [ ] å®ç°é»˜è®¤è¿‡æ»¤å™¨é›†
- [ ] å®ç° AI ä¸“ç”¨è¿‡æ»¤å™¨
- [ ] å®ç°å®å®šä¹‰åŠŸèƒ½
- [ ] å®ç°æ¨¡æ¿ç»§æ‰¿
- [ ] å®ç°æ¨¡æ¿éªŒè¯
- [ ] å®ç°å˜é‡æå–
- [ ] ç¼–å†™è¯­æ³•é«˜äº®æ”¯æŒ
- [ ] ç¼–å†™ VSCode æ‰©å±•
- [ ] ç¼–å†™å®Œæ•´æ–‡æ¡£

---

## 13. æ²™ç®±æ‰§è¡Œç¯å¢ƒ

### 13.1 æ²™ç®±æ¶æ„

```

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ²™ç®±æ‰§è¡Œç¯å¢ƒæ¶æ„ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ éš”ç¦»å±‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚ â”‚ â”‚ è¿›ç¨‹éš”ç¦» â”‚ â”‚ ç½‘ç»œéš”ç¦» â”‚ â”‚ æ–‡ä»¶ç³»ç»Ÿéš”ç¦» â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ (Worker) â”‚ â”‚ (ç™½åå•) â”‚ â”‚ (è™šæ‹Ÿ FS) â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚ â”‚ â”‚ å†…å­˜é™åˆ¶ â”‚ â”‚ CPU é™åˆ¶ â”‚ â”‚ æ‰§è¡Œæ—¶é—´é™åˆ¶ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ (å †å¤§å°) â”‚ â”‚ (æ—¶é—´ç‰‡) â”‚ â”‚ (è¶…æ—¶ç»ˆæ­¢) â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â†“ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ å®‰å…¨ç­–ç•¥å±‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚ â”‚ â”‚ æƒé™æ£€æŸ¥ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â€¢ API è°ƒç”¨æƒé™éªŒè¯ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â€¢ å±é™©æ“ä½œæ‹¦æˆª â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â€¢ æ•æ„Ÿæ•°æ®è®¿é—®æ§åˆ¶ â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚ â”‚ â”‚ ä»£ç åˆ†æ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â€¢ é™æ€åˆ†æ (AST æ£€æŸ¥) â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â€¢ å±é™©æ¨¡å¼æ£€æµ‹ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â€¢ ä¾èµ–ç™½åå•éªŒè¯ â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â†“ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ æ‰§è¡Œå¼•æ“å±‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚ â”‚ â”‚ JavaScript (V8) â”‚ â”‚ Python (Pyodide / å®¹å™¨) â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â€¢ isolated-vm â”‚ â”‚ â€¢ WASM æ²™ç®± â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â€¢ QuickJS â”‚ â”‚ â€¢ Docker å®¹å™¨ â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

````

### 13.2 JavaScript æ²™ç®±å®ç°

```typescript
// lib/sandbox/javascript.ts

import ivm from 'isolated-vm';

/**
 * JavaScript æ²™ç®±é…ç½®
 */
interface SandboxConfig {
  /** å†…å­˜é™åˆ¶ (MB) */
  memoryLimit: number;
  /** æ‰§è¡Œè¶…æ—¶ (æ¯«ç§’) */
  timeout: number;
  /** å…è®¸çš„å…¨å±€å˜é‡ */
  allowedGlobals: string[];
  /** æ³¨å…¥çš„ API */
  injectedAPIs: Record<string, unknown>;
}

/**
 * JavaScript æ²™ç®±æ‰§è¡Œå™¨
 */
export class JavaScriptSandbox {
  private isolate: ivm.Isolate;
  private context: ivm.Context;
  private config: SandboxConfig;

  constructor(config: Partial<SandboxConfig> = {}) {
    this.config = {
      memoryLimit: 128, // 128MB
      timeout: 30000,   // 30ç§’
      allowedGlobals: ['console', 'JSON', 'Math', 'Date', 'Array', 'Object', 'String', 'Number', 'Boolean', 'Promise'],
      injectedAPIs: {},
      ...config,
    };

    // åˆ›å»ºéš”ç¦»çš„ V8 å®ä¾‹
    this.isolate = new ivm.Isolate({
      memoryLimit: this.config.memoryLimit,
    });

    // åˆ›å»ºä¸Šä¸‹æ–‡
    this.context = this.isolate.createContextSync();

    // è®¾ç½®å®‰å…¨çš„å…¨å±€ç¯å¢ƒ
    this.setupGlobals();
  }

  /**
   * è®¾ç½®å…¨å±€ç¯å¢ƒ
   */
  private setupGlobals(): void {
    const jail = this.context.global;

    // è®¾ç½®å®‰å…¨çš„å…¨å±€å¯¹è±¡
    jail.setSync('global', jail.derefInto());

    // æ³¨å…¥å—é™çš„ console
    const consoleObj = new ivm.Reference({
      log: (...args: unknown[]) => this.handleLog('log', args),
      warn: (...args: unknown[]) => this.handleLog('warn', args),
      error: (...args: unknown[]) => this.handleLog('error', args),
    });
    jail.setSync('console', consoleObj);

    // æ³¨å…¥å®‰å…¨çš„ JSON
    jail.setSync('JSON', new ivm.Reference(JSON));

    // æ³¨å…¥ Math (åªè¯»)
    jail.setSync('Math', new ivm.Reference(Math));

    // æ³¨å…¥è‡ªå®šä¹‰ API
    for (const [name, api] of Object.entries(this.config.injectedAPIs)) {
      jail.setSync(name, new ivm.Reference(api));
    }
  }

  /**
   * æ‰§è¡Œä»£ç 
   */
  async execute(code: string, inputs: Record<string, unknown> = {}): Promise<unknown> {
    // é™æ€åˆ†ææ£€æŸ¥
    this.analyzeCode(code);

    // æ³¨å…¥è¾“å…¥å˜é‡
    const jail = this.context.global;
    jail.setSync('inputs', new ivm.ExternalCopy(inputs).copyInto());

    // åŒ…è£…ä»£ç 
    const wrappedCode = `
      (async () => {
        ${code}
      })()
    `;

    try {
      // ç¼–è¯‘è„šæœ¬
      const script = await this.isolate.compileScript(wrappedCode);

      // æ‰§è¡Œè„šæœ¬
      const result = await script.run(this.context, {
        timeout: this.config.timeout,
        promise: true,
      });

      return result;
    } catch (error) {
      if (error.message.includes('Script execution timed out')) {
        throw new SandboxError('TIMEOUT', 'ä»£ç æ‰§è¡Œè¶…æ—¶');
      }
      if (error.message.includes('Memory limit')) {
        throw new SandboxError('MEMORY_LIMIT', 'å†…å­˜ä½¿ç”¨è¶…å‡ºé™åˆ¶');
      }
      throw new SandboxError('EXECUTION_ERROR', error.message);
    }
  }

  /**
   * é™æ€ä»£ç åˆ†æ
   */
  private analyzeCode(code: string): void {
    // æ£€æµ‹å±é™©æ¨¡å¼
    const dangerousPatterns = [
      /eval\s*\(/,
      /Function\s*\(/,
      /require\s*\(/,
      /import\s*\(/,
      /process\./,
      /__proto__/,
      /constructor\s*\[/,
      /Reflect\./,
      /Proxy/,
    ];

    for (const pattern of dangerousPatterns) {
      if (pattern.test(code)) {
        throw new SandboxError(
          'DANGEROUS_CODE',
          `æ£€æµ‹åˆ°æ½œåœ¨å±é™©ä»£ç æ¨¡å¼: ${pattern.toString()}`
        );
      }
    }
  }

  /**
   * å¤„ç†æ—¥å¿—è¾“å‡º
   */
  private handleLog(level: string, args: unknown[]): void {
    // é™åˆ¶æ—¥å¿—è¾“å‡ºé•¿åº¦
    const maxLength = 10000;
    const output = args.map(arg => {
      const str = typeof arg === 'string' ? arg : JSON.stringify(arg);
      return str.length > maxLength ? str.slice(0, maxLength) + '...' : str;
    }).join(' ');

    // å‘é€åˆ°æ—¥å¿—æ”¶é›†å™¨
    this.emitLog({ level, message: output, timestamp: Date.now() });
  }

  /**
   * é‡Šæ”¾èµ„æº
   */
  dispose(): void {
    this.context.release();
    this.isolate.dispose();
  }
}

/**
 * æ²™ç®±é”™è¯¯ç±»å‹
 */
export class SandboxError extends Error {
  constructor(
    public code: 'TIMEOUT' | 'MEMORY_LIMIT' | 'DANGEROUS_CODE' | 'EXECUTION_ERROR',
    message: string
  ) {
    super(message);
    this.name = 'SandboxError';
  }
}
````

### 13.3 Python æ²™ç®±å®ç° (å®¹å™¨æ–¹æ¡ˆ)

```go
// backend/internal/pkg/sandbox/python.go

package sandbox

import (
    "context"
    "encoding/json"
    "fmt"
    "time"

    "github.com/docker/docker/api/types/container"
    "github.com/docker/docker/client"
)

// PythonSandboxConfig Python æ²™ç®±é…ç½®
type PythonSandboxConfig struct {
    MemoryLimit   int64         `json:"memory_limit"`   // å†…å­˜é™åˆ¶ (å­—èŠ‚)
    CPUQuota      int64         `json:"cpu_quota"`      // CPU é…é¢
    Timeout       time.Duration `json:"timeout"`        // æ‰§è¡Œè¶…æ—¶
    NetworkMode   string        `json:"network_mode"`   // ç½‘ç»œæ¨¡å¼
    AllowedPkgs   []string      `json:"allowed_pkgs"`   // å…è®¸çš„åŒ…
}

// PythonSandbox Python æ²™ç®±æ‰§è¡Œå™¨
type PythonSandbox struct {
    dockerClient *client.Client
    config       PythonSandboxConfig
    imageID      string
}

// NewPythonSandbox åˆ›å»º Python æ²™ç®±
func NewPythonSandbox(config PythonSandboxConfig) (*PythonSandbox, error) {
    cli, err := client.NewClientWithOpts(client.FromEnv)
    if err != nil {
        return nil, fmt.Errorf("failed to create docker client: %w", err)
    }

    return &PythonSandbox{
        dockerClient: cli,
        config:       config,
        imageID:      "reverseai/python-sandbox:latest",
    }, nil
}

// Execute æ‰§è¡Œ Python ä»£ç 
func (s *PythonSandbox) Execute(ctx context.Context, code string, inputs map[string]interface{}) (*ExecutionResult, error) {
    // åˆ›å»ºå®¹å™¨é…ç½®
    containerConfig := &container.Config{
        Image: s.imageID,
        Cmd:   []string{"python", "-c", s.wrapCode(code)},
        Env: []string{
            fmt.Sprintf("INPUTS=%s", mustJSON(inputs)),
        },
        NetworkDisabled: s.config.NetworkMode == "none",
    }

    // èµ„æºé™åˆ¶
    hostConfig := &container.HostConfig{
        Resources: container.Resources{
            Memory:    s.config.MemoryLimit,
            CPUQuota:  s.config.CPUQuota,
            PidsLimit: int64Ptr(100), // é™åˆ¶è¿›ç¨‹æ•°
        },
        SecurityOpt: []string{
            "no-new-privileges",
        },
        ReadonlyRootfs: true,
    }

    // åˆ›å»ºå®¹å™¨
    resp, err := s.dockerClient.ContainerCreate(ctx, containerConfig, hostConfig, nil, nil, "")
    if err != nil {
        return nil, fmt.Errorf("failed to create container: %w", err)
    }
    containerID := resp.ID

    // ç¡®ä¿å®¹å™¨è¢«æ¸…ç†
    defer s.dockerClient.ContainerRemove(ctx, containerID, container.RemoveOptions{Force: true})

    // å¯åŠ¨å®¹å™¨
    if err := s.dockerClient.ContainerStart(ctx, containerID, container.StartOptions{}); err != nil {
        return nil, fmt.Errorf("failed to start container: %w", err)
    }

    // ç­‰å¾…æ‰§è¡Œå®Œæˆæˆ–è¶…æ—¶
    timeoutCtx, cancel := context.WithTimeout(ctx, s.config.Timeout)
    defer cancel()

    statusCh, errCh := s.dockerClient.ContainerWait(timeoutCtx, containerID, container.WaitConditionNotRunning)

    select {
    case err := <-errCh:
        if err != nil {
            return nil, fmt.Errorf("container wait error: %w", err)
        }
    case status := <-statusCh:
        if status.StatusCode != 0 {
            logs, _ := s.getContainerLogs(ctx, containerID)
            return &ExecutionResult{
                Success: false,
                Error:   fmt.Sprintf("execution failed with code %d: %s", status.StatusCode, logs),
            }, nil
        }
    case <-timeoutCtx.Done():
        s.dockerClient.ContainerKill(ctx, containerID, "SIGKILL")
        return &ExecutionResult{
            Success: false,
            Error:   "execution timeout",
        }, nil
    }

    // è·å–è¾“å‡º
    logs, err := s.getContainerLogs(ctx, containerID)
    if err != nil {
        return nil, fmt.Errorf("failed to get logs: %w", err)
    }

    return &ExecutionResult{
        Success: true,
        Output:  logs,
    }, nil
}

// wrapCode åŒ…è£…ç”¨æˆ·ä»£ç 
func (s *PythonSandbox) wrapCode(code string) string {
    return fmt.Sprintf(`
import json
import os
import sys

# é™åˆ¶å¯ç”¨æ¨¡å—
ALLOWED_MODULES = %s

class RestrictedImporter:
    def find_module(self, name, path=None):
        if name.split('.')[0] not in ALLOWED_MODULES:
            raise ImportError(f"Module '{name}' is not allowed")
        return None

sys.meta_path.insert(0, RestrictedImporter())

# è·å–è¾“å…¥
inputs = json.loads(os.environ.get('INPUTS', '{}'))

# æ‰§è¡Œç”¨æˆ·ä»£ç 
try:
    result = None
    exec('''%s''')
    if result is not None:
        print(json.dumps(result))
except Exception as e:
    print(json.dumps({"error": str(e)}))
    sys.exit(1)
`, toJSON(s.config.AllowedPkgs), escapeCode(code))
}
```

### 13.4 èµ„æºé™åˆ¶é…ç½®

```yaml
# config/sandbox.yaml

sandbox:
  javascript:
    # å†…å­˜é™åˆ¶
    memory_limit: 128MB

    # æ‰§è¡Œè¶…æ—¶
    timeout: 30s

    # å †å¤§å°é™åˆ¶
    max_heap_size: 64MB

    # æ ˆå¤§å°é™åˆ¶
    stack_size: 1MB

    # å…è®¸çš„å…¨å±€å¯¹è±¡
    allowed_globals:
      - console
      - JSON
      - Math
      - Date
      - Array
      - Object
      - String
      - Number
      - Boolean
      - Promise
      - Map
      - Set
      - RegExp

    # ç¦æ­¢çš„æ¨¡å¼
    forbidden_patterns:
      - eval
      - Function
      - require
      - import
      - process
      - __proto__
      - constructor[
      - Reflect
      - Proxy

  python:
    # å†…å­˜é™åˆ¶
    memory_limit: 256MB

    # CPU é…é¢
    cpu_quota: 50000 # 50% of one CPU

    # æ‰§è¡Œè¶…æ—¶
    timeout: 60s

    # è¿›ç¨‹æ•°é™åˆ¶
    pids_limit: 100

    # ç½‘ç»œæ¨¡å¼
    network_mode: none # none | bridge | host

    # å…è®¸çš„ Python åŒ…
    allowed_packages:
      - json
      - re
      - math
      - datetime
      - collections
      - itertools
      - functools
      - typing
      - dataclasses
      - requests # ä»…åœ¨ network_mode=bridge æ—¶
      - pandas
      - numpy

    # ç¦æ­¢çš„æ¨¡å—
    forbidden_modules:
      - os
      - sys
      - subprocess
      - socket
      - shutil
      - pickle
      - marshal
```

### 13.5 æ²™ç®± TodoList

- [ ] å®ç° JavaScript æ²™ç®± (isolated-vm)
- [ ] å®ç° Python æ²™ç®± (Docker å®¹å™¨)
- [ ] å®ç°é™æ€ä»£ç åˆ†æ
- [ ] å®ç°èµ„æºé™åˆ¶ç›‘æ§
- [ ] å®ç°ç½‘ç»œè®¿é—®æ§åˆ¶
- [ ] å®ç°æ–‡ä»¶ç³»ç»Ÿéš”ç¦»
- [ ] å®ç°æ—¥å¿—æ”¶é›†
- [ ] å®ç°è¶…æ—¶å¤„ç†
- [ ] ç¼–å†™å®‰å…¨æµ‹è¯•ç”¨ä¾‹
- [ ] ç¼–å†™æ–‡æ¡£

---

## 14. æ’ä»¶ç³»ç»Ÿæ¶æ„

### 14.1 æ’ä»¶ç³»ç»Ÿæ¦‚è¿°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         æ’ä»¶ç³»ç»Ÿæ¶æ„                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       æ’ä»¶ç±»å‹                                   â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ èŠ‚ç‚¹æ’ä»¶    â”‚  â”‚ ä¸»é¢˜æ’ä»¶    â”‚  â”‚ é›†æˆæ’ä»¶                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ è‡ªå®šä¹‰èŠ‚ç‚¹  â”‚  â”‚ UI ä¸»é¢˜     â”‚  â”‚ ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆ          â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚   â”‚
â”‚  â”‚  â”‚ è§¦å‘å™¨æ’ä»¶  â”‚  â”‚ åŠŸèƒ½æ’ä»¶    â”‚                              â”‚   â”‚
â”‚  â”‚  â”‚ è‡ªå®šä¹‰è§¦å‘å™¨â”‚  â”‚ æ‰©å±•åŠŸèƒ½    â”‚                              â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       æ’ä»¶ç”Ÿå‘½å‘¨æœŸ                               â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  å‘ç° â†’ éªŒè¯ â†’ å®‰è£… â†’ åŠ è½½ â†’ æ¿€æ´» â†’ è¿è¡Œ â†’ åœç”¨ â†’ å¸è½½        â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       å®‰å…¨æœºåˆ¶                                   â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ æƒé™å£°æ˜    â”‚  â”‚ ä»£ç ç­¾å    â”‚  â”‚ æ²™ç®±æ‰§è¡Œ                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ Manifest   â”‚  â”‚ å®Œæ•´æ€§éªŒè¯  â”‚  â”‚ èµ„æºéš”ç¦»                â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 14.2 æ’ä»¶ Manifest è§„èŒƒ

```typescript
// plugin.manifest.json

interface PluginManifest {
  // ===== åŸºç¡€ä¿¡æ¯ =====
  /** æ’ä»¶ ID (å”¯ä¸€æ ‡è¯†) */
  id: string
  /** æ’ä»¶åç§° */
  name: string
  /** ç‰ˆæœ¬å· (semver) */
  version: string
  /** æè¿° */
  description: string
  /** ä½œè€… */
  author: {
    name: string
    email?: string
    url?: string
  }
  /** è®¸å¯è¯ */
  license: string
  /** ä»“åº“åœ°å€ */
  repository?: string
  /** ä¸»é¡µ */
  homepage?: string
  /** å…³é”®è¯ */
  keywords?: string[]

  // ===== æ’ä»¶é…ç½® =====
  /** æ’ä»¶ç±»å‹ */
  type: 'node' | 'theme' | 'integration' | 'trigger' | 'feature'
  /** å…¥å£æ–‡ä»¶ */
  main: string
  /** æµè§ˆå™¨å…¥å£ (å‰ç«¯æ’ä»¶) */
  browser?: string
  /** å›¾æ ‡ */
  icon?: string
  /** åˆ†ç±» */
  category?: string

  // ===== å…¼å®¹æ€§ =====
  /** å¼•æ“å…¼å®¹æ€§ */
  engines: {
    reverseai: string // å¦‚ "^1.0.0"
    node?: string // å¦‚ ">=18"
  }
  /** å¹³å°å…¼å®¹æ€§ */
  platforms?: ('web' | 'desktop' | 'all')[]

  // ===== æƒé™å£°æ˜ =====
  permissions: {
    /** ç½‘ç»œè®¿é—® */
    network?: {
      domains: string[] // å…è®¸è®¿é—®çš„åŸŸå
    }
    /** æ–‡ä»¶ç³»ç»Ÿ */
    filesystem?: {
      read?: string[] // å¯è¯»è·¯å¾„
      write?: string[] // å¯å†™è·¯å¾„
    }
    /** API æƒé™ */
    api?: (
      | 'llm:call'
      | 'http:request'
      | 'secrets:read'
      | 'cache:read'
      | 'cache:write'
      | 'user:read'
      | 'workflow:read'
      | 'workflow:write'
    )[]
    /** ç³»ç»Ÿæƒé™ */
    system?: ('clipboard' | 'notifications' | 'shell')[]
  }

  // ===== ä¾èµ– =====
  dependencies?: Record<string, string>

  // ===== é…ç½®é¡¹ =====
  configuration?: {
    title: string
    properties: Record<string, ConfigurationProperty>
  }

  // ===== è´¡çŒ®ç‚¹ =====
  contributes?: {
    /** è‡ªå®šä¹‰èŠ‚ç‚¹ */
    nodes?: NodeContribution[]
    /** èœå•é¡¹ */
    menus?: MenuContribution[]
    /** å‘½ä»¤ */
    commands?: CommandContribution[]
    /** ä¸»é¢˜ */
    themes?: ThemeContribution[]
    /** è¯­è¨€æ”¯æŒ */
    languages?: LanguageContribution[]
  }
}

// é…ç½®å±æ€§å®šä¹‰
interface ConfigurationProperty {
  type: 'string' | 'number' | 'boolean' | 'array' | 'object'
  default?: unknown
  description?: string
  enum?: unknown[]
  minimum?: number
  maximum?: number
}

// èŠ‚ç‚¹è´¡çŒ®
interface NodeContribution {
  id: string
  name: string
  description: string
  icon: string
  category: string
  file: string
}
```

### 14.3 æ’ä»¶ API

```typescript
// @reverseai/plugin-api

/**
 * æ’ä»¶æ¿€æ´»å‡½æ•°
 */
export interface PluginActivator {
  /**
   * æ’ä»¶æ¿€æ´»æ—¶è°ƒç”¨
   */
  activate(context: PluginContext): void | Promise<void>

  /**
   * æ’ä»¶åœç”¨æ—¶è°ƒç”¨
   */
  deactivate?(): void | Promise<void>
}

/**
 * æ’ä»¶ä¸Šä¸‹æ–‡
 */
export interface PluginContext {
  // ===== åŸºç¡€ä¿¡æ¯ =====
  /** æ’ä»¶ ID */
  pluginId: string
  /** æ’ä»¶ç‰ˆæœ¬ */
  version: string
  /** æ’ä»¶å­˜å‚¨è·¯å¾„ */
  storagePath: string

  // ===== æ³¨å†Œ API =====
  /** æ³¨å†Œè‡ªå®šä¹‰èŠ‚ç‚¹ */
  registerNode(nodeDefinition: NodeDefinition): Disposable

  /** æ³¨å†Œå‘½ä»¤ */
  registerCommand(command: string, handler: CommandHandler): Disposable

  /** æ³¨å†Œèœå•é¡¹ */
  registerMenuItem(menu: MenuItem): Disposable

  /** æ³¨å†Œé…ç½®å˜æ›´ç›‘å¬ */
  onConfigurationChanged(listener: ConfigurationChangeListener): Disposable

  // ===== æœåŠ¡è®¿é—® =====
  /** LLM æœåŠ¡ */
  llm: LLMService

  /** HTTP å®¢æˆ·ç«¯ */
  http: HttpClient

  /** ç¼“å­˜æœåŠ¡ */
  cache: CacheService

  /** å¯†é’¥æœåŠ¡ */
  secrets: SecretsService

  /** æ—¥å¿—æœåŠ¡ */
  logger: Logger

  // ===== é…ç½®è®¿é—® =====
  /** è·å–æ’ä»¶é…ç½® */
  getConfiguration<T>(key: string): T | undefined

  /** æ›´æ–°æ’ä»¶é…ç½® */
  updateConfiguration<T>(key: string, value: T): Promise<void>

  // ===== å­˜å‚¨ API =====
  /** å…¨å±€çŠ¶æ€ (è·¨å·¥ä½œåŒº) */
  globalState: StateStorage

  /** å·¥ä½œåŒºçŠ¶æ€ */
  workspaceState: StateStorage

  // ===== UI API =====
  /** æ˜¾ç¤ºä¿¡æ¯æ¶ˆæ¯ */
  showInformationMessage(message: string, ...actions: string[]): Promise<string | undefined>

  /** æ˜¾ç¤ºè­¦å‘Šæ¶ˆæ¯ */
  showWarningMessage(message: string, ...actions: string[]): Promise<string | undefined>

  /** æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ */
  showErrorMessage(message: string, ...actions: string[]): Promise<string | undefined>

  /** æ˜¾ç¤ºè¾“å…¥æ¡† */
  showInputBox(options?: InputBoxOptions): Promise<string | undefined>

  /** æ˜¾ç¤ºå¿«é€Ÿé€‰æ‹© */
  showQuickPick<T extends QuickPickItem>(
    items: T[],
    options?: QuickPickOptions
  ): Promise<T | undefined>

  /** åˆ›å»ºçŠ¶æ€æ é¡¹ */
  createStatusBarItem(alignment?: 'left' | 'right', priority?: number): StatusBarItem
}

/**
 * å¯é‡Šæ”¾èµ„æº
 */
export interface Disposable {
  dispose(): void
}

/**
 * çŠ¶æ€å­˜å‚¨
 */
export interface StateStorage {
  get<T>(key: string, defaultValue?: T): T | undefined
  set<T>(key: string, value: T): Promise<void>
  delete(key: string): Promise<void>
  keys(): string[]
}
```

### 14.4 æ’ä»¶åŠ è½½å™¨

```typescript
// lib/plugin/loader.ts

/**
 * æ’ä»¶åŠ è½½å™¨
 */
export class PluginLoader {
  private plugins: Map<string, LoadedPlugin> = new Map()
  private registry: PluginRegistry
  private sandbox: PluginSandbox

  constructor(options: PluginLoaderOptions) {
    this.registry = new PluginRegistry(options.registryUrl)
    this.sandbox = new PluginSandbox(options.sandboxConfig)
  }

  /**
   * ä»è·¯å¾„åŠ è½½æ’ä»¶
   */
  async loadFromPath(pluginPath: string): Promise<LoadedPlugin> {
    // è¯»å– manifest
    const manifestPath = path.join(pluginPath, 'plugin.manifest.json')
    const manifest = await this.readManifest(manifestPath)

    // éªŒè¯ manifest
    this.validateManifest(manifest)

    // æ£€æŸ¥å…¼å®¹æ€§
    this.checkCompatibility(manifest)

    // éªŒè¯ç­¾å
    if (manifest.signature) {
      await this.verifySignature(pluginPath, manifest.signature)
    }

    // æ£€æŸ¥æƒé™
    const grantedPermissions = await this.requestPermissions(manifest.permissions)

    // åˆ›å»ºæ’ä»¶æ²™ç®±
    const pluginSandbox = this.sandbox.createForPlugin(manifest.id, grantedPermissions)

    // åŠ è½½å…¥å£æ–‡ä»¶
    const entryPath = path.join(pluginPath, manifest.main)
    const pluginModule = await pluginSandbox.import(entryPath)

    // åˆ›å»ºæ’ä»¶ä¸Šä¸‹æ–‡
    const context = this.createPluginContext(manifest, pluginSandbox)

    // æ¿€æ´»æ’ä»¶
    if (typeof pluginModule.activate === 'function') {
      await pluginModule.activate(context)
    }

    const loadedPlugin: LoadedPlugin = {
      manifest,
      context,
      module: pluginModule,
      sandbox: pluginSandbox,
      status: 'active',
    }

    this.plugins.set(manifest.id, loadedPlugin)

    return loadedPlugin
  }

  /**
   * ä» Registry å®‰è£…æ’ä»¶
   */
  async installFromRegistry(pluginId: string, version?: string): Promise<LoadedPlugin> {
    // è·å–æ’ä»¶ä¿¡æ¯
    const pluginInfo = await this.registry.getPlugin(pluginId, version)

    // ä¸‹è½½æ’ä»¶åŒ…
    const packagePath = await this.downloadPackage(pluginInfo.downloadUrl)

    // éªŒè¯å®Œæ•´æ€§
    await this.verifyPackageIntegrity(packagePath, pluginInfo.checksum)

    // è§£å‹åˆ°æ’ä»¶ç›®å½•
    const pluginPath = await this.extractPackage(packagePath, pluginId)

    // åŠ è½½æ’ä»¶
    return this.loadFromPath(pluginPath)
  }

  /**
   * å¸è½½æ’ä»¶
   */
  async unload(pluginId: string): Promise<void> {
    const plugin = this.plugins.get(pluginId)
    if (!plugin) return

    // è°ƒç”¨åœç”¨é’©å­
    if (typeof plugin.module.deactivate === 'function') {
      await plugin.module.deactivate()
    }

    // é‡Šæ”¾æ‰€æœ‰æ³¨å†Œçš„èµ„æº
    plugin.context.dispose()

    // é”€æ¯æ²™ç®±
    plugin.sandbox.destroy()

    // ç§»é™¤æ’ä»¶
    this.plugins.delete(pluginId)
  }

  /**
   * åˆ›å»ºæ’ä»¶ä¸Šä¸‹æ–‡
   */
  private createPluginContext(manifest: PluginManifest, sandbox: PluginSandbox): PluginContext {
    return new PluginContextImpl({
      pluginId: manifest.id,
      version: manifest.version,
      storagePath: this.getPluginStoragePath(manifest.id),
      permissions: manifest.permissions,
      sandbox,
    })
  }

  /**
   * éªŒè¯ Manifest
   */
  private validateManifest(manifest: PluginManifest): void {
    const schema = getManifestSchema()
    const result = schema.validate(manifest)

    if (!result.valid) {
      throw new PluginError('INVALID_MANIFEST', `Manifest éªŒè¯å¤±è´¥: ${result.errors.join(', ')}`)
    }
  }

  /**
   * æ£€æŸ¥å…¼å®¹æ€§
   */
  private checkCompatibility(manifest: PluginManifest): void {
    const currentVersion = getReverseAIVersion()

    if (!semver.satisfies(currentVersion, manifest.engines.reverseai)) {
      throw new PluginError(
        'INCOMPATIBLE',
        `æ’ä»¶è¦æ±‚ ReverseAI ${manifest.engines.reverseai}ï¼Œå½“å‰ç‰ˆæœ¬ ${currentVersion}`
      )
    }
  }

  /**
   * è¯·æ±‚æƒé™
   */
  private async requestPermissions(
    permissions: PluginManifest['permissions']
  ): Promise<GrantedPermissions> {
    // æ˜¾ç¤ºæƒé™ç¡®è®¤å¯¹è¯æ¡†
    const granted = await showPermissionDialog(permissions)

    if (!granted) {
      throw new PluginError('PERMISSION_DENIED', 'ç”¨æˆ·æ‹’ç»æˆæƒ')
    }

    return permissions
  }
}
```

### 14.5 æ’ä»¶å¸‚åœº API

```yaml
# è·å–æ’ä»¶åˆ—è¡¨
GET /api/v1/plugins
Query:
  type?: string           # node/theme/integration
  category?: string
  search?: string
  sort?: string           # popular/newest/rating
  page: number
  page_size: number
Response:
  plugins: Plugin[]
  total: number

# è·å–æ’ä»¶è¯¦æƒ…
GET /api/v1/plugins/:id
Response:
  plugin: PluginDetail
  versions: Version[]
  reviews: Review[]

# å‘å¸ƒæ’ä»¶
POST /api/v1/plugins
Content-Type: multipart/form-data
Body:
  package: File           # æ’ä»¶åŒ… (.zip)
  manifest: string        # manifest JSON
Response:
  plugin: Plugin

# æ›´æ–°æ’ä»¶
PUT /api/v1/plugins/:id/versions
Content-Type: multipart/form-data
Body:
  package: File
  version: string
  changelog: string
Response:
  version: Version

# æ’ä»¶å®¡æ ¸
POST /api/v1/plugins/:id/review (Admin)
Request:
  action: "approve" | "reject"
  message?: string

# å®‰è£…ç»Ÿè®¡
POST /api/v1/plugins/:id/install
Request:
  version: string
  platform: string

# è¯„åˆ†è¯„ä»·
POST /api/v1/plugins/:id/reviews
Request:
  rating: number          # 1-5
  content: string
Response:
  review: Review
```

### 14.6 æ’ä»¶ç³»ç»Ÿ TodoList

- [x] è®¾è®¡ Manifest è§„èŒƒ âœ… `packages/sdk/src/plugin/manifest.ts`
- [x] å®ç°æ’ä»¶ API âœ… `packages/sdk/src/plugin/types.ts`
- [x] å®ç°æ’ä»¶åŠ è½½å™¨ âœ… `packages/sdk/src/plugin/loader.ts`
- [x] å®ç°æ’ä»¶æ²™ç®± âœ… `packages/sdk/src/plugin/sandbox.ts`
- [x] å®ç°æƒé™ç³»ç»Ÿ âœ… `packages/sdk/src/plugin/permissions.ts`
- [x] å®ç°æ’ä»¶ç­¾åéªŒè¯ âœ… `packages/sdk/src/plugin/signature.ts`
- [x] å®ç°æ’ä»¶å¸‚åœº API âœ… `packages/sdk/src/plugin/marketplace.ts`
- [ ] å®ç°æ’ä»¶å®¡æ ¸æµç¨‹ (åç«¯å¾…å®ç°)
- [x] å®ç°æ’ä»¶ç‰ˆæœ¬ç®¡ç† âœ… `packages/sdk/src/plugin/version.ts`
- [x] ç¼–å†™ç¤ºä¾‹æ’ä»¶ âœ… `packages/sdk/src/plugin/examples/`
- [x] ç¼–å†™å¼€å‘è€…æ–‡æ¡£ âœ… `packages/sdk/src/plugin/PLUGIN_DEV_GUIDE.md`

---

# ç¬¬å››éƒ¨åˆ†ï¼šAgent åä½œç½‘ç»œ

---

## 15. Agent å•†åº—ç³»ç»Ÿ

### 15.1 å•†åº—æ¶æ„æ¦‚è¿°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Agent å•†åº—ç³»ç»Ÿæ¶æ„                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       ç”¨æˆ·ç«¯                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚  æµè§ˆå‘ç°  â”‚  â”‚  æœç´¢ç­›é€‰  â”‚  â”‚  è¯•ç”¨ä½“éªŒ  â”‚  â”‚  è´­ä¹°ä½¿ç”¨  â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       åˆ›ä½œè€…ç«¯                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚  å‘å¸ƒç®¡ç†  â”‚  â”‚  æ•°æ®åˆ†æ  â”‚  â”‚  æ”¶ç›Šç»“ç®—  â”‚  â”‚  ç‰ˆæœ¬è¿­ä»£  â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       è¿è¥ç«¯                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚  å®¡æ ¸ç®¡ç†  â”‚  â”‚  æ¨èè¿è¥  â”‚  â”‚  æ•°æ®ç›‘æ§  â”‚  â”‚  æŠ•è¯‰å¤„ç†  â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 15.2 Agent æ•°æ®æ¨¡å‹

```sql
-- Agent ä¸»è¡¨
CREATE TABLE agents (
    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id         UUID NOT NULL REFERENCES users(id),
    workflow_id     UUID NOT NULL REFERENCES workflows(id),

    -- åŸºç¡€ä¿¡æ¯
    name            VARCHAR(200) NOT NULL,
    slug            VARCHAR(100) UNIQUE NOT NULL,
    tagline         VARCHAR(200),
    description     TEXT,
    long_description TEXT,
    icon            VARCHAR(500),
    cover_image     VARCHAR(500),
    screenshots     TEXT[] DEFAULT '{}',
    demo_video      VARCHAR(500),

    -- åˆ†ç±»æ ‡ç­¾
    category_id     UUID REFERENCES agent_categories(id),
    tags            TEXT[] DEFAULT '{}',

    -- çŠ¶æ€
    status          VARCHAR(20) DEFAULT 'draft',
    visibility      VARCHAR(20) DEFAULT 'public',

    -- å®šä»·
    pricing_type    VARCHAR(20) DEFAULT 'free',
    price           DECIMAL(10, 2),
    currency        VARCHAR(10) DEFAULT 'CNY',

    -- è¯•ç”¨è®¾ç½®
    trial_enabled   BOOLEAN DEFAULT TRUE,
    trial_limit     INTEGER DEFAULT 3,

    -- ç‰ˆæœ¬
    current_version VARCHAR(20) DEFAULT '1.0.0',

    -- ç»Ÿè®¡
    use_count       INTEGER DEFAULT 0,
    star_count      INTEGER DEFAULT 0,
    fork_count      INTEGER DEFAULT 0,
    review_count    INTEGER DEFAULT 0,
    avg_rating      DECIMAL(3, 2) DEFAULT 0,
    total_revenue   DECIMAL(12, 2) DEFAULT 0,

    -- SEO
    seo_title       VARCHAR(200),
    seo_description VARCHAR(500),

    -- æ—¶é—´æˆ³
    created_at      TIMESTAMPTZ DEFAULT NOW(),
    updated_at      TIMESTAMPTZ DEFAULT NOW(),
    published_at    TIMESTAMPTZ,
    featured_at     TIMESTAMPTZ
);

-- Agent ç‰ˆæœ¬è¡¨
CREATE TABLE agent_versions (
    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    agent_id        UUID NOT NULL REFERENCES agents(id) ON DELETE CASCADE,

    version         VARCHAR(20) NOT NULL,
    workflow_snapshot JSONB NOT NULL,
    changelog       TEXT,

    -- çŠ¶æ€
    status          VARCHAR(20) DEFAULT 'pending',

    -- å®¡æ ¸
    reviewed_by     UUID REFERENCES users(id),
    reviewed_at     TIMESTAMPTZ,
    review_notes    TEXT,

    -- æ—¶é—´æˆ³
    created_at      TIMESTAMPTZ DEFAULT NOW(),

    UNIQUE(agent_id, version)
);

-- Agent åˆ†ç±»è¡¨
CREATE TABLE agent_categories (
    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name            VARCHAR(100) NOT NULL,
    slug            VARCHAR(100) UNIQUE NOT NULL,
    description     TEXT,
    icon            VARCHAR(50),
    parent_id       UUID REFERENCES agent_categories(id),
    sort_order      INTEGER DEFAULT 0,
    agent_count     INTEGER DEFAULT 0,

    created_at      TIMESTAMPTZ DEFAULT NOW()
);

-- Agent è¯„ä»·è¡¨
CREATE TABLE agent_reviews (
    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    agent_id        UUID NOT NULL REFERENCES agents(id) ON DELETE CASCADE,
    user_id         UUID NOT NULL REFERENCES users(id),

    rating          INTEGER NOT NULL CHECK (rating >= 1 AND rating <= 5),
    title           VARCHAR(200),
    content         TEXT,

    -- æœ‰ç”¨æ€§æŠ•ç¥¨
    helpful_count   INTEGER DEFAULT 0,

    -- åˆ›ä½œè€…å›å¤
    reply           TEXT,
    replied_at      TIMESTAMPTZ,

    -- çŠ¶æ€
    status          VARCHAR(20) DEFAULT 'visible',

    created_at      TIMESTAMPTZ DEFAULT NOW(),
    updated_at      TIMESTAMPTZ DEFAULT NOW(),

    UNIQUE(agent_id, user_id)
);

-- Agent æ”¶è—è¡¨
CREATE TABLE agent_stars (
    user_id         UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    agent_id        UUID NOT NULL REFERENCES agents(id) ON DELETE CASCADE,
    created_at      TIMESTAMPTZ DEFAULT NOW(),

    PRIMARY KEY(user_id, agent_id)
);

-- Agent ä½¿ç”¨è®°å½•è¡¨
CREATE TABLE agent_usages (
    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    agent_id        UUID NOT NULL REFERENCES agents(id),
    user_id         UUID NOT NULL REFERENCES users(id),
    execution_id    UUID REFERENCES executions(id),

    -- ä½¿ç”¨ç±»å‹
    usage_type      VARCHAR(20) NOT NULL,  -- trial, purchased, subscription

    -- æ—¶é—´
    created_at      TIMESTAMPTZ DEFAULT NOW()
);

-- ç´¢å¼•
CREATE INDEX idx_agents_category ON agents(category_id);
CREATE INDEX idx_agents_status ON agents(status);
CREATE INDEX idx_agents_pricing ON agents(pricing_type);
CREATE INDEX idx_agents_rating ON agents(avg_rating DESC);
CREATE INDEX idx_agents_use_count ON agents(use_count DESC);
CREATE INDEX idx_agents_featured ON agents(featured_at DESC NULLS LAST);
CREATE INDEX idx_agent_reviews_agent ON agent_reviews(agent_id);
CREATE INDEX idx_agent_usages_agent ON agent_usages(agent_id);
CREATE INDEX idx_agent_usages_user ON agent_usages(user_id);
```

### 15.3 Agent å•†åº— API

```yaml
# ===== æµè§ˆä¸å‘ç° =====

# è·å–é¦–é¡µæ•°æ®
GET /api/v1/store/home
Response:
  featured: Agent[]           # ç²¾é€‰æ¨è
  trending: Agent[]           # çƒ­é—¨è¶‹åŠ¿
  new_arrivals: Agent[]       # æœ€æ–°ä¸Šæ¶
  categories: Category[]      # çƒ­é—¨åˆ†ç±»
  collections: Collection[]   # ç²¾é€‰é›†åˆ

# è·å– Agent åˆ—è¡¨
GET /api/v1/store/agents
Query:
  category?: string           # åˆ†ç±»ç­›é€‰
  tags?: string[]             # æ ‡ç­¾ç­›é€‰
  pricing?: string            # free/paid/all
  rating_min?: number         # æœ€ä½è¯„åˆ†
  search?: string             # æœç´¢å…³é”®è¯
  sort?: string               # popular/newest/rating/price_asc/price_desc
  page: number
  page_size: number
Response:
  agents: Agent[]
  total: number
  filters: FilterOptions

# è·å– Agent è¯¦æƒ…
GET /api/v1/store/agents/:slug
Response:
  agent: AgentDetail
  creator: CreatorInfo
  versions: Version[]
  similar_agents: Agent[]

# è·å–è¯„ä»·åˆ—è¡¨
GET /api/v1/store/agents/:slug/reviews
Query:
  sort?: string               # newest/helpful/rating_high/rating_low
  rating?: number             # ç­›é€‰ç‰¹å®šè¯„åˆ†
  page: number
  page_size: number
Response:
  reviews: Review[]
  total: number
  rating_distribution: { [key: number]: number }

# ===== ç”¨æˆ·æ“ä½œ =====

# æ”¶è—/å–æ¶ˆæ”¶è—
POST /api/v1/store/agents/:id/star
DELETE /api/v1/store/agents/:id/star

# è¯•ç”¨ Agent
POST /api/v1/store/agents/:id/trial
Request:
  inputs?: object
Response:
  execution: Execution
  trial_remaining: number

# è´­ä¹° Agent
POST /api/v1/store/agents/:id/purchase
Request:
  payment_method: string
Response:
  order: Order
  payment_url?: string

# Fork Agent
POST /api/v1/store/agents/:id/fork
Response:
  workflow: Workflow

# æäº¤è¯„ä»·
POST /api/v1/store/agents/:id/reviews
Request:
  rating: number
  title?: string
  content: string
Response:
  review: Review

# ä¸¾æŠ¥ Agent
POST /api/v1/store/agents/:id/report
Request:
  reason: string
  description: string

# ===== åˆ›ä½œè€…æ“ä½œ =====

# å‘å¸ƒ Agent
POST /api/v1/creator/agents
Request:
  workflow_id: string
  name: string
  tagline: string
  description: string
  long_description?: string
  category_id: string
  tags: string[]
  pricing_type: string
  price?: number
  trial_enabled: boolean
  trial_limit?: number
Response:
  agent: Agent

# æ›´æ–° Agent
PUT /api/v1/creator/agents/:id
Request:
  (åŒä¸Šï¼Œæ‰€æœ‰å­—æ®µå¯é€‰)
Response:
  agent: Agent

# å‘å¸ƒæ–°ç‰ˆæœ¬
POST /api/v1/creator/agents/:id/versions
Request:
  version: string
  changelog: string
Response:
  version: Version

# è·å–åˆ›ä½œè€…ç»Ÿè®¡
GET /api/v1/creator/agents/:id/analytics
Query:
  period: string              # 7d/30d/90d/all
Response:
  overview:
    total_uses: number
    total_revenue: number
    avg_rating: number
    review_count: number
  usage_trend: DataPoint[]
  revenue_trend: DataPoint[]
  user_demographics: Demographics

# å›å¤è¯„ä»·
POST /api/v1/creator/agents/:id/reviews/:reviewId/reply
Request:
  reply: string
```

### 15.4 å®¡æ ¸ç³»ç»Ÿ

```typescript
// internal/service/review_service.go

/**
 * Agent å®¡æ ¸çŠ¶æ€æµè½¬
 */
enum AgentReviewStatus {
  DRAFT = 'draft',
  PENDING_REVIEW = 'pending_review',
  IN_REVIEW = 'in_review',
  APPROVED = 'approved',
  REJECTED = 'rejected',
  SUSPENDED = 'suspended',
}

/**
 * å®¡æ ¸æ£€æŸ¥é¡¹
 */
interface ReviewChecklist {
  // åŸºç¡€æ£€æŸ¥
  basicInfo: {
    hasValidName: boolean
    hasDescription: boolean
    hasIcon: boolean
    hasCategory: boolean
  }

  // å†…å®¹åˆè§„
  contentCompliance: {
    noProhibitedContent: boolean
    noMaliciousCode: boolean
    noPrivacyViolation: boolean
    noCopyrightIssue: boolean
  }

  // åŠŸèƒ½æµ‹è¯•
  functionalTest: {
    workflowExecutable: boolean
    noRuntimeErrors: boolean
    reasonablePerformance: boolean
    expectedOutput: boolean
  }

  // å®‰å…¨æ£€æŸ¥
  securityCheck: {
    noDataLeakage: boolean
    safeApiUsage: boolean
    noMaliciousPatterns: boolean
  }
}

/**
 * è‡ªåŠ¨å®¡æ ¸è§„åˆ™
 */
const autoReviewRules = {
  // åç§°æ£€æŸ¥
  name: {
    minLength: 2,
    maxLength: 50,
    prohibitedWords: ['è¿ç¦è¯åˆ—è¡¨...'],
  },

  // æè¿°æ£€æŸ¥
  description: {
    minLength: 20,
    maxLength: 5000,
    requireFeatureList: true,
  },

  // ä»£ç æ£€æŸ¥
  workflow: {
    maxNodes: 100,
    maxDepth: 20,
    prohibitedNodeTypes: [],
    requiredNodeTypes: ['start', 'end'],
  },

  // èµ„æºé™åˆ¶
  resources: {
    maxExecutionTime: 300000, // 5åˆ†é’Ÿ
    maxApiCalls: 50,
    maxOutputSize: 10 * 1024 * 1024, // 10MB
  },
}
```

### 15.5 å•†åº— TodoList

- [ ] è®¾è®¡å•†åº—é¦–é¡µ UI
- [ ] å®ç° Agent åˆ—è¡¨ä¸æœç´¢
- [ ] å®ç° Agent è¯¦æƒ…é¡µ
- [ ] å®ç°è¯„ä»·ç³»ç»Ÿ
- [ ] å®ç°æ”¶è—åŠŸèƒ½
- [ ] å®ç°è¯•ç”¨åŠŸèƒ½
- [ ] å®ç°è´­ä¹°æµç¨‹
- [ ] å®ç° Fork åŠŸèƒ½
- [ ] å®ç°åˆ›ä½œè€…å‘å¸ƒæµç¨‹
- [ ] å®ç°å®¡æ ¸ç³»ç»Ÿ
- [ ] å®ç°æ•°æ®åˆ†æ

---

## 16. Agent ç»„åˆå™¨

### 16.1 ç»„åˆå™¨æ¦‚è¿°

Agent ç»„åˆå™¨å…è®¸ç”¨æˆ·å°†å¤šä¸ª Agent ä¸²è”æˆæ›´å¼ºå¤§çš„"è¶…çº§ Agent"ï¼Œå®ç°å¤æ‚çš„å¤šæ­¥éª¤è‡ªåŠ¨åŒ–ä»»åŠ¡ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Agent ç»„åˆå™¨æ¶æ„                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   è¾“å…¥                                                                  â”‚
â”‚     â†“                                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                     Agent ç»„åˆ (Pipeline)                        â”‚  â”‚
â”‚   â”‚                                                                 â”‚  â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚   â”‚   â”‚ Agent A â”‚ â”€â”€â†’ â”‚ Agent B â”‚ â”€â”€â†’ â”‚ Agent C â”‚ â”€â”€â†’ â”‚ Agent D â”‚ â”‚  â”‚
â”‚   â”‚   â”‚ æ•°æ®é‡‡é›† â”‚     â”‚ æ•°æ®æ¸…æ´— â”‚     â”‚ AIåˆ†æ  â”‚     â”‚ æŠ¥å‘Šç”Ÿæˆ â”‚ â”‚  â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚   â”‚        â†“               â†“               â†“               â†“       â”‚  â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚   â”‚   â”‚                    æ•°æ®æµç®¡é“                            â”‚ â”‚  â”‚
â”‚   â”‚   â”‚   ä¸Šä¸‹æ–‡ä¼ é€’ â€¢ å˜é‡æ˜ å°„ â€¢ é”™è¯¯å¤„ç† â€¢ æ¡ä»¶è·¯ç”±           â”‚ â”‚  â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚     â†“                                                                   â”‚
â”‚   è¾“å‡º                                                                  â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 16.2 ç»„åˆæ¨¡å¼

```typescript
// types/agent-composition.ts

/**
 * Agent ç»„åˆå®šä¹‰
 */
interface AgentComposition {
  id: string
  name: string
  description: string

  // ç»„åˆæ¨¡å¼
  mode: CompositionMode

  // Agent èŠ‚ç‚¹
  agents: AgentNode[]

  // è¿æ¥å…³ç³»
  connections: AgentConnection[]

  // å…¨å±€é…ç½®
  config: CompositionConfig
}

/**
 * ç»„åˆæ¨¡å¼
 */
enum CompositionMode {
  // é¡ºåºæ‰§è¡Œ
  SEQUENTIAL = 'sequential',

  // å¹¶è¡Œæ‰§è¡Œ
  PARALLEL = 'parallel',

  // æ¡ä»¶åˆ†æ”¯
  CONDITIONAL = 'conditional',

  // å¾ªç¯æ‰§è¡Œ
  LOOP = 'loop',

  // è‡ªå®šä¹‰ DAG
  CUSTOM = 'custom',
}

/**
 * Agent èŠ‚ç‚¹
 */
interface AgentNode {
  id: string
  agentId: string // å¼•ç”¨çš„ Agent ID
  agentVersion?: string // æŒ‡å®šç‰ˆæœ¬

  // è¾“å…¥æ˜ å°„
  inputMapping: InputMapping[]

  // è¾“å‡ºæ˜ å°„
  outputMapping: OutputMapping[]

  // èŠ‚ç‚¹é…ç½®
  config: {
    timeout?: number
    retryCount?: number
    continueOnError?: boolean
    condition?: string // æ¡ä»¶è¡¨è¾¾å¼
  }
}

/**
 * è¾“å…¥æ˜ å°„
 */
interface InputMapping {
  // ç›®æ ‡è¾“å…¥å­—æ®µ
  targetField: string

  // æ•°æ®æ¥æº
  source:
    | { type: 'static'; value: unknown }
    | { type: 'global_input'; field: string }
    | { type: 'agent_output'; agentNodeId: string; field: string }
    | { type: 'expression'; expression: string }
}

/**
 * Agent è¿æ¥
 */
interface AgentConnection {
  id: string
  sourceAgentId: string
  targetAgentId: string

  // æ¡ä»¶ (å¯é€‰)
  condition?: {
    type: 'always' | 'if' | 'else'
    expression?: string
  }
}
```

### 16.3 ç»„åˆå™¨ç¼–è¾‘å™¨

```typescript
// components/composer/AgentComposer.tsx

/**
 * Agent ç»„åˆå™¨ç¼–è¾‘å™¨
 * åŸºäº React Flow çš„å¯è§†åŒ–ç¼–è¾‘å™¨
 */
export function AgentComposer({ compositionId }: Props) {
  const [nodes, setNodes] = useNodesState([]);
  const [edges, setEdges] = useEdgesState([]);

  // Agent èŠ‚ç‚¹ç±»å‹
  const nodeTypes = useMemo(() => ({
    agentNode: AgentNodeComponent,
    inputNode: InputNodeComponent,
    outputNode: OutputNodeComponent,
    conditionNode: ConditionNodeComponent,
    loopNode: LoopNodeComponent,
  }), []);

  // ä» Agent å•†åº—æ‹–æ‹½æ·»åŠ 
  const onDrop = useCallback((event: DragEvent) => {
    const agentData = JSON.parse(event.dataTransfer.getData('agent'));

    const newNode: Node = {
      id: nanoid(),
      type: 'agentNode',
      position: { x: event.clientX, y: event.clientY },
      data: {
        agentId: agentData.id,
        agentName: agentData.name,
        agentIcon: agentData.icon,
        inputs: agentData.inputs,
        outputs: agentData.outputs,
      },
    };

    setNodes((nds) => [...nds, newNode]);
  }, []);

  // è¿æ¥éªŒè¯
  const isValidConnection = useCallback((connection: Connection) => {
    const sourceNode = nodes.find(n => n.id === connection.source);
    const targetNode = nodes.find(n => n.id === connection.target);

    // éªŒè¯è¾“å‡º/è¾“å…¥ç±»å‹å…¼å®¹æ€§
    const sourceOutput = sourceNode?.data.outputs[connection.sourceHandle];
    const targetInput = targetNode?.data.inputs[connection.targetHandle];

    return isTypeCompatible(sourceOutput?.type, targetInput?.type);
  }, [nodes]);

  // æ‰§è¡Œç»„åˆ
  const executeComposition = async () => {
    const composition = buildComposition(nodes, edges);
    const result = await api.post('/compositions/execute', composition);
    // ...
  };

  return (
    <div className="h-full flex">
      {/* å·¦ä¾§ Agent é¢æ¿ */}
      <AgentPalette onDragStart={handleDragStart} />

      {/* ä¸­é—´ç”»å¸ƒ */}
      <ReactFlow
        nodes={nodes}
        edges={edges}
        nodeTypes={nodeTypes}
        onNodesChange={onNodesChange}
        onEdgesChange={onEdgesChange}
        onConnect={onConnect}
        onDrop={onDrop}
        isValidConnection={isValidConnection}
      >
        <Background />
        <Controls />
        <MiniMap />
      </ReactFlow>

      {/* å³ä¾§é…ç½®é¢æ¿ */}
      <ConfigPanel selectedNode={selectedNode} />
    </div>
  );
}
```

### 16.4 Agent é—´æ¶ˆæ¯åè®®

```typescript
// lib/agent-protocol.ts

/**
 * Agent é—´æ¶ˆæ¯æ ¼å¼
 */
interface AgentMessage {
  // æ¶ˆæ¯ID
  id: string

  // æ—¶é—´æˆ³
  timestamp: string

  // æ¥æº Agent
  source: {
    agentId: string
    nodeId: string
    executionId: string
  }

  // ç›®æ ‡ Agent
  target: {
    agentId: string
    nodeId: string
  }

  // æ¶ˆæ¯ç±»å‹
  type: 'data' | 'control' | 'error' | 'progress'

  // æ¶ˆæ¯å†…å®¹
  payload: unknown

  // å…ƒæ•°æ®
  metadata: {
    // æ•°æ®ç±»å‹
    contentType: string

    // æ•°æ®å¤§å°
    size: number

    // æ˜¯å¦å‹ç¼©
    compressed: boolean

    // è¿½è¸ªä¿¡æ¯
    traceId: string
    spanId: string
  }
}

/**
 * æ•°æ®ç±»å‹é€‚é…å™¨
 */
class DataTypeAdapter {
  /**
   * è‡ªåŠ¨ç±»å‹è½¬æ¢
   */
  static convert(data: unknown, fromType: DataType, toType: DataType): unknown {
    // ç›¸åŒç±»å‹ç›´æ¥è¿”å›
    if (fromType === toType) return data

    // ç±»å‹è½¬æ¢æ˜ å°„
    const converters: Record<string, (data: unknown) => unknown> = {
      'text->json': (d) => JSON.parse(d as string),
      'json->text': (d) => JSON.stringify(d),
      'array->text': (d) => (d as unknown[]).join('\n'),
      'text->array': (d) => (d as string).split('\n'),
      // ... æ›´å¤šè½¬æ¢
    }

    const key = `${fromType}->${toType}`
    const converter = converters[key]

    if (!converter) {
      throw new Error(`Cannot convert from ${fromType} to ${toType}`)
    }

    return converter(data)
  }
}
```

### 16.5 ç»„åˆå™¨ TodoList

- [ ] è®¾è®¡ç»„åˆå™¨ UI
- [ ] å®ç° Agent èŠ‚ç‚¹ç»„ä»¶
- [ ] å®ç°è¿æ¥ä¸æ•°æ®æµ
- [ ] å®ç°è¾“å…¥/è¾“å‡ºæ˜ å°„
- [ ] å®ç°æ¡ä»¶åˆ†æ”¯
- [ ] å®ç°å¾ªç¯æ‰§è¡Œ
- [ ] å®ç°å¹¶è¡Œæ‰§è¡Œ
- [ ] å®ç°ç»„åˆæ‰§è¡Œå¼•æ“
- [ ] å®ç°é”™è¯¯å¤„ç†ä¸é‡è¯•
- [ ] å®ç°ç»„åˆä¿å­˜ä¸åˆ†äº«

---

## 17. Agent è¿›åŒ–ç³»ç»Ÿ

### 17.1 è¿›åŒ–ç³»ç»Ÿæ¦‚è¿°

Agent è¿›åŒ–ç³»ç»Ÿé€šè¿‡ç”¨æˆ·åé¦ˆã€A/B æµ‹è¯•å’Œè‡ªåŠ¨ä¼˜åŒ–ï¼ŒæŒç»­æ”¹è¿› Agent çš„æ€§èƒ½å’Œè´¨é‡ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Agent è¿›åŒ–ç³»ç»Ÿ                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       æ•°æ®æ”¶é›†å±‚                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ æ‰§è¡Œæ—¥å¿—  â”‚  â”‚ ç”¨æˆ·åé¦ˆ  â”‚  â”‚ æ€§èƒ½æŒ‡æ ‡  â”‚  â”‚ ä½¿ç”¨ç»Ÿè®¡  â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       åˆ†æå¼•æ“å±‚                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  é—®é¢˜è¯†åˆ«            â”‚  â”‚  ä¼˜åŒ–å»ºè®®ç”Ÿæˆ                    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ å¤±è´¥æ¨¡å¼åˆ†æ      â”‚  â”‚  â€¢ Prompt ä¼˜åŒ–                   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ æ€§èƒ½ç“¶é¢ˆæ£€æµ‹      â”‚  â”‚  â€¢ å‚æ•°è°ƒä¼˜                      â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ ç”¨æˆ·ç—›ç‚¹æŒ–æ˜      â”‚  â”‚  â€¢ æµç¨‹ç®€åŒ–                      â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       å®éªŒå¹³å°å±‚                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ A/B æµ‹è¯•  â”‚  â”‚ ç°åº¦å‘å¸ƒ  â”‚  â”‚ æ•ˆæœè¯„ä¼°  â”‚  â”‚ è‡ªåŠ¨å›æ»š  â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       ç‰ˆæœ¬ç®¡ç†å±‚                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ ç‰ˆæœ¬æ§åˆ¶  â”‚  â”‚ å˜æ›´è¿½è¸ª  â”‚  â”‚ å›æ»šèƒ½åŠ›  â”‚  â”‚ å‘å¸ƒç®¡ç†  â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 17.2 ç”¨æˆ·åé¦ˆç³»ç»Ÿ

```sql
-- ç”¨æˆ·åé¦ˆè¡¨
CREATE TABLE agent_feedbacks (
    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    agent_id        UUID NOT NULL REFERENCES agents(id),
    user_id         UUID NOT NULL REFERENCES users(id),
    execution_id    UUID REFERENCES executions(id),

    -- åé¦ˆç±»å‹
    feedback_type   VARCHAR(20) NOT NULL,  -- thumbs_up, thumbs_down, report, suggestion

    -- åé¦ˆå†…å®¹
    rating          INTEGER,               -- 1-5 (å¯é€‰)
    content         TEXT,

    -- é—®é¢˜åˆ†ç±»
    issue_category  VARCHAR(50),           -- output_quality, speed, accuracy, usability

    -- æœŸæœ›è¾“å‡º (ç”¨äºå¯¹æ¯”)
    expected_output TEXT,

    -- å…ƒæ•°æ®
    metadata        JSONB DEFAULT '{}',

    -- å¤„ç†çŠ¶æ€
    status          VARCHAR(20) DEFAULT 'pending',
    resolved_at     TIMESTAMPTZ,

    created_at      TIMESTAMPTZ DEFAULT NOW()
);

-- åé¦ˆèšåˆè§†å›¾
CREATE MATERIALIZED VIEW agent_feedback_summary AS
SELECT
    agent_id,
    COUNT(*) AS total_feedbacks,
    COUNT(*) FILTER (WHERE feedback_type = 'thumbs_up') AS thumbs_up_count,
    COUNT(*) FILTER (WHERE feedback_type = 'thumbs_down') AS thumbs_down_count,
    AVG(rating) FILTER (WHERE rating IS NOT NULL) AS avg_rating,
    MODE() WITHIN GROUP (ORDER BY issue_category) AS top_issue_category,
    MAX(created_at) AS last_feedback_at
FROM agent_feedbacks
GROUP BY agent_id;
```

### 17.3 A/B æµ‹è¯•æ¡†æ¶

```typescript
// lib/ab-testing.ts

/**
 * A/B æµ‹è¯•å®éªŒ
 */
interface Experiment {
  id: string
  agentId: string
  name: string
  description: string

  // å®éªŒçŠ¶æ€
  status: 'draft' | 'running' | 'paused' | 'completed'

  // å˜ä½“é…ç½®
  variants: Variant[]

  // æµé‡åˆ†é…
  trafficAllocation: {
    [variantId: string]: number // ç™¾åˆ†æ¯”
  }

  // ç›®æ ‡æŒ‡æ ‡
  primaryMetric: MetricConfig
  secondaryMetrics?: MetricConfig[]

  // å®éªŒæ¡ä»¶
  targetingRules?: TargetingRule[]

  // ç»Ÿè®¡é…ç½®
  statisticalConfig: {
    confidenceLevel: number // ç½®ä¿¡åº¦ (å¦‚ 0.95)
    minimumSampleSize: number
    maximumDuration: number // æœ€é•¿è¿è¡Œå¤©æ•°
  }

  // æ—¶é—´
  startedAt?: Date
  endedAt?: Date
  createdAt: Date
}

/**
 * å®éªŒå˜ä½“
 */
interface Variant {
  id: string
  name: string
  description: string

  // å˜ä½“ç±»å‹
  type: 'control' | 'treatment'

  // ä¿®æ”¹å†…å®¹
  changes: VariantChange[]
}

/**
 * å˜ä½“ä¿®æ”¹
 */
interface VariantChange {
  type: 'prompt' | 'parameter' | 'node' | 'flow'
  path: string
  originalValue: unknown
  newValue: unknown
}

/**
 * ç›®æ ‡æŒ‡æ ‡é…ç½®
 */
interface MetricConfig {
  name: string
  type: 'conversion' | 'continuous' | 'ratio'

  // æ•°æ®æ¥æº
  source: 'execution' | 'feedback' | 'custom'

  // è®¡ç®—æ–¹å¼
  calculation: {
    event?: string
    field?: string
    aggregation?: 'count' | 'sum' | 'avg' | 'p50' | 'p95'
  }

  // æœŸæœ›æ–¹å‘
  direction: 'increase' | 'decrease'
}

/**
 * A/B æµ‹è¯•æœåŠ¡
 */
class ABTestingService {
  /**
   * åˆ†é…ç”¨æˆ·åˆ°å˜ä½“
   */
  async assignVariant(experimentId: string, userId: string): Promise<Variant> {
    // æ£€æŸ¥æ˜¯å¦å·²åˆ†é…
    const existing = await this.getAssignment(experimentId, userId)
    if (existing) return existing

    // è·å–å®éªŒé…ç½®
    const experiment = await this.getExperiment(experimentId)

    // æ£€æŸ¥å®šå‘è§„åˆ™
    if (!this.matchTargetingRules(experiment.targetingRules, userId)) {
      return experiment.variants.find((v) => v.type === 'control')!
    }

    // åŸºäºç”¨æˆ· ID çš„ç¡®å®šæ€§åˆ†é… (ä¿è¯ä¸€è‡´æ€§)
    const hash = this.hashUserId(userId, experimentId)
    const bucket = hash % 100

    let cumulative = 0
    for (const [variantId, allocation] of Object.entries(experiment.trafficAllocation)) {
      cumulative += allocation
      if (bucket < cumulative) {
        const variant = experiment.variants.find((v) => v.id === variantId)!
        await this.saveAssignment(experimentId, userId, variant.id)
        return variant
      }
    }

    // é»˜è®¤è¿”å›å¯¹ç…§ç»„
    return experiment.variants.find((v) => v.type === 'control')!
  }

  /**
   * è®°å½•æŒ‡æ ‡äº‹ä»¶
   */
  async trackMetric(
    experimentId: string,
    userId: string,
    metricName: string,
    value: number,
    metadata?: Record<string, unknown>
  ): Promise<void> {
    const assignment = await this.getAssignment(experimentId, userId)
    if (!assignment) return

    await this.db.insert('experiment_metrics', {
      experimentId,
      variantId: assignment.variantId,
      userId,
      metricName,
      value,
      metadata,
      timestamp: new Date(),
    })
  }

  /**
   * è®¡ç®—å®éªŒç»“æœ
   */
  async calculateResults(experimentId: string): Promise<ExperimentResults> {
    const experiment = await this.getExperiment(experimentId)
    const metrics = await this.getExperimentMetrics(experimentId)

    const results: VariantResult[] = []

    for (const variant of experiment.variants) {
      const variantMetrics = metrics.filter((m) => m.variantId === variant.id)

      const result: VariantResult = {
        variantId: variant.id,
        sampleSize: variantMetrics.length,
        metrics: {},
      }

      // è®¡ç®—ä¸»è¦æŒ‡æ ‡
      const primaryValues = variantMetrics
        .filter((m) => m.metricName === experiment.primaryMetric.name)
        .map((m) => m.value)

      result.metrics[experiment.primaryMetric.name] = {
        mean: this.mean(primaryValues),
        stdDev: this.stdDev(primaryValues),
        confidence: this.confidenceInterval(
          primaryValues,
          experiment.statisticalConfig.confidenceLevel
        ),
      }

      results.push(result)
    }

    // è®¡ç®—ç»Ÿè®¡æ˜¾è‘—æ€§
    const controlResult = results.find(
      (r) => experiment.variants.find((v) => v.id === r.variantId)?.type === 'control'
    )!

    for (const result of results) {
      if (result.variantId === controlResult.variantId) continue

      result.statisticalSignificance = this.calculateSignificance(
        controlResult.metrics[experiment.primaryMetric.name],
        result.metrics[experiment.primaryMetric.name],
        experiment.statisticalConfig.confidenceLevel
      )
    }

    return {
      experimentId,
      status: experiment.status,
      variants: results,
      recommendation: this.generateRecommendation(results, experiment),
    }
  }
}
```

### 17.4 è‡ªåŠ¨ä¼˜åŒ–å¼•æ“

```typescript
// lib/auto-optimization.ts

/**
 * è‡ªåŠ¨ä¼˜åŒ–å»ºè®®
 */
interface OptimizationSuggestion {
  id: string
  agentId: string

  // å»ºè®®ç±»å‹
  type: 'prompt' | 'parameter' | 'flow' | 'performance'

  // é—®é¢˜æè¿°
  problem: {
    description: string
    severity: 'low' | 'medium' | 'high'
    affectedMetric: string
    evidence: Evidence[]
  }

  // å»ºè®®æ–¹æ¡ˆ
  suggestion: {
    description: string
    expectedImprovement: string
    changes: Change[]
    risk: 'low' | 'medium' | 'high'
  }

  // çŠ¶æ€
  status: 'pending' | 'applied' | 'rejected' | 'testing'

  createdAt: Date
}

/**
 * ä¼˜åŒ–åˆ†æå™¨
 */
class OptimizationAnalyzer {
  /**
   * åˆ†æ Agent å¹¶ç”Ÿæˆä¼˜åŒ–å»ºè®®
   */
  async analyze(agentId: string): Promise<OptimizationSuggestion[]> {
    const suggestions: OptimizationSuggestion[] = []

    // è·å–å†å²æ•°æ®
    const executions = await this.getRecentExecutions(agentId, 1000)
    const feedbacks = await this.getRecentFeedbacks(agentId, 500)
    const agent = await this.getAgent(agentId)

    // 1. åˆ†æå¤±è´¥æ¨¡å¼
    const failurePatterns = await this.analyzeFailurePatterns(executions)
    suggestions.push(...this.generateFailureFixSuggestions(failurePatterns))

    // 2. åˆ†ææ€§èƒ½ç“¶é¢ˆ
    const performanceIssues = await this.analyzePerformance(executions)
    suggestions.push(...this.generatePerformanceSuggestions(performanceIssues))

    // 3. åˆ†æç”¨æˆ·åé¦ˆ
    const feedbackInsights = await this.analyzeFeedback(feedbacks)
    suggestions.push(...this.generateFeedbackBasedSuggestions(feedbackInsights))

    // 4. Prompt ä¼˜åŒ–å»ºè®® (ä½¿ç”¨ LLM)
    const promptSuggestions = await this.analyzePrompts(agent)
    suggestions.push(...promptSuggestions)

    return suggestions
  }

  /**
   * åˆ†æå¤±è´¥æ¨¡å¼
   */
  private async analyzeFailurePatterns(executions: Execution[]): Promise<FailurePattern[]> {
    const failedExecutions = executions.filter((e) => e.status === 'failed')

    // æŒ‰é”™è¯¯ç±»å‹èšç±»
    const errorClusters = this.clusterErrors(failedExecutions)

    // è¯†åˆ«å¸¸è§æ¨¡å¼
    const patterns: FailurePattern[] = []

    for (const cluster of errorClusters) {
      if (cluster.count >= 5) {
        // è‡³å°‘å‡ºç°5æ¬¡
        patterns.push({
          errorType: cluster.type,
          frequency: cluster.count / failedExecutions.length,
          commonInputPatterns: this.extractInputPatterns(cluster.executions),
          nodeId: this.findFailingNode(cluster.executions),
        })
      }
    }

    return patterns
  }

  /**
   * ä½¿ç”¨ LLM åˆ†æ Prompt ä¼˜åŒ–å»ºè®®
   */
  private async analyzePrompts(agent: Agent): Promise<OptimizationSuggestion[]> {
    const workflow = agent.workflow
    const llmNodes = workflow.nodes.filter((n) => n.type === 'llm')

    const suggestions: OptimizationSuggestion[] = []

    for (const node of llmNodes) {
      const prompt = node.data.config.systemPrompt + '\n' + node.data.config.userPrompt

      const analysis = await this.llmService.chat({
        model: 'gpt-4',
        messages: [
          {
            role: 'system',
            content: `ä½ æ˜¯ä¸€ä½ Prompt å·¥ç¨‹ä¸“å®¶ã€‚è¯·åˆ†æä»¥ä¸‹ Prompt å¹¶æä¾›ä¼˜åŒ–å»ºè®®ã€‚
å…³æ³¨ä»¥ä¸‹æ–¹é¢ï¼š
1. æ¸…æ™°åº¦å’Œå…·ä½“æ€§
2. è¾“å‡ºæ ¼å¼æ§åˆ¶
3. æ½œåœ¨çš„æ­§ä¹‰æˆ–é”™è¯¯
4. æ•ˆç‡ä¼˜åŒ–ï¼ˆå‡å°‘ token ä½¿ç”¨ï¼‰
5. å¯ç»´æŠ¤æ€§`,
          },
          {
            role: 'user',
            content: `è¯·åˆ†æè¿™ä¸ª Prompt:\n\n${prompt}`,
          },
        ],
        responseFormat: { type: 'json' },
      })

      const result = JSON.parse(analysis.content)

      if (result.suggestions?.length > 0) {
        suggestions.push({
          id: nanoid(),
          agentId: agent.id,
          type: 'prompt',
          problem: {
            description: result.issues.join('; '),
            severity: result.severity,
            affectedMetric: 'output_quality',
            evidence: [],
          },
          suggestion: {
            description: result.suggestions.join('; '),
            expectedImprovement: result.expectedImprovement,
            changes: [
              {
                type: 'prompt',
                nodeId: node.id,
                field: 'systemPrompt',
                oldValue: node.data.config.systemPrompt,
                newValue: result.optimizedPrompt,
              },
            ],
            risk: 'low',
          },
          status: 'pending',
          createdAt: new Date(),
        })
      }
    }

    return suggestions
  }
}
```

### 17.5 è¿›åŒ–ç³»ç»Ÿ TodoList

- [ ] å®ç°ç”¨æˆ·åé¦ˆæ”¶é›†
- [ ] å®ç°åé¦ˆåˆ†æå¼•æ“
- [ ] å®ç° A/B æµ‹è¯•æ¡†æ¶
- [ ] å®ç°ç°åº¦å‘å¸ƒ
- [ ] å®ç°æ•ˆæœè¯„ä¼°
- [ ] å®ç°è‡ªåŠ¨ä¼˜åŒ–å»ºè®®
- [ ] å®ç°ç‰ˆæœ¬ç®¡ç†
- [ ] å®ç°è‡ªåŠ¨å›æ»š
- [ ] å®ç°åˆ›ä½œè€…ä¼˜åŒ–é¢æ¿

---

## 18. åˆ›ä½œè€…ç»æµç³»ç»Ÿ

### 18.1 ç»æµç³»ç»Ÿæ¦‚è¿°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         åˆ›ä½œè€…ç»æµç³»ç»Ÿ                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       æ”¶å…¥æ¥æº                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ å•æ¬¡è´­ä¹°  â”‚  â”‚ è®¢é˜…æ”¶å…¥  â”‚  â”‚ ä½¿ç”¨åˆ†æˆ  â”‚  â”‚ æ‰“èµæ”¶å…¥  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  70%      â”‚  â”‚  70%      â”‚  â”‚  50%      â”‚  â”‚  90%      â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       äº¤æ˜“æµç¨‹                                   â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚   ç”¨æˆ·ä»˜æ¬¾ â†’ å¹³å°æ”¶æ¬¾ â†’ åˆ†è´¦è®¡ç®— â†’ åˆ›ä½œè€…ç»“ç®— â†’ æç°          â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       æ¿€åŠ±æœºåˆ¶                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ æ–°æ‰‹æ¿€åŠ±  â”‚  â”‚ ä¼˜è´¨å¥–åŠ±  â”‚  â”‚ æµé‡æ‰¶æŒ  â”‚  â”‚ ç­‰çº§æƒç›Š  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ é¦–3æœˆ0%   â”‚  â”‚ æœˆå…¥>1ä¸‡  â”‚  â”‚ ç²¾é€‰æ¨è  â”‚  â”‚ é™ä½åˆ†æˆ  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ å¹³å°åˆ†æˆ  â”‚  â”‚ åˆ†æˆæå‡  â”‚  â”‚ é¦–é¡µæ›å…‰  â”‚  â”‚ ä¸“å±åŠŸèƒ½  â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 18.2 æ•°æ®æ¨¡å‹

```sql
-- è®¢å•è¡¨
CREATE TABLE orders (
    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    order_no        VARCHAR(50) UNIQUE NOT NULL,

    -- ä¹°å®¶ä¿¡æ¯
    user_id         UUID NOT NULL REFERENCES users(id),

    -- å•†å“ä¿¡æ¯
    item_type       VARCHAR(20) NOT NULL,  -- agent, plugin, subscription
    item_id         UUID NOT NULL,
    item_name       VARCHAR(200) NOT NULL,

    -- å–å®¶ä¿¡æ¯
    seller_id       UUID NOT NULL REFERENCES users(id),

    -- é‡‘é¢
    amount          DECIMAL(10, 2) NOT NULL,
    currency        VARCHAR(10) DEFAULT 'CNY',

    -- åˆ†æˆ
    platform_fee    DECIMAL(10, 2) NOT NULL,
    seller_amount   DECIMAL(10, 2) NOT NULL,

    -- æ”¯ä»˜ä¿¡æ¯
    payment_method  VARCHAR(50),
    payment_channel VARCHAR(50),
    transaction_id  VARCHAR(100),

    -- çŠ¶æ€
    status          VARCHAR(20) DEFAULT 'pending',

    -- æ—¶é—´
    created_at      TIMESTAMPTZ DEFAULT NOW(),
    paid_at         TIMESTAMPTZ,
    completed_at    TIMESTAMPTZ,
    refunded_at     TIMESTAMPTZ
);

-- åˆ›ä½œè€…è´¦æˆ·è¡¨
CREATE TABLE creator_accounts (
    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id         UUID UNIQUE NOT NULL REFERENCES users(id),

    -- è´¦æˆ·ä¿¡æ¯
    account_status  VARCHAR(20) DEFAULT 'active',

    -- ç­‰çº§
    creator_level   INTEGER DEFAULT 1,

    -- åˆ†æˆæ¯”ä¾‹ (å¯æ ¹æ®ç­‰çº§è°ƒæ•´)
    revenue_share   DECIMAL(4, 2) DEFAULT 0.70,

    -- ä½™é¢
    balance         DECIMAL(12, 2) DEFAULT 0,
    pending_balance DECIMAL(12, 2) DEFAULT 0,

    -- ç´¯è®¡æ”¶å…¥
    total_earnings  DECIMAL(12, 2) DEFAULT 0,
    total_withdrawn DECIMAL(12, 2) DEFAULT 0,

    -- ç»“ç®—ä¿¡æ¯
    settlement_type VARCHAR(20),  -- alipay, wechat, bank
    settlement_account JSONB,

    -- ç¨åŠ¡ä¿¡æ¯
    tax_info        JSONB,

    -- æ—¶é—´
    created_at      TIMESTAMPTZ DEFAULT NOW(),
    updated_at      TIMESTAMPTZ DEFAULT NOW()
);

-- æ”¶å…¥æ˜ç»†è¡¨
CREATE TABLE earnings (
    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    creator_id      UUID NOT NULL REFERENCES creator_accounts(id),

    -- æ¥æº
    source_type     VARCHAR(20) NOT NULL,  -- sale, subscription, usage, tip
    source_id       UUID,

    -- é‡‘é¢
    amount          DECIMAL(10, 2) NOT NULL,
    currency        VARCHAR(10) DEFAULT 'CNY',

    -- çŠ¶æ€
    status          VARCHAR(20) DEFAULT 'pending',

    -- ç»“ç®—
    settlement_id   UUID,
    settled_at      TIMESTAMPTZ,

    -- æ—¶é—´
    created_at      TIMESTAMPTZ DEFAULT NOW()
);

-- æç°è®°å½•è¡¨
CREATE TABLE withdrawals (
    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    creator_id      UUID NOT NULL REFERENCES creator_accounts(id),

    -- é‡‘é¢
    amount          DECIMAL(10, 2) NOT NULL,
    currency        VARCHAR(10) DEFAULT 'CNY',

    -- æ‰‹ç»­è´¹
    fee             DECIMAL(10, 2) DEFAULT 0,
    actual_amount   DECIMAL(10, 2) NOT NULL,

    -- åˆ°è´¦æ–¹å¼
    method          VARCHAR(20) NOT NULL,
    account_info    JSONB NOT NULL,

    -- çŠ¶æ€
    status          VARCHAR(20) DEFAULT 'pending',

    -- å¤„ç†ä¿¡æ¯
    processed_at    TIMESTAMPTZ,
    transaction_id  VARCHAR(100),
    failure_reason  TEXT,

    -- æ—¶é—´
    created_at      TIMESTAMPTZ DEFAULT NOW()
);

-- åˆ›ä½œè€…ç­‰çº§é…ç½®è¡¨
CREATE TABLE creator_levels (
    level           INTEGER PRIMARY KEY,
    name            VARCHAR(50) NOT NULL,
    min_earnings    DECIMAL(12, 2) NOT NULL,
    revenue_share   DECIMAL(4, 2) NOT NULL,
    benefits        JSONB DEFAULT '{}',

    created_at      TIMESTAMPTZ DEFAULT NOW()
);

-- åˆå§‹ç­‰çº§é…ç½®
INSERT INTO creator_levels (level, name, min_earnings, revenue_share, benefits) VALUES
(1, 'æ–°æ™‹åˆ›ä½œè€…', 0, 0.70, '{"features": ["basic_analytics"]}'),
(2, 'æ´»è·ƒåˆ›ä½œè€…', 1000, 0.72, '{"features": ["basic_analytics", "priority_review"]}'),
(3, 'ä¼˜è´¨åˆ›ä½œè€…', 5000, 0.75, '{"features": ["advanced_analytics", "priority_review", "featured_chance"]}'),
(4, 'æ˜æ˜Ÿåˆ›ä½œè€…', 20000, 0.78, '{"features": ["all_analytics", "instant_review", "featured_boost", "custom_page"]}'),
(5, 'é¡¶çº§åˆ›ä½œè€…', 100000, 0.80, '{"features": ["all_features", "dedicated_support", "revenue_advance"]}');
```

### 18.3 æ”¯ä»˜ç³»ç»Ÿé›†æˆ

```typescript
// lib/payment/payment-service.ts

/**
 * æ”¯ä»˜æœåŠ¡æ¥å£
 */
interface PaymentService {
  /**
   * åˆ›å»ºæ”¯ä»˜è®¢å•
   */
  createPayment(options: CreatePaymentOptions): Promise<PaymentResult>

  /**
   * æŸ¥è¯¢æ”¯ä»˜çŠ¶æ€
   */
  queryPayment(transactionId: string): Promise<PaymentStatus>

  /**
   * å‘èµ·é€€æ¬¾
   */
  refund(options: RefundOptions): Promise<RefundResult>

  /**
   * æç°åˆ°ç”¨æˆ·è´¦æˆ·
   */
  withdraw(options: WithdrawOptions): Promise<WithdrawResult>
}

/**
 * æ”¯ä»˜èšåˆæœåŠ¡
 */
class PaymentAggregator implements PaymentService {
  private providers: Map<string, PaymentProvider>

  constructor() {
    this.providers = new Map([
      ['alipay', new AlipayProvider()],
      ['wechat', new WechatPayProvider()],
      ['stripe', new StripeProvider()],
    ])
  }

  async createPayment(options: CreatePaymentOptions): Promise<PaymentResult> {
    const provider = this.providers.get(options.method)
    if (!provider) {
      throw new PaymentError('INVALID_METHOD', `ä¸æ”¯æŒçš„æ”¯ä»˜æ–¹å¼: ${options.method}`)
    }

    // åˆ›å»ºå†…éƒ¨è®¢å•
    const order = await this.createOrder(options)

    // è°ƒç”¨æ”¯ä»˜æ¸ é“
    const paymentResult = await provider.createPayment({
      orderId: order.orderNo,
      amount: options.amount,
      currency: options.currency,
      description: options.description,
      returnUrl: options.returnUrl,
      notifyUrl: `${config.apiUrl}/webhooks/payment/${options.method}`,
    })

    // æ›´æ–°è®¢å•
    await this.updateOrder(order.id, {
      transactionId: paymentResult.transactionId,
      paymentChannel: options.method,
    })

    return {
      orderId: order.id,
      orderNo: order.orderNo,
      paymentUrl: paymentResult.paymentUrl,
      qrCode: paymentResult.qrCode,
    }
  }

  /**
   * å¤„ç†æ”¯ä»˜å›è°ƒ
   */
  async handlePaymentNotification(provider: string, notification: unknown): Promise<void> {
    const paymentProvider = this.providers.get(provider)
    if (!paymentProvider) return

    // éªŒè¯ç­¾å
    const isValid = await paymentProvider.verifyNotification(notification)
    if (!isValid) {
      throw new PaymentError('INVALID_SIGNATURE', 'ç­¾åéªŒè¯å¤±è´¥')
    }

    // è§£æé€šçŸ¥
    const paymentInfo = await paymentProvider.parseNotification(notification)

    // æ›´æ–°è®¢å•çŠ¶æ€
    const order = await this.getOrderByNo(paymentInfo.orderId)
    if (!order) return

    if (paymentInfo.status === 'success') {
      await this.completeOrder(order.id, paymentInfo)

      // åˆ†è´¦å¤„ç†
      await this.processRevenueSplit(order)

      // å‘é€é€šçŸ¥
      await this.notifyPaymentSuccess(order)
    } else if (paymentInfo.status === 'failed') {
      await this.failOrder(order.id, paymentInfo.failureReason)
    }
  }

  /**
   * å¤„ç†æ”¶å…¥åˆ†æˆ
   */
  private async processRevenueSplit(order: Order): Promise<void> {
    const creatorAccount = await this.getCreatorAccount(order.sellerId)

    // è®¡ç®—åˆ†æˆæ¯”ä¾‹
    const revenueShare = creatorAccount.revenueShare
    const platformFee = order.amount * (1 - revenueShare)
    const sellerAmount = order.amount - platformFee

    // æ›´æ–°è®¢å•åˆ†æˆä¿¡æ¯
    await this.updateOrder(order.id, {
      platformFee,
      sellerAmount,
      status: 'completed',
      completedAt: new Date(),
    })

    // åˆ›å»ºæ”¶å…¥è®°å½•
    await this.createEarning({
      creatorId: creatorAccount.id,
      sourceType: 'sale',
      sourceId: order.id,
      amount: sellerAmount,
      status: 'pending',
    })

    // æ›´æ–°åˆ›ä½œè€…å¾…ç»“ç®—ä½™é¢
    await this.updateCreatorBalance(creatorAccount.id, {
      pendingBalance: creatorAccount.pendingBalance + sellerAmount,
    })
  }
}
```

### 18.4 åˆ›ä½œè€… API

```yaml
# ===== åˆ›ä½œè€…è´¦æˆ· =====

# è·å–è´¦æˆ·ä¿¡æ¯
GET /api/v1/creator/account
Response:
  account: CreatorAccount
  level: CreatorLevel
  stats: AccountStats

# æ›´æ–°ç»“ç®—ä¿¡æ¯
PUT /api/v1/creator/account/settlement
Request:
  type: string              # alipay/wechat/bank
  account: object           # è´¦æˆ·ä¿¡æ¯
Response:
  account: CreatorAccount

# ===== æ”¶å…¥ç®¡ç† =====

# è·å–æ”¶å…¥æ¦‚è§ˆ
GET /api/v1/creator/earnings/overview
Query:
  period: string            # 7d/30d/90d/all
Response:
  total_earnings: number
  pending_balance: number
  available_balance: number
  earnings_trend: DataPoint[]
  top_agents: AgentEarnings[]

# è·å–æ”¶å…¥æ˜ç»†
GET /api/v1/creator/earnings
Query:
  source_type?: string
  status?: string
  start_date?: string
  end_date?: string
  page: number
  page_size: number
Response:
  earnings: Earning[]
  total: number
  summary: EarningsSummary

# ===== æç°ç®¡ç† =====

# ç”³è¯·æç°
POST /api/v1/creator/withdrawals
Request:
  amount: number
  method: string
Response:
  withdrawal: Withdrawal

# è·å–æç°è®°å½•
GET /api/v1/creator/withdrawals
Query:
  status?: string
  page: number
  page_size: number
Response:
  withdrawals: Withdrawal[]
  total: number

# ===== æ•°æ®åˆ†æ =====

# è·å– Agent åˆ†ææ•°æ®
GET /api/v1/creator/agents/:id/analytics
Query:
  period: string
Response:
  overview:
    total_uses: number
    unique_users: number
    revenue: number
    rating: number
  usage_trend: DataPoint[]
  revenue_trend: DataPoint[]
  user_retention: RetentionData
  geographic_distribution: GeoData[]
  user_segments: SegmentData[]
```

### 18.5 åˆ›ä½œè€…ç»æµ TodoList

- [ ] å®ç°åˆ›ä½œè€…è´¦æˆ·ç³»ç»Ÿ
- [ ] é›†æˆæ”¯ä»˜å®æ”¯ä»˜
- [ ] é›†æˆå¾®ä¿¡æ”¯ä»˜
- [ ] å®ç°è®¢å•ç®¡ç†
- [ ] å®ç°æ”¶å…¥åˆ†æˆè®¡ç®—
- [ ] å®ç°æç°åŠŸèƒ½
- [ ] å®ç°åˆ›ä½œè€…ç­‰çº§ç³»ç»Ÿ
- [ ] å®ç°åˆ›ä½œè€…æ•°æ®åˆ†æ
- [ ] å®ç°æ¿€åŠ±æœºåˆ¶
- [ ] å®ç°ç¨åŠ¡åˆè§„

---

# ç¬¬äº”éƒ¨åˆ†ï¼šæœ¬åœ°ä¼˜å…ˆæ¶æ„

---

## 19. æœ¬åœ°/äº‘ç«¯åŒæ¨¡å¼æ¶æ„

### 19.1 æ¶æ„æ¦‚è¿°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       æœ¬åœ°/äº‘ç«¯åŒæ¨¡å¼æ¶æ„                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       è¿è¡Œæ¨¡å¼é€‰æ‹©                               â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚  çº¯æœ¬åœ°æ¨¡å¼  â”‚  â”‚  çº¯äº‘ç«¯æ¨¡å¼  â”‚  â”‚  æ··åˆæ¨¡å¼ (æ¨è)       â”‚ â”‚   â”‚
â”‚  â”‚  â”‚             â”‚  â”‚             â”‚  â”‚                         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ å®Œå…¨ç¦»çº¿  â”‚  â”‚ â€¢ å¤šç«¯åŒæ­¥  â”‚  â”‚ â€¢ æ•æ„Ÿæ•°æ®æœ¬åœ°         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ æ•°æ®ä¸å‡º  â”‚  â”‚ â€¢ äº‘ç«¯LLM   â”‚  â”‚ â€¢ æ™®é€šæ•°æ®äº‘ç«¯         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ æœ¬åœ°LLM   â”‚  â”‚ â€¢ è‡ªåŠ¨å¤‡ä»½  â”‚  â”‚ â€¢ æ™ºèƒ½è·¯ç”±             â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       ç»Ÿä¸€æŠ½è±¡å±‚                                 â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚   â”‚                 Runtime Abstraction                      â”‚  â”‚   â”‚
â”‚  â”‚   â”‚   â€¢ StorageProvider   (æœ¬åœ°å­˜å‚¨ / äº‘ç«¯å­˜å‚¨)              â”‚  â”‚   â”‚
â”‚  â”‚   â”‚   â€¢ LLMProvider       (æœ¬åœ°æ¨¡å‹ / äº‘ç«¯API)               â”‚  â”‚   â”‚
â”‚  â”‚   â”‚   â€¢ SyncProvider      (åŒæ­¥å¼•æ“)                         â”‚  â”‚   â”‚
â”‚  â”‚   â”‚   â€¢ ExecutionProvider (æœ¬åœ°æ‰§è¡Œ / äº‘ç«¯æ‰§è¡Œ)              â”‚  â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      æœ¬åœ°è¿è¡Œæ—¶            â”‚  â”‚         äº‘ç«¯æœåŠ¡                   â”‚ â”‚
â”‚  â”‚                           â”‚  â”‚                                   â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ SQLite              â”‚  â”‚  â”‚  â”‚ PostgreSQL                  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ æœ¬åœ°æ–‡ä»¶å­˜å‚¨         â”‚  â”‚  â”‚  â”‚ Redis                       â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ Ollama/LM Studio    â”‚  â”‚  â”‚  â”‚ OpenAI/Claude API           â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ æœ¬åœ°æ‰§è¡Œå¼•æ“         â”‚  â”‚  â”‚  â”‚ äº‘ç«¯æ‰§è¡Œå¼•æ“                 â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 19.2 è¿è¡Œæ—¶æŠ½è±¡å±‚

```typescript
// lib/runtime/runtime-provider.ts

/**
 * è¿è¡Œæ—¶é…ç½®
 */
interface RuntimeConfig {
  mode: 'local' | 'cloud' | 'hybrid'

  local?: {
    dbPath: string
    llmEndpoint?: string
    storagePath: string
  }

  cloud?: {
    apiUrl: string
    wsUrl: string
  }

  hybrid?: {
    syncEnabled: boolean
    syncInterval: number
    offlineSupport: boolean
    sensitiveDataLocal: boolean
  }
}

/**
 * ç»Ÿä¸€è¿è¡Œæ—¶æä¾›è€…
 */
class RuntimeProvider {
  private config: RuntimeConfig
  private storageProvider: StorageProvider
  private llmProvider: LLMProvider
  private executionProvider: ExecutionProvider
  private syncProvider?: SyncProvider

  constructor(config: RuntimeConfig) {
    this.config = config
    this.initializeProviders()
  }

  private initializeProviders(): void {
    switch (this.config.mode) {
      case 'local':
        this.storageProvider = new SQLiteStorageProvider(this.config.local!.dbPath)
        this.llmProvider = new LocalLLMProvider(this.config.local!.llmEndpoint)
        this.executionProvider = new LocalExecutionProvider()
        break

      case 'cloud':
        this.storageProvider = new CloudStorageProvider(this.config.cloud!.apiUrl)
        this.llmProvider = new CloudLLMProvider(this.config.cloud!.apiUrl)
        this.executionProvider = new CloudExecutionProvider(this.config.cloud!)
        break

      case 'hybrid':
        this.storageProvider = new HybridStorageProvider({
          local: new SQLiteStorageProvider(this.config.local!.dbPath),
          cloud: new CloudStorageProvider(this.config.cloud!.apiUrl),
          sensitiveLocal: this.config.hybrid!.sensitiveDataLocal,
        })
        this.llmProvider = new HybridLLMProvider({
          local: new LocalLLMProvider(this.config.local!.llmEndpoint),
          cloud: new CloudLLMProvider(this.config.cloud!.apiUrl),
        })
        this.executionProvider = new HybridExecutionProvider({
          local: new LocalExecutionProvider(),
          cloud: new CloudExecutionProvider(this.config.cloud!),
        })
        this.syncProvider = new SyncProvider({
          local: this.storageProvider.local,
          cloud: this.storageProvider.cloud,
          interval: this.config.hybrid!.syncInterval,
        })
        break
    }
  }

  /**
   * è·å–å­˜å‚¨æä¾›è€…
   */
  getStorage(): StorageProvider {
    return this.storageProvider
  }

  /**
   * è·å– LLM æä¾›è€…
   */
  getLLM(): LLMProvider {
    return this.llmProvider
  }

  /**
   * è·å–æ‰§è¡Œæä¾›è€…
   */
  getExecution(): ExecutionProvider {
    return this.executionProvider
  }

  /**
   * è·å–åŒæ­¥æä¾›è€…
   */
  getSync(): SyncProvider | undefined {
    return this.syncProvider
  }

  /**
   * æ£€æŸ¥ç½‘ç»œè¿æ¥çŠ¶æ€
   */
  async checkConnectivity(): Promise<ConnectivityStatus> {
    if (this.config.mode === 'local') {
      return { online: false, mode: 'local' }
    }

    try {
      const response = await fetch(`${this.config.cloud!.apiUrl}/health`, {
        method: 'HEAD',
        timeout: 5000,
      })
      return { online: response.ok, mode: this.config.mode }
    } catch {
      return { online: false, mode: 'offline' }
    }
  }
}

/**
 * å­˜å‚¨æä¾›è€…æ¥å£
 */
interface StorageProvider {
  // å·¥ä½œæµ
  getWorkflow(id: string): Promise<Workflow | null>
  saveWorkflow(workflow: Workflow): Promise<void>
  deleteWorkflow(id: string): Promise<void>
  listWorkflows(params: ListParams): Promise<PagedResult<Workflow>>

  // æ‰§è¡Œè®°å½•
  getExecution(id: string): Promise<Execution | null>
  saveExecution(execution: Execution): Promise<void>
  listExecutions(params: ListParams): Promise<PagedResult<Execution>>

  // ç”¨æˆ·æ•°æ®
  getUserData<T>(key: string): Promise<T | null>
  setUserData<T>(key: string, value: T): Promise<void>

  // åŒæ­¥ç›¸å…³
  getLastSyncTime(): Promise<Date | null>
  setLastSyncTime(time: Date): Promise<void>
  getPendingChanges(): Promise<Change[]>
  markSynced(changeIds: string[]): Promise<void>
}

/**
 * LLM æä¾›è€…æ¥å£
 */
interface LLMProvider {
  chat(options: ChatOptions): Promise<ChatResponse>
  chatStream(options: ChatOptions): AsyncIterable<StreamChunk>
  embed(text: string): Promise<number[]>
  listModels(): Promise<ModelInfo[]>
  isAvailable(): Promise<boolean>
}

/**
 * æ‰§è¡Œæä¾›è€…æ¥å£
 */
interface ExecutionProvider {
  execute(workflow: Workflow, inputs: Record<string, unknown>): Promise<Execution>
  cancel(executionId: string): Promise<void>
  getStatus(executionId: string): Promise<ExecutionStatus>
  subscribeToUpdates(executionId: string): AsyncIterable<ExecutionUpdate>
}
```

### 19.3 æ¡Œé¢åº”ç”¨æ¶æ„ (Tauri)

```rust
// src-tauri/src/main.rs

use tauri::{Manager, State};
use std::sync::Mutex;

// åº”ç”¨çŠ¶æ€
struct AppState {
    db: Mutex<SqliteConnection>,
    llm_client: Mutex<Option<OllamaClient>>,
    config: Mutex<AppConfig>,
}

#[tauri::command]
async fn get_workflows(state: State<'_, AppState>) -> Result<Vec<Workflow>, String> {
    let db = state.db.lock().map_err(|e| e.to_string())?;
    db.get_all_workflows().map_err(|e| e.to_string())
}

#[tauri::command]
async fn execute_workflow(
    state: State<'_, AppState>,
    workflow_id: String,
    inputs: serde_json::Value,
) -> Result<Execution, String> {
    let db = state.db.lock().map_err(|e| e.to_string())?;
    let workflow = db.get_workflow(&workflow_id).map_err(|e| e.to_string())?;

    // ä½¿ç”¨æœ¬åœ°æ‰§è¡Œå¼•æ“
    let executor = LocalExecutor::new(&state);
    executor.execute(workflow, inputs).await.map_err(|e| e.to_string())
}

#[tauri::command]
async fn chat_with_local_llm(
    state: State<'_, AppState>,
    messages: Vec<Message>,
    model: Option<String>,
) -> Result<ChatResponse, String> {
    let llm_client = state.llm_client.lock().map_err(|e| e.to_string())?;

    if let Some(client) = llm_client.as_ref() {
        client.chat(messages, model).await.map_err(|e| e.to_string())
    } else {
        Err("æœ¬åœ° LLM æœªé…ç½®".to_string())
    }
}

#[tauri::command]
async fn sync_with_cloud(
    state: State<'_, AppState>,
    app_handle: tauri::AppHandle,
) -> Result<SyncResult, String> {
    let config = state.config.lock().map_err(|e| e.to_string())?;

    if !config.sync_enabled {
        return Err("åŒæ­¥æœªå¯ç”¨".to_string());
    }

    let sync_service = SyncService::new(&config);
    let result = sync_service.sync().await.map_err(|e| e.to_string())?;

    // å‘é€åŒæ­¥å®Œæˆäº‹ä»¶
    app_handle.emit_all("sync-completed", &result).ok();

    Ok(result)
}

fn main() {
    tauri::Builder::default()
        .setup(|app| {
            // åˆå§‹åŒ–æ•°æ®åº“
            let app_dir = app.path_resolver().app_data_dir().unwrap();
            let db_path = app_dir.join("reverseai.db");
            let db = SqliteConnection::open(&db_path)?;
            db.run_migrations()?;

            // åˆå§‹åŒ–æœ¬åœ° LLM å®¢æˆ·ç«¯
            let llm_client = OllamaClient::try_new("http://localhost:11434").ok();

            // åŠ è½½é…ç½®
            let config = AppConfig::load(&app_dir)?;

            app.manage(AppState {
                db: Mutex::new(db),
                llm_client: Mutex::new(llm_client),
                config: Mutex::new(config),
            });

            Ok(())
        })
        .invoke_handler(tauri::generate_handler![
            get_workflows,
            execute_workflow,
            chat_with_local_llm,
            sync_with_cloud,
        ])
        .run(tauri::generate_context!())
        .expect("error while running tauri application");
}
```

### 19.4 æ¨¡å¼åˆ‡æ¢é€»è¾‘

```typescript
// lib/runtime/mode-switcher.ts

/**
 * è¿è¡Œæ¨¡å¼åˆ‡æ¢å™¨
 */
class ModeSwitcher {
  private currentMode: RuntimeMode
  private runtime: RuntimeProvider
  private listeners: Set<ModeChangeListener>

  constructor(initialConfig: RuntimeConfig) {
    this.currentMode = initialConfig.mode
    this.runtime = new RuntimeProvider(initialConfig)
    this.listeners = new Set()

    // ç›‘å¬ç½‘ç»œçŠ¶æ€å˜åŒ–
    this.setupNetworkListener()
  }

  /**
   * åˆ‡æ¢åˆ°æœ¬åœ°æ¨¡å¼
   */
  async switchToLocal(): Promise<void> {
    if (this.currentMode === 'local') return

    // ä¿å­˜æœªåŒæ­¥çš„æ•°æ®
    if (this.currentMode === 'hybrid') {
      await this.runtime.getSync()?.forceSyncPending()
    }

    // é‡æ–°åˆå§‹åŒ–è¿è¡Œæ—¶
    this.runtime = new RuntimeProvider({
      mode: 'local',
      local: await this.getLocalConfig(),
    })

    this.currentMode = 'local'
    this.notifyListeners('local')
  }

  /**
   * åˆ‡æ¢åˆ°äº‘ç«¯æ¨¡å¼
   */
  async switchToCloud(): Promise<void> {
    if (this.currentMode === 'cloud') return

    // æ£€æŸ¥ç½‘ç»œ
    const connectivity = await this.runtime.checkConnectivity()
    if (!connectivity.online) {
      throw new Error('æ— æ³•è¿æ¥åˆ°äº‘ç«¯æœåŠ¡')
    }

    // é‡æ–°åˆå§‹åŒ–è¿è¡Œæ—¶
    this.runtime = new RuntimeProvider({
      mode: 'cloud',
      cloud: await this.getCloudConfig(),
    })

    this.currentMode = 'cloud'
    this.notifyListeners('cloud')
  }

  /**
   * åˆ‡æ¢åˆ°æ··åˆæ¨¡å¼
   */
  async switchToHybrid(): Promise<void> {
    if (this.currentMode === 'hybrid') return

    this.runtime = new RuntimeProvider({
      mode: 'hybrid',
      local: await this.getLocalConfig(),
      cloud: await this.getCloudConfig(),
      hybrid: await this.getHybridConfig(),
    })

    this.currentMode = 'hybrid'
    this.notifyListeners('hybrid')

    // å¯åŠ¨åŒæ­¥
    this.runtime.getSync()?.startAutoSync()
  }

  /**
   * ç½‘ç»œçŠ¶æ€å˜åŒ–å¤„ç†
   */
  private setupNetworkListener(): void {
    if (typeof window !== 'undefined') {
      window.addEventListener('online', () => this.handleOnline())
      window.addEventListener('offline', () => this.handleOffline())
    }
  }

  private async handleOffline(): Promise<void> {
    if (this.currentMode === 'cloud') {
      // äº‘ç«¯æ¨¡å¼ä¸‹ç¦»çº¿ï¼Œå°è¯•åˆ‡æ¢åˆ°æœ¬åœ°
      console.warn('ç½‘ç»œæ–­å¼€ï¼Œå°è¯•åˆ‡æ¢åˆ°æœ¬åœ°æ¨¡å¼')
      try {
        await this.switchToLocal()
      } catch (error) {
        console.error('åˆ‡æ¢æœ¬åœ°æ¨¡å¼å¤±è´¥', error)
      }
    } else if (this.currentMode === 'hybrid') {
      // æ··åˆæ¨¡å¼ä¸‹ç¦»çº¿ï¼Œæš‚åœåŒæ­¥
      this.runtime.getSync()?.pauseSync()
      this.notifyListeners('offline')
    }
  }

  private async handleOnline(): Promise<void> {
    if (this.currentMode === 'hybrid') {
      // æ··åˆæ¨¡å¼ä¸‹æ¢å¤åœ¨çº¿ï¼Œæ¢å¤åŒæ­¥
      this.runtime.getSync()?.resumeSync()
      await this.runtime.getSync()?.syncNow()
      this.notifyListeners('online')
    }
  }
}
```

### 19.5 åŒæ¨¡å¼ TodoList

- [ ] å®ç°è¿è¡Œæ—¶æŠ½è±¡å±‚
- [ ] å®ç°æœ¬åœ°å­˜å‚¨æä¾›è€… (SQLite)
- [ ] å®ç°äº‘ç«¯å­˜å‚¨æä¾›è€…
- [ ] å®ç°æ··åˆå­˜å‚¨æä¾›è€…
- [ ] å®ç°æœ¬åœ°æ‰§è¡Œå¼•æ“
- [ ] å®ç° Tauri æ¡Œé¢åº”ç”¨æ¡†æ¶
- [ ] å®ç°æ¨¡å¼åˆ‡æ¢é€»è¾‘
- [ ] å®ç°ç½‘ç»œçŠ¶æ€ç›‘å¬
- [ ] å®ç°ç¦»çº¿é˜Ÿåˆ—

---

## 20. æœ¬åœ° LLM é›†æˆ

### 20.1 æœ¬åœ° LLM æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       æœ¬åœ° LLM é›†æˆæ¶æ„                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       æ”¯æŒçš„æœ¬åœ° LLM å¼•æ“                        â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚   Ollama    â”‚  â”‚  LM Studio  â”‚  â”‚  llama.cpp (ç›´æ¥)       â”‚ â”‚   â”‚
â”‚  â”‚  â”‚             â”‚  â”‚             â”‚  â”‚                         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ æœ€æ¨è    â”‚  â”‚ â€¢ GUI å‹å¥½  â”‚  â”‚ â€¢ æœ€è½»é‡               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ æ˜“äºç®¡ç†  â”‚  â”‚ â€¢ æ¨¡å‹å•†åº—  â”‚  â”‚ â€¢ è‡ªå®šä¹‰å¼º             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ API å…¼å®¹  â”‚  â”‚ â€¢ ä¸€é”®éƒ¨ç½²  â”‚  â”‚ â€¢ é«˜çº§ç”¨æˆ·             â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       ç»Ÿä¸€ LLM æ¥å£                              â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚   LocalLLMProvider                                              â”‚   â”‚
â”‚  â”‚   â”œâ”€â”€ OllamaProvider                                            â”‚   â”‚
â”‚  â”‚   â”œâ”€â”€ LMStudioProvider                                          â”‚   â”‚
â”‚  â”‚   â””â”€â”€ LlamaCppProvider                                          â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚   åŠŸèƒ½:                                                         â”‚   â”‚
â”‚  â”‚   â€¢ è‡ªåŠ¨å‘ç°æœ¬åœ°æ¨¡å‹                                            â”‚   â”‚
â”‚  â”‚   â€¢ æ¨¡å‹ä¸‹è½½ç®¡ç†                                                â”‚   â”‚
â”‚  â”‚   â€¢ èµ„æºç›‘æ§                                                    â”‚   â”‚
â”‚  â”‚   â€¢ æ€§èƒ½ä¼˜åŒ–                                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 20.2 Ollama é›†æˆ

```typescript
// lib/llm/ollama-provider.ts

/**
 * Ollama é…ç½®
 */
interface OllamaConfig {
  baseUrl: string // é»˜è®¤ http://localhost:11434
  timeout: number // è¯·æ±‚è¶…æ—¶
  maxRetries: number // æœ€å¤§é‡è¯•æ¬¡æ•°
}

/**
 * Ollama LLM æä¾›è€…
 */
class OllamaProvider implements LocalLLMProvider {
  private config: OllamaConfig
  private abortControllers: Map<string, AbortController>

  constructor(config: Partial<OllamaConfig> = {}) {
    this.config = {
      baseUrl: config.baseUrl || 'http://localhost:11434',
      timeout: config.timeout || 120000,
      maxRetries: config.maxRetries || 3,
    }
    this.abortControllers = new Map()
  }

  /**
   * æ£€æŸ¥ Ollama æ˜¯å¦å¯ç”¨
   */
  async isAvailable(): Promise<boolean> {
    try {
      const response = await fetch(`${this.config.baseUrl}/api/tags`, {
        method: 'GET',
        signal: AbortSignal.timeout(5000),
      })
      return response.ok
    } catch {
      return false
    }
  }

  /**
   * åˆ—å‡ºå¯ç”¨æ¨¡å‹
   */
  async listModels(): Promise<LocalModelInfo[]> {
    const response = await fetch(`${this.config.baseUrl}/api/tags`)
    const data = await response.json()

    return data.models.map((model: any) => ({
      name: model.name,
      size: model.size,
      modifiedAt: new Date(model.modified_at),
      details: {
        family: model.details?.family,
        parameterSize: model.details?.parameter_size,
        quantizationLevel: model.details?.quantization_level,
      },
    }))
  }

  /**
   * ä¸‹è½½æ¨¡å‹
   */
  async pullModel(modelName: string, onProgress?: (progress: PullProgress) => void): Promise<void> {
    const response = await fetch(`${this.config.baseUrl}/api/pull`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name: modelName, stream: true }),
    })

    const reader = response.body?.getReader()
    if (!reader) throw new Error('æ— æ³•è¯»å–å“åº”')

    const decoder = new TextDecoder()

    while (true) {
      const { done, value } = await reader.read()
      if (done) break

      const lines = decoder.decode(value).split('\n').filter(Boolean)
      for (const line of lines) {
        const progress = JSON.parse(line)
        onProgress?.({
          status: progress.status,
          completed: progress.completed,
          total: progress.total,
          digest: progress.digest,
        })
      }
    }
  }

  /**
   * åˆ é™¤æ¨¡å‹
   */
  async deleteModel(modelName: string): Promise<void> {
    await fetch(`${this.config.baseUrl}/api/delete`, {
      method: 'DELETE',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name: modelName }),
    })
  }

  /**
   * å¯¹è¯
   */
  async chat(options: ChatOptions): Promise<ChatResponse> {
    const requestId = crypto.randomUUID()
    const abortController = new AbortController()
    this.abortControllers.set(requestId, abortController)

    try {
      const response = await fetch(`${this.config.baseUrl}/api/chat`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          model: options.model || 'llama3.2',
          messages: options.messages,
          stream: false,
          options: {
            temperature: options.temperature ?? 0.7,
            num_predict: options.maxTokens ?? 2048,
            top_p: options.topP ?? 0.9,
            stop: options.stop,
          },
        }),
        signal: abortController.signal,
      })

      const data = await response.json()

      return {
        content: data.message.content,
        model: data.model,
        usage: {
          promptTokens: data.prompt_eval_count || 0,
          completionTokens: data.eval_count || 0,
          totalTokens: (data.prompt_eval_count || 0) + (data.eval_count || 0),
        },
        finishReason: data.done_reason || 'stop',
      }
    } finally {
      this.abortControllers.delete(requestId)
    }
  }

  /**
   * æµå¼å¯¹è¯
   */
  async *chatStream(options: ChatOptions): AsyncIterable<StreamChunk> {
    const requestId = crypto.randomUUID()
    const abortController = new AbortController()
    this.abortControllers.set(requestId, abortController)

    try {
      const response = await fetch(`${this.config.baseUrl}/api/chat`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          model: options.model || 'llama3.2',
          messages: options.messages,
          stream: true,
          options: {
            temperature: options.temperature ?? 0.7,
            num_predict: options.maxTokens ?? 2048,
          },
        }),
        signal: abortController.signal,
      })

      const reader = response.body?.getReader()
      if (!reader) throw new Error('æ— æ³•è¯»å–å“åº”')

      const decoder = new TextDecoder()

      while (true) {
        const { done, value } = await reader.read()
        if (done) break

        const lines = decoder.decode(value).split('\n').filter(Boolean)
        for (const line of lines) {
          const data = JSON.parse(line)

          yield {
            content: data.message?.content || '',
            done: data.done,
            model: data.model,
          }
        }
      }
    } finally {
      this.abortControllers.delete(requestId)
    }
  }

  /**
   * æ–‡æœ¬åµŒå…¥
   */
  async embed(text: string, model?: string): Promise<number[]> {
    const response = await fetch(`${this.config.baseUrl}/api/embeddings`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: model || 'nomic-embed-text',
        prompt: text,
      }),
    })

    const data = await response.json()
    return data.embedding
  }

  /**
   * å–æ¶ˆè¯·æ±‚
   */
  cancel(requestId: string): void {
    const controller = this.abortControllers.get(requestId)
    controller?.abort()
    this.abortControllers.delete(requestId)
  }
}
```

### 20.3 æ¨¡å‹ç®¡ç† UI

```typescript
// components/settings/LocalLLMSettings.tsx

/**
 * æœ¬åœ° LLM è®¾ç½®ç»„ä»¶
 */
export function LocalLLMSettings() {
  const [status, setStatus] = useState<'checking' | 'available' | 'unavailable'>('checking');
  const [models, setModels] = useState<LocalModelInfo[]>([]);
  const [downloadProgress, setDownloadProgress] = useState<PullProgress | null>(null);

  const llmProvider = useLocalLLM();

  useEffect(() => {
    checkStatus();
  }, []);

  async function checkStatus() {
    setStatus('checking');
    const available = await llmProvider.isAvailable();
    setStatus(available ? 'available' : 'unavailable');

    if (available) {
      const modelList = await llmProvider.listModels();
      setModels(modelList);
    }
  }

  async function handlePullModel(modelName: string) {
    try {
      await llmProvider.pullModel(modelName, (progress) => {
        setDownloadProgress(progress);
      });
      setDownloadProgress(null);
      await checkStatus();
    } catch (error) {
      toast.error(`ä¸‹è½½å¤±è´¥: ${error.message}`);
      setDownloadProgress(null);
    }
  }

  async function handleDeleteModel(modelName: string) {
    if (!confirm(`ç¡®å®šè¦åˆ é™¤æ¨¡å‹ ${modelName} å—ï¼Ÿ`)) return;

    try {
      await llmProvider.deleteModel(modelName);
      await checkStatus();
      toast.success('æ¨¡å‹å·²åˆ é™¤');
    } catch (error) {
      toast.error(`åˆ é™¤å¤±è´¥: ${error.message}`);
    }
  }

  return (
    <div className="space-y-6">
      {/* çŠ¶æ€æŒ‡ç¤ºå™¨ */}
      <Card>
        <CardHeader>
          <CardTitle>æœ¬åœ° LLM çŠ¶æ€</CardTitle>
        </CardHeader>
        <CardContent>
          <div className="flex items-center gap-3">
            <StatusIndicator status={status} />
            <div>
              {status === 'checking' && 'æ­£åœ¨æ£€æŸ¥...'}
              {status === 'available' && 'Ollama è¿è¡Œä¸­'}
              {status === 'unavailable' && (
                <span className="text-red-500">
                  Ollama æœªè¿è¡Œã€‚
                  <a href="https://ollama.ai" target="_blank" className="underline ml-1">
                    å®‰è£… Ollama
                  </a>
                </span>
              )}
            </div>
          </div>
        </CardContent>
      </Card>

      {/* å·²å®‰è£…æ¨¡å‹ */}
      {status === 'available' && (
        <Card>
          <CardHeader>
            <CardTitle>å·²å®‰è£…æ¨¡å‹</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="space-y-3">
              {models.map((model) => (
                <div key={model.name} className="flex items-center justify-between p-3 border rounded">
                  <div>
                    <div className="font-medium">{model.name}</div>
                    <div className="text-sm text-gray-500">
                      {formatBytes(model.size)} â€¢ {model.details?.parameterSize}
                    </div>
                  </div>
                  <div className="flex gap-2">
                    <Button variant="outline" size="sm" onClick={() => testModel(model.name)}>
                      æµ‹è¯•
                    </Button>
                    <Button
                      variant="destructive"
                      size="sm"
                      onClick={() => handleDeleteModel(model.name)}
                    >
                      åˆ é™¤
                    </Button>
                  </div>
                </div>
              ))}

              {models.length === 0 && (
                <div className="text-center text-gray-500 py-8">
                  æš‚æ— å·²å®‰è£…æ¨¡å‹
                </div>
              )}
            </div>
          </CardContent>
        </Card>
      )}

      {/* æ¨èæ¨¡å‹ */}
      {status === 'available' && (
        <Card>
          <CardHeader>
            <CardTitle>æ¨èæ¨¡å‹</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="space-y-3">
              {RECOMMENDED_MODELS.map((model) => {
                const installed = models.some(m => m.name === model.name);

                return (
                  <div key={model.name} className="flex items-center justify-between p-3 border rounded">
                    <div>
                      <div className="font-medium">{model.name}</div>
                      <div className="text-sm text-gray-500">{model.description}</div>
                      <div className="text-xs text-gray-400">
                        {model.size} â€¢ {model.capabilities.join(', ')}
                      </div>
                    </div>
                    <Button
                      disabled={installed || downloadProgress !== null}
                      onClick={() => handlePullModel(model.name)}
                    >
                      {installed ? 'å·²å®‰è£…' : 'ä¸‹è½½'}
                    </Button>
                  </div>
                );
              })}
            </div>
          </CardContent>
        </Card>
      )}

      {/* ä¸‹è½½è¿›åº¦ */}
      {downloadProgress && (
        <Card>
          <CardContent className="py-4">
            <div className="space-y-2">
              <div className="flex justify-between text-sm">
                <span>{downloadProgress.status}</span>
                <span>
                  {formatBytes(downloadProgress.completed)} / {formatBytes(downloadProgress.total)}
                </span>
              </div>
              <Progress
                value={(downloadProgress.completed / downloadProgress.total) * 100}
              />
            </div>
          </CardContent>
        </Card>
      )}
    </div>
  );
}

// æ¨èæ¨¡å‹åˆ—è¡¨
const RECOMMENDED_MODELS = [
  {
    name: 'llama3.2:latest',
    description: 'Meta æœ€æ–°å¼€æºæ¨¡å‹ï¼Œå¹³è¡¡æ€§èƒ½å’Œæ•ˆç‡',
    size: '2.0 GB',
    capabilities: ['èŠå¤©', 'æ¨ç†', 'ä»£ç '],
  },
  {
    name: 'qwen2.5:7b',
    description: 'é˜¿é‡Œé€šä¹‰åƒé—®ï¼Œä¸­æ–‡èƒ½åŠ›å¼º',
    size: '4.4 GB',
    capabilities: ['èŠå¤©', 'ä¸­æ–‡', 'ä»£ç '],
  },
  {
    name: 'deepseek-coder:6.7b',
    description: 'ä¸“æ³¨ä»£ç ç”Ÿæˆçš„æ¨¡å‹',
    size: '3.8 GB',
    capabilities: ['ä»£ç ', 'è¡¥å…¨', 'è§£é‡Š'],
  },
  {
    name: 'nomic-embed-text',
    description: 'æ–‡æœ¬åµŒå…¥æ¨¡å‹ï¼Œç”¨äºè¯­ä¹‰æœç´¢',
    size: '274 MB',
    capabilities: ['åµŒå…¥', 'æœç´¢'],
  },
];
```

### 20.4 æœ¬åœ° LLM TodoList

- [ ] å®ç° Ollama é›†æˆ
- [ ] å®ç° LM Studio é›†æˆ
- [ ] å®ç°æ¨¡å‹ç®¡ç† UI
- [ ] å®ç°æ¨¡å‹ä¸‹è½½åŠŸèƒ½
- [ ] å®ç°æ¨¡å‹æµ‹è¯•åŠŸèƒ½
- [ ] å®ç°æœ¬åœ°åµŒå…¥åŠŸèƒ½
- [ ] å®ç°æ¨¡å‹æ€§èƒ½ç›‘æ§
- [ ] å®ç°æ™ºèƒ½æ¨¡å‹è·¯ç”±

---

## 21. æ•°æ®åŒæ­¥æœºåˆ¶

### 21.1 åŒæ­¥æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         æ•°æ®åŒæ­¥æ¶æ„                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚        æœ¬åœ°æ•°æ®åº“         â”‚      â”‚          äº‘ç«¯æ•°æ®åº“           â”‚  â”‚
â”‚  â”‚         (SQLite)          â”‚      â”‚        (PostgreSQL)           â”‚  â”‚
â”‚  â”‚                           â”‚      â”‚                               â”‚  â”‚
â”‚  â”‚  workflows                â”‚      â”‚  workflows                    â”‚  â”‚
â”‚  â”‚  executions               â”‚      â”‚  executions                   â”‚  â”‚
â”‚  â”‚  settings                 â”‚      â”‚  settings                     â”‚  â”‚
â”‚  â”‚  sync_log                 â”‚      â”‚  sync_log                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â†‘                                    â†‘                     â”‚
â”‚              â”‚                                    â”‚                     â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                         â”‚                                               â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚              â”‚      åŒæ­¥å¼•æ“       â”‚                                    â”‚
â”‚              â”‚                    â”‚                                    â”‚
â”‚              â”‚  â€¢ å˜æ›´æ£€æµ‹        â”‚                                    â”‚
â”‚              â”‚  â€¢ å†²çªè§£å†³        â”‚                                    â”‚
â”‚              â”‚  â€¢ å¢é‡åŒæ­¥        â”‚                                    â”‚
â”‚              â”‚  â€¢ æ–­ç‚¹ç»­ä¼         â”‚                                    â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                                                                         â”‚
â”‚  åŒæ­¥ç­–ç•¥:                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  1. è‡ªåŠ¨åŒæ­¥: å®šæ—¶ + å˜æ›´è§¦å‘                                    â”‚   â”‚
â”‚  â”‚  2. æ‰‹åŠ¨åŒæ­¥: ç”¨æˆ·ä¸»åŠ¨è§¦å‘                                       â”‚   â”‚
â”‚  â”‚  3. å†²çªç­–ç•¥: æœ€åå†™å…¥ä¼˜å…ˆ / æœ¬åœ°ä¼˜å…ˆ / äº‘ç«¯ä¼˜å…ˆ / æ‰‹åŠ¨è§£å†³      â”‚   â”‚
â”‚  â”‚  4. æ•æ„Ÿæ•°æ®: ä»…æœ¬åœ°å­˜å‚¨ï¼Œä¸åŒæ­¥                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 21.2 åŒæ­¥å¼•æ“å®ç°

```typescript
// lib/sync/sync-engine.ts

/**
 * åŒæ­¥é…ç½®
 */
interface SyncConfig {
  interval: number // è‡ªåŠ¨åŒæ­¥é—´éš” (æ¯«ç§’)
  conflictResolution: 'local' | 'cloud' | 'latest' | 'manual'
  excludePatterns: string[] // æ’é™¤çš„æ•°æ®ç±»å‹
  encryptBeforeSync: boolean // åŒæ­¥å‰åŠ å¯†
  maxRetries: number
  batchSize: number
}

/**
 * å˜æ›´è®°å½•
 */
interface ChangeRecord {
  id: string
  entityType: string
  entityId: string
  operation: 'create' | 'update' | 'delete'
  data: unknown
  timestamp: Date
  syncStatus: 'pending' | 'syncing' | 'synced' | 'failed'
  version: number
}

/**
 * åŒæ­¥å¼•æ“
 */
class SyncEngine {
  private config: SyncConfig
  private localDb: LocalDatabase
  private cloudApi: CloudApiClient
  private syncInterval: NodeJS.Timer | null = null
  private isSyncing: boolean = false
  private eventEmitter: EventEmitter

  constructor(localDb: LocalDatabase, cloudApi: CloudApiClient, config: Partial<SyncConfig> = {}) {
    this.localDb = localDb
    this.cloudApi = cloudApi
    this.config = {
      interval: 60000, // 1åˆ†é’Ÿ
      conflictResolution: 'latest',
      excludePatterns: ['api_keys', 'secrets'],
      encryptBeforeSync: true,
      maxRetries: 3,
      batchSize: 50,
      ...config,
    }
    this.eventEmitter = new EventEmitter()
  }

  /**
   * å¯åŠ¨è‡ªåŠ¨åŒæ­¥
   */
  startAutoSync(): void {
    if (this.syncInterval) return

    this.syncInterval = setInterval(() => {
      this.sync().catch(console.error)
    }, this.config.interval)

    // ç«‹å³æ‰§è¡Œä¸€æ¬¡åŒæ­¥
    this.sync().catch(console.error)
  }

  /**
   * åœæ­¢è‡ªåŠ¨åŒæ­¥
   */
  stopAutoSync(): void {
    if (this.syncInterval) {
      clearInterval(this.syncInterval)
      this.syncInterval = null
    }
  }

  /**
   * æ‰§è¡ŒåŒæ­¥
   */
  async sync(): Promise<SyncResult> {
    if (this.isSyncing) {
      return { status: 'skipped', reason: 'Sync already in progress' }
    }

    this.isSyncing = true
    this.eventEmitter.emit('sync:start')

    try {
      // 1. è·å–æœ¬åœ°æœªåŒæ­¥çš„å˜æ›´
      const localChanges = await this.getLocalPendingChanges()

      // 2. è·å–äº‘ç«¯çš„å˜æ›´
      const lastSyncTime = await this.getLastSyncTime()
      const cloudChanges = await this.cloudApi.getChangesSince(lastSyncTime)

      // 3. æ£€æµ‹å†²çª
      const { conflicts, localOnly, cloudOnly } = this.detectConflicts(localChanges, cloudChanges)

      // 4. è§£å†³å†²çª
      const resolvedConflicts = await this.resolveConflicts(conflicts)

      // 5. ä¸Šä¼ æœ¬åœ°å˜æ›´
      const uploadResults = await this.uploadChanges([
        ...localOnly,
        ...resolvedConflicts.filter((c) => c.resolution === 'local').map((c) => c.local),
      ])

      // 6. ä¸‹è½½äº‘ç«¯å˜æ›´
      const downloadResults = await this.downloadChanges([
        ...cloudOnly,
        ...resolvedConflicts.filter((c) => c.resolution === 'cloud').map((c) => c.cloud),
      ])

      // 7. æ›´æ–°åŒæ­¥çŠ¶æ€
      await this.updateSyncTime(new Date())
      await this.markChangesSynced(uploadResults.successful)

      const result: SyncResult = {
        status: 'success',
        uploaded: uploadResults.successful.length,
        downloaded: downloadResults.successful.length,
        conflicts: conflicts.length,
        errors: [...uploadResults.failed, ...downloadResults.failed],
      }

      this.eventEmitter.emit('sync:complete', result)
      return result
    } catch (error) {
      const result: SyncResult = {
        status: 'failed',
        error: error.message,
      }
      this.eventEmitter.emit('sync:error', error)
      return result
    } finally {
      this.isSyncing = false
    }
  }

  /**
   * æ£€æµ‹å†²çª
   */
  private detectConflicts(
    localChanges: ChangeRecord[],
    cloudChanges: ChangeRecord[]
  ): ConflictDetectionResult {
    const conflicts: Conflict[] = []
    const localOnly: ChangeRecord[] = []
    const cloudOnly: ChangeRecord[] = []

    const cloudMap = new Map(cloudChanges.map((c) => [`${c.entityType}:${c.entityId}`, c]))
    const localMap = new Map(localChanges.map((c) => [`${c.entityType}:${c.entityId}`, c]))

    // æ£€æŸ¥æœ¬åœ°å˜æ›´
    for (const local of localChanges) {
      const key = `${local.entityType}:${local.entityId}`
      const cloud = cloudMap.get(key)

      if (cloud) {
        // åŒä¸€å®ä½“åœ¨ä¸¤ç«¯éƒ½æœ‰å˜æ›´ -> å†²çª
        conflicts.push({ local, cloud })
        cloudMap.delete(key)
      } else {
        localOnly.push(local)
      }
    }

    // å‰©ä½™çš„äº‘ç«¯å˜æ›´
    cloudOnly.push(...cloudMap.values())

    return { conflicts, localOnly, cloudOnly }
  }

  /**
   * è§£å†³å†²çª
   */
  private async resolveConflicts(conflicts: Conflict[]): Promise<ResolvedConflict[]> {
    const resolved: ResolvedConflict[] = []

    for (const conflict of conflicts) {
      let resolution: 'local' | 'cloud'

      switch (this.config.conflictResolution) {
        case 'local':
          resolution = 'local'
          break
        case 'cloud':
          resolution = 'cloud'
          break
        case 'latest':
          resolution = conflict.local.timestamp > conflict.cloud.timestamp ? 'local' : 'cloud'
          break
        case 'manual':
          resolution = await this.promptUserForResolution(conflict)
          break
      }

      resolved.push({ ...conflict, resolution })
    }

    return resolved
  }

  /**
   * ä¸Šä¼ æœ¬åœ°å˜æ›´
   */
  private async uploadChanges(changes: ChangeRecord[]): Promise<UploadResult> {
    const successful: string[] = []
    const failed: SyncError[] = []

    // åˆ†æ‰¹ä¸Šä¼ 
    for (let i = 0; i < changes.length; i += this.config.batchSize) {
      const batch = changes.slice(i, i + this.config.batchSize)

      try {
        // åŠ å¯†æ•æ„Ÿæ•°æ®
        const encryptedBatch = this.config.encryptBeforeSync
          ? await this.encryptBatch(batch)
          : batch

        await this.cloudApi.pushChanges(encryptedBatch)
        successful.push(...batch.map((c) => c.id))
      } catch (error) {
        failed.push({
          changeIds: batch.map((c) => c.id),
          error: error.message,
        })
      }
    }

    return { successful, failed }
  }

  /**
   * ä¸‹è½½äº‘ç«¯å˜æ›´
   */
  private async downloadChanges(changes: ChangeRecord[]): Promise<DownloadResult> {
    const successful: string[] = []
    const failed: SyncError[] = []

    for (const change of changes) {
      try {
        // è§£å¯†æ•°æ®
        const decryptedData = this.config.encryptBeforeSync
          ? await this.decrypt(change.data)
          : change.data

        // åº”ç”¨åˆ°æœ¬åœ°æ•°æ®åº“
        await this.applyChange({
          ...change,
          data: decryptedData,
        })

        successful.push(change.id)
      } catch (error) {
        failed.push({
          changeIds: [change.id],
          error: error.message,
        })
      }
    }

    return { successful, failed }
  }

  /**
   * ç›‘å¬åŒæ­¥äº‹ä»¶
   */
  on(event: 'sync:start' | 'sync:complete' | 'sync:error', handler: Function): void {
    this.eventEmitter.on(event, handler)
  }
}
```

### 21.3 ç«¯åˆ°ç«¯åŠ å¯†

```typescript
// lib/sync/encryption.ts

/**
 * ç«¯åˆ°ç«¯åŠ å¯†æœåŠ¡
 */
class E2EEncryption {
  private masterKey: CryptoKey | null = null

  /**
   * åˆå§‹åŒ–åŠ å¯†å¯†é’¥
   */
  async initialize(password: string, salt?: Uint8Array): Promise<void> {
    // ä»å¯†ç æ´¾ç”Ÿå¯†é’¥
    const passwordKey = await crypto.subtle.importKey(
      'raw',
      new TextEncoder().encode(password),
      'PBKDF2',
      false,
      ['deriveKey']
    )

    // å¦‚æœæ²¡æœ‰ saltï¼Œç”Ÿæˆæ–°çš„
    const usedSalt = salt || crypto.getRandomValues(new Uint8Array(16))

    // æ´¾ç”Ÿä¸»å¯†é’¥
    this.masterKey = await crypto.subtle.deriveKey(
      {
        name: 'PBKDF2',
        salt: usedSalt,
        iterations: 100000,
        hash: 'SHA-256',
      },
      passwordKey,
      { name: 'AES-GCM', length: 256 },
      false,
      ['encrypt', 'decrypt']
    )
  }

  /**
   * åŠ å¯†æ•°æ®
   */
  async encrypt(data: unknown): Promise<EncryptedData> {
    if (!this.masterKey) {
      throw new Error('åŠ å¯†å¯†é’¥æœªåˆå§‹åŒ–')
    }

    const iv = crypto.getRandomValues(new Uint8Array(12))
    const plaintext = new TextEncoder().encode(JSON.stringify(data))

    const ciphertext = await crypto.subtle.encrypt(
      { name: 'AES-GCM', iv },
      this.masterKey,
      plaintext
    )

    return {
      iv: this.arrayBufferToBase64(iv),
      ciphertext: this.arrayBufferToBase64(ciphertext),
      algorithm: 'AES-GCM-256',
    }
  }

  /**
   * è§£å¯†æ•°æ®
   */
  async decrypt(encrypted: EncryptedData): Promise<unknown> {
    if (!this.masterKey) {
      throw new Error('åŠ å¯†å¯†é’¥æœªåˆå§‹åŒ–')
    }

    const iv = this.base64ToArrayBuffer(encrypted.iv)
    const ciphertext = this.base64ToArrayBuffer(encrypted.ciphertext)

    const plaintext = await crypto.subtle.decrypt(
      { name: 'AES-GCM', iv },
      this.masterKey,
      ciphertext
    )

    return JSON.parse(new TextDecoder().decode(plaintext))
  }

  private arrayBufferToBase64(buffer: ArrayBuffer): string {
    return btoa(String.fromCharCode(...new Uint8Array(buffer)))
  }

  private base64ToArrayBuffer(base64: string): ArrayBuffer {
    const binary = atob(base64)
    const bytes = new Uint8Array(binary.length)
    for (let i = 0; i < binary.length; i++) {
      bytes[i] = binary.charCodeAt(i)
    }
    return bytes.buffer
  }
}
```

### 21.4 åŒæ­¥ TodoList

- [ ] å®ç°å˜æ›´è¿½è¸ª
- [ ] å®ç°åŒæ­¥å¼•æ“
- [ ] å®ç°å†²çªæ£€æµ‹
- [ ] å®ç°å†²çªè§£å†³ç­–ç•¥
- [ ] å®ç°ç«¯åˆ°ç«¯åŠ å¯†
- [ ] å®ç°å¢é‡åŒæ­¥
- [ ] å®ç°æ–­ç‚¹ç»­ä¼ 
- [ ] å®ç°åŒæ­¥çŠ¶æ€ UI
- [ ] å®ç°åŒæ­¥æ—¥å¿—

---

## 22. ç¦»çº¿æ”¯æŒæ–¹æ¡ˆ

### 22.1 ç¦»çº¿èƒ½åŠ›æ¦‚è¿°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç¦»çº¿æ”¯æŒæ–¹æ¡ˆ                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       ç¦»çº¿èƒ½åŠ›çŸ©é˜µ                               â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  åŠŸèƒ½              åœ¨çº¿        ç¦»çº¿        å¤‡æ³¨                 â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚  æŸ¥çœ‹å·¥ä½œæµ         âœ…          âœ…         æœ¬åœ°ç¼“å­˜             â”‚   â”‚
â”‚  â”‚  ç¼–è¾‘å·¥ä½œæµ         âœ…          âœ…         ç¦»çº¿ç¼–è¾‘é˜Ÿåˆ—         â”‚   â”‚
â”‚  â”‚  æ‰§è¡Œå·¥ä½œæµ         âœ…          âš ï¸         ä»…æœ¬åœ°LLMå¯ç”¨        â”‚   â”‚
â”‚  â”‚  æŸ¥çœ‹æ‰§è¡Œè®°å½•       âœ…          âœ…         æœ¬åœ°å­˜å‚¨             â”‚   â”‚
â”‚  â”‚  æµè§ˆAgentå•†åº—     âœ…          âš ï¸         æœ‰é™ç¼“å­˜             â”‚   â”‚
â”‚  â”‚  å‘å¸ƒAgent         âœ…          âŒ         éœ€è¦åœ¨çº¿             â”‚   â”‚
â”‚  â”‚  ç”¨æˆ·è®¾ç½®           âœ…          âœ…         æœ¬åœ°å­˜å‚¨             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       ç¦»çº¿æ•°æ®ç®¡ç†                               â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ IndexedDB     â”‚  â”‚ LocalStorage  â”‚  â”‚ Cache API        â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ (ç»“æ„åŒ–æ•°æ®)  â”‚  â”‚ (é…ç½®/çŠ¶æ€)   â”‚  â”‚ (é™æ€èµ„æº)       â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 22.2 Service Worker å®ç°

```typescript
// public/sw.js

const CACHE_VERSION = 'v1'
const STATIC_CACHE = `reverseai-static-${CACHE_VERSION}`
const DYNAMIC_CACHE = `reverseai-dynamic-${CACHE_VERSION}`
const API_CACHE = `reverseai-api-${CACHE_VERSION}`

// éœ€è¦é¢„ç¼“å­˜çš„é™æ€èµ„æº
const STATIC_ASSETS = [
  '/',
  '/offline',
  '/manifest.json',
  '/icons/icon-192.png',
  '/icons/icon-512.png',
]

// éœ€è¦ç¼“å­˜çš„ API è·¯ç”±
const CACHEABLE_API_ROUTES = ['/api/v1/workflows', '/api/v1/agents', '/api/v1/users/me']

// å®‰è£…äº‹ä»¶ - é¢„ç¼“å­˜é™æ€èµ„æº
self.addEventListener('install', (event) => {
  event.waitUntil(
    caches.open(STATIC_CACHE).then((cache) => {
      return cache.addAll(STATIC_ASSETS)
    })
  )
  self.skipWaiting()
})

// æ¿€æ´»äº‹ä»¶ - æ¸…ç†æ—§ç¼“å­˜
self.addEventListener('activate', (event) => {
  event.waitUntil(
    caches.keys().then((cacheNames) => {
      return Promise.all(
        cacheNames
          .filter((name) => name.startsWith('reverseai-') && name !== STATIC_CACHE)
          .map((name) => caches.delete(name))
      )
    })
  )
  self.clients.claim()
})

// è¯·æ±‚æ‹¦æˆª
self.addEventListener('fetch', (event) => {
  const { request } = event
  const url = new URL(request.url)

  // é™æ€èµ„æº - Cache First
  if (isStaticAsset(url)) {
    event.respondWith(cacheFirst(request, STATIC_CACHE))
    return
  }

  // API è¯·æ±‚ - Network First with Cache Fallback
  if (isApiRequest(url)) {
    event.respondWith(networkFirstWithCache(request, API_CACHE))
    return
  }

  // é¡µé¢è¯·æ±‚ - Network First
  if (request.mode === 'navigate') {
    event.respondWith(
      networkFirst(request).catch(() => {
        return caches.match('/offline')
      })
    )
    return
  }

  // å…¶ä»–è¯·æ±‚ - Network Only
  event.respondWith(fetch(request))
})

// ç¼“å­˜ç­–ç•¥: Cache First
async function cacheFirst(request, cacheName) {
  const cached = await caches.match(request)
  if (cached) return cached

  const response = await fetch(request)
  if (response.ok) {
    const cache = await caches.open(cacheName)
    cache.put(request, response.clone())
  }
  return response
}

// ç¼“å­˜ç­–ç•¥: Network First with Cache Fallback
async function networkFirstWithCache(request, cacheName) {
  try {
    const response = await fetch(request)

    if (response.ok) {
      const cache = await caches.open(cacheName)
      cache.put(request, response.clone())
    }

    return response
  } catch (error) {
    const cached = await caches.match(request)
    if (cached) return cached

    // è¿”å›ç¦»çº¿å“åº”
    return new Response(JSON.stringify({ error: 'offline', message: 'å½“å‰å¤„äºç¦»çº¿çŠ¶æ€' }), {
      status: 503,
      headers: { 'Content-Type': 'application/json' },
    })
  }
}

// åå°åŒæ­¥
self.addEventListener('sync', (event) => {
  if (event.tag === 'sync-pending-changes') {
    event.waitUntil(syncPendingChanges())
  }
})

async function syncPendingChanges() {
  const db = await openIndexedDB()
  const pendingChanges = await db.getAll('pending_changes')

  for (const change of pendingChanges) {
    try {
      await fetch(change.url, {
        method: change.method,
        headers: change.headers,
        body: change.body,
      })
      await db.delete('pending_changes', change.id)
    } catch (error) {
      console.error('Failed to sync change:', change.id, error)
    }
  }
}

// æ¨é€é€šçŸ¥
self.addEventListener('push', (event) => {
  const data = event.data?.json()

  event.waitUntil(
    self.registration.showNotification(data.title, {
      body: data.body,
      icon: '/icons/icon-192.png',
      badge: '/icons/badge.png',
      data: data.data,
    })
  )
})

// å·¥å…·å‡½æ•°
function isStaticAsset(url) {
  return (
    url.pathname.startsWith('/_next/static/') ||
    url.pathname.match(/\.(js|css|png|jpg|svg|woff2?)$/)
  )
}

function isApiRequest(url) {
  return url.pathname.startsWith('/api/')
}
```

### 22.3 ç¦»çº¿æ•°æ®å­˜å‚¨

```typescript
// lib/offline/indexed-db.ts

/**
 * IndexedDB å­˜å‚¨ç®¡ç†
 */
class OfflineStorage {
  private db: IDBDatabase | null = null
  private readonly DB_NAME = 'reverseai-offline'
  private readonly DB_VERSION = 1

  async initialize(): Promise<void> {
    return new Promise((resolve, reject) => {
      const request = indexedDB.open(this.DB_NAME, this.DB_VERSION)

      request.onerror = () => reject(request.error)
      request.onsuccess = () => {
        this.db = request.result
        resolve()
      }

      request.onupgradeneeded = (event) => {
        const db = (event.target as IDBOpenDBRequest).result

        // å·¥ä½œæµå­˜å‚¨
        if (!db.objectStoreNames.contains('workflows')) {
          const store = db.createObjectStore('workflows', { keyPath: 'id' })
          store.createIndex('userId', 'userId', { unique: false })
          store.createIndex('updatedAt', 'updatedAt', { unique: false })
        }

        // æ‰§è¡Œè®°å½•å­˜å‚¨
        if (!db.objectStoreNames.contains('executions')) {
          const store = db.createObjectStore('executions', { keyPath: 'id' })
          store.createIndex('workflowId', 'workflowId', { unique: false })
          store.createIndex('createdAt', 'createdAt', { unique: false })
        }

        // å¾…åŒæ­¥å˜æ›´
        if (!db.objectStoreNames.contains('pending_changes')) {
          const store = db.createObjectStore('pending_changes', { keyPath: 'id' })
          store.createIndex('timestamp', 'timestamp', { unique: false })
        }

        // ç¼“å­˜çš„ Agent
        if (!db.objectStoreNames.contains('cached_agents')) {
          const store = db.createObjectStore('cached_agents', { keyPath: 'id' })
          store.createIndex('cachedAt', 'cachedAt', { unique: false })
        }

        // ç”¨æˆ·è®¾ç½®
        if (!db.objectStoreNames.contains('settings')) {
          db.createObjectStore('settings', { keyPath: 'key' })
        }
      }
    })
  }

  /**
   * ä¿å­˜å·¥ä½œæµ (æ”¯æŒç¦»çº¿)
   */
  async saveWorkflow(workflow: Workflow): Promise<void> {
    await this.put('workflows', workflow)

    // è®°å½•å˜æ›´ç”¨äºåŒæ­¥
    await this.recordChange({
      entityType: 'workflow',
      entityId: workflow.id,
      operation: 'update',
      data: workflow,
    })
  }

  /**
   * è·å–æ‰€æœ‰å·¥ä½œæµ
   */
  async getWorkflows(): Promise<Workflow[]> {
    return this.getAll('workflows')
  }

  /**
   * ä¿å­˜æ‰§è¡Œè®°å½•
   */
  async saveExecution(execution: Execution): Promise<void> {
    await this.put('executions', execution)
  }

  /**
   * è®°å½•å¾…åŒæ­¥å˜æ›´
   */
  async recordChange(change: Omit<PendingChange, 'id' | 'timestamp'>): Promise<void> {
    const record: PendingChange = {
      ...change,
      id: crypto.randomUUID(),
      timestamp: new Date(),
    }
    await this.put('pending_changes', record)

    // è¯·æ±‚åå°åŒæ­¥
    if ('serviceWorker' in navigator && 'sync' in window.ServiceWorkerRegistration.prototype) {
      const registration = await navigator.serviceWorker.ready
      await registration.sync.register('sync-pending-changes')
    }
  }

  /**
   * è·å–å¾…åŒæ­¥å˜æ›´
   */
  async getPendingChanges(): Promise<PendingChange[]> {
    return this.getAll('pending_changes')
  }

  /**
   * æ¸…é™¤å·²åŒæ­¥çš„å˜æ›´
   */
  async clearSyncedChanges(ids: string[]): Promise<void> {
    const tx = this.db!.transaction('pending_changes', 'readwrite')
    const store = tx.objectStore('pending_changes')

    for (const id of ids) {
      store.delete(id)
    }

    await new Promise((resolve, reject) => {
      tx.oncomplete = resolve
      tx.onerror = () => reject(tx.error)
    })
  }

  // é€šç”¨æ–¹æ³•
  private async put(storeName: string, data: unknown): Promise<void> {
    return new Promise((resolve, reject) => {
      const tx = this.db!.transaction(storeName, 'readwrite')
      const store = tx.objectStore(storeName)
      store.put(data)
      tx.oncomplete = () => resolve()
      tx.onerror = () => reject(tx.error)
    })
  }

  private async getAll<T>(storeName: string): Promise<T[]> {
    return new Promise((resolve, reject) => {
      const tx = this.db!.transaction(storeName, 'readonly')
      const store = tx.objectStore(storeName)
      const request = store.getAll()
      request.onsuccess = () => resolve(request.result)
      request.onerror = () => reject(request.error)
    })
  }
}
```

### 22.4 ç¦»çº¿ UI ç»„ä»¶

```typescript
// components/OfflineIndicator.tsx

export function OfflineIndicator() {
  const [isOnline, setIsOnline] = useState(navigator.onLine);
  const [pendingChanges, setPendingChanges] = useState(0);

  useEffect(() => {
    const handleOnline = () => setIsOnline(true);
    const handleOffline = () => setIsOnline(false);

    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);

    // ç›‘å¬å¾…åŒæ­¥å˜æ›´
    const checkPending = async () => {
      const changes = await offlineStorage.getPendingChanges();
      setPendingChanges(changes.length);
    };
    checkPending();
    const interval = setInterval(checkPending, 10000);

    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
      clearInterval(interval);
    };
  }, []);

  if (isOnline && pendingChanges === 0) {
    return null;
  }

  return (
    <div className={cn(
      "fixed bottom-4 right-4 px-4 py-2 rounded-lg shadow-lg flex items-center gap-2",
      isOnline ? "bg-yellow-100 text-yellow-800" : "bg-red-100 text-red-800"
    )}>
      {!isOnline && (
        <>
          <WifiOff className="w-4 h-4" />
          <span>ç¦»çº¿æ¨¡å¼</span>
        </>
      )}
      {isOnline && pendingChanges > 0 && (
        <>
          <CloudSync className="w-4 h-4 animate-spin" />
          <span>æ­£åœ¨åŒæ­¥ {pendingChanges} é¡¹å˜æ›´...</span>
        </>
      )}
    </div>
  );
}
```

### 22.5 ç¦»çº¿æ”¯æŒ TodoList

- [ ] å®ç° Service Worker
- [ ] å®ç° IndexedDB å­˜å‚¨
- [ ] å®ç°ç¦»çº¿ç¼–è¾‘é˜Ÿåˆ—
- [ ] å®ç°åå°åŒæ­¥
- [ ] å®ç°ç¦»çº¿çŠ¶æ€æŒ‡ç¤º
- [ ] å®ç°èµ„æºé¢„ç¼“å­˜
- [ ] å®ç° PWA manifest
- [ ] æµ‹è¯•ç¦»çº¿åœºæ™¯

---

## é™„å½•

### A. å¸¸ç”¨å‘½ä»¤

```bash
# å‰ç«¯
pnpm dev          # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm build        # æ„å»ºç”Ÿäº§ç‰ˆæœ¬
pnpm test         # è¿è¡Œæµ‹è¯•
pnpm lint         # ä»£ç æ£€æŸ¥

# åç«¯
go run cmd/server/main.go     # å¯åŠ¨æœåŠ¡å™¨
go test ./...                 # è¿è¡Œæµ‹è¯•
go build -o server cmd/server/main.go  # æ„å»º

# æ•°æ®åº“
go run cmd/migrate/main.go up    # æ‰§è¡Œè¿ç§»
go run cmd/migrate/main.go down  # å›æ»šè¿ç§»

# Docker
docker-compose up -d      # å¯åŠ¨æœåŠ¡
docker-compose down       # åœæ­¢æœåŠ¡
```

### B. ä»£ç è§„èŒƒ

**Git æäº¤è§„èŒƒ**

```
feat: æ–°åŠŸèƒ½
fix: ä¿®å¤bug
docs: æ–‡æ¡£æ›´æ–°
style: ä»£ç æ ¼å¼
refactor: é‡æ„
test: æµ‹è¯•ç›¸å…³
chore: æ„å»º/å·¥å…·
```

**åˆ†æ”¯ç®¡ç†**

```
main        - ç”Ÿäº§åˆ†æ”¯
develop     - å¼€å‘åˆ†æ”¯
feature/*   - åŠŸèƒ½åˆ†æ”¯
fix/*       - ä¿®å¤åˆ†æ”¯
release/*   - å‘å¸ƒåˆ†æ”¯
```

### C. å‚è€ƒèµ„æº

- [Next.js æ–‡æ¡£](https://nextjs.org/docs)
- [shadcn/ui æ–‡æ¡£](https://ui.shadcn.com/)
- [React Flow æ–‡æ¡£](https://reactflow.dev/)
- [Echo æ¡†æ¶æ–‡æ¡£](https://echo.labstack.com/)
- [GORM æ–‡æ¡£](https://gorm.io/docs/)

---

> æœ¬æ–‡æ¡£å°†éšé¡¹ç›®è¿›å±•æŒç»­æ›´æ–°
